!function(e){function t(t){for(var i,o,r=t[0],l=t[1],d=t[2],c=0,u=[];c<r.length;c++)o=r[c],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&u.push(n[o][0]),n[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);for(h&&h(t);u.length;)u.shift()();return a.push.apply(a,d||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],i=!0,r=1;r<s.length;r++){var l=s[r];0!==n[l]&&(i=!1)}i&&(a.splice(t--,1),e=o(o.s=s[0]))}return e}var i={},n={0:0},a=[];function o(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=i,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(s,i,function(t){return e[t]}.bind(null,i));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var r=window.webpackJsonp=window.webpackJsonp||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var d=0;d<r.length;d++)t(r[d]);var h=l;a.push([11,1]),s()}({11:function(e,t,s){"use strict";s.r(t);var i=navigator.userAgent.includes("jsdom");async function n(e){if(i){const t=s(2),i=s(3).promisify(t.readFile);return await i(e).then(e=>e.toString())}return await fetch(e).then(e=>e.text())}let a=null;class o{constructor(){}reset(){throw new Error(`The class '${this.constructor.name}' must implement the reset() method.`)}get jsonPropertyNames(){return[]}fromOpen5e(e){throw new Error(`The class '${this.constructor.name}' must implement the fromOpen5e() method.`)}fromJson(e){this.reset();for(const t of this.jsonPropertyNames)t in e&&(this[t]=e[t])}toJson(){const e={};for(const t of this.jsonPropertyNames)t in this&&(e[t]=this[t]);return e}toHtml(){throw new Error(`The class '${this.constructor.name}' must implement the toHtml() method.`)}toMarkdown(){throw new Error(`The class '${this.constructor.name}' must implement the toMarkdown() method.`)}}class r extends o{constructor(){super(),this.reset()}reset(){this.fullName="Commoner",this.shortName="",this.isProperNoun=!1}get jsonPropertyNames(){return["fullName","shortName","isProperNoun"]}get grammaticalFullName(){return this.grammaticize(this.fullName)}get grammaticalShortName(){return this.grammaticize(this.shortName)}get grammaticalName(){return""!==this.shortName?this.grammaticalShortName:this.grammaticalFullName}grammaticize(e){return this.isProperNoun?e:`the ${e.toLowerCase()}`}fromOpen5e(e){this.reset(),this.fullName=e.name}toParserOptions(){return{name:this.grammaticalName,fullName:this.grammaticalFullName}}toHtml(){const e=document.createElement("h1");return e.textContent=this.fullName,e}toMarkdown(){return`> ## ${this.fullName}`}}var l={Tiny:4,Small:6,Medium:8,Large:10,Huge:12,Gargantuan:20},d=["aberration","beast","celestial","construct","dragon","elemental","fey","fiend","giant","humanoid","monstrosity","ooze","plant","undead"],h=["unaligned","any alignment","lawful good","neutral good","chaotic good","lawful neutral","neutral","chaotic neutral","lawful evil","neutral evil","chaotic evil"];class c extends o{constructor(){super(),this.reset()}reset(){this.size="Medium",this.type="humanoid",this.tags="any race",this.alignment="any alignment",this.useCustomText=!1,this.customText=""}get jsonPropertyNames(){return["size","type","tags","alignment","useCustomText","customText"]}get text(){return this.useCustomText?this.customText:c.constructText(this.size,this.type,this.tags,this.alignment)}static constructText(e,t,s,i){return""===s?`${e} ${t}, ${i}`:`${e} ${t} (${s}), ${i}`}fromOpen5e(e){this.reset();const t=e.size,s=e.type,i=e.subtype.trim(),n=e.alignment;Object.keys(l).includes(t)&&d.includes(s)&&h.includes(n)?(this.size=t,this.type=s,this.tags=i,this.alignment=n):(this.useCustomText=!0,this.customText=c.constructText(t,s,i,n))}toHtml(){const e=document.createElement("h2");return e.textContent=this.text,e}toMarkdown(){return`>*${this.text}*`}}const u=s(7);class m{constructor(e,t,s){this.clipboard=new u(s,{container:t,text:function(){return e}})}setSuccessCallback(e){this.clipboard.on("success",e)}setErrorCallback(e){this.clipboard.on("error",e)}destroy(){this.clipboard.destroy()}}function p(e,t,s){const i=document.createElement("h4"),n=document.createElement("p");return i.textContent=t,n.innerHTML=s,e.appendChild(i),e.appendChild(n),e}class g extends o{constructor(e){super(),this.headingName=e}get text(){throw new Error(`The class '${this.constructor.name}' must implement the text() method.`)}get htmlText(){throw new Error(`The class '${this.constructor.name}' must implement the htmlText() method.`)}toHtml(){return e=this.headingName,t=this.htmlText,p(document.createElement("property-line"),e,t);var e,t}toMarkdown(){return e=this.headingName,t=this.text,`> - **${e}** ${t}`;var e,t}}class b extends g{constructor(){super("Armor Class"),this.reset()}reset(){this.armorClass=10,this.armorType="",this.hasShield=!1,this.useCustomText=!1,this.customText="",this.htmlCustomText=""}get jsonPropertyNames(){return["armorClass","armorType","hasShield","useCustomText","customText"]}get text(){return this.useCustomText?this.customText:this.normalText}get htmlText(){return this.useCustomText?this.htmlCustomText:this.normalText}get normalText(){return this.armorType?this.hasShield?`${this.armorClass} (${this.armorType}, shield)`:`${this.armorClass} (${this.armorType})`:this.hasShield?`${this.armorClass} (shield)`:this.armorClass}fromOpen5e(e){this.reset();const t=e.armor_class,s=null===e.armor_desc?"":e.armor_desc;if(s.includes("*")||s.includes("_"))this.useCustomText=!0,this.customText=`${t} (${s})`;else if(s.includes("(")||s.includes(")"))this.useCustomText=!0,this.customText=s;else{const e=/,*\s*[and]*\s*shield/,i=s.match(e);if(null!==i){const e=i.index;this.armorType=s.slice(0,e),this.hasShield=!0}else this.armorType=s,this.hasShield=!1;this.armorClass=t}}}function f(e){return e.charAt(0).toUpperCase()+e.slice(1)}function y(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function E(e){return`${v(e)}${x(e)}`}function v(e){return e<0?"–":"+"}function x(e){return e<0?Math.abs(e).toString():e.toString()}function w(e){const t=parseInt(e,10);return isNaN(t)?null:t}class k extends g{constructor(e){super("Hit Points"),this.abilities=e,this.reset()}reset(){this._hitPoints=4,this.useHitDie=!0,this.hitDieQuantity=1,this.hitDieSize=8}get jsonPropertyNames(){return["hitPoints","useHitDie","hitDieQuantity","hitDieSize"]}get hitDieAverage(){return this.hitDieSize/2+.5}get constitutionHitPoints(){const e=this.abilities.abilities.constitution.modifier;return this.hitDieQuantity*e}set hitPoints(e){this._hitPoints=e}get hitPoints(){if(this.useHitDie){const e=Math.floor(this.hitDieQuantity*this.hitDieAverage)+this.constitutionHitPoints;this._hitPoints=Math.max(0,e)}return this._hitPoints}get text(){return this.useHitDie?this.textWithHitDie:this.hitPoints}get htmlText(){return this.text}get textWithHitDie(){return 0!=this.constitutionHitPoints?`${this.hitPoints} (${this.hitDieQuantity}d${this.hitDieSize} ${this.constitutionHitPointsText})`:`${this.hitPoints} (${this.hitDieQuantity}d${this.hitDieSize})`}get constitutionHitPointsText(){const e=this.constitutionHitPoints;return`${v(e)} ${x(e)}`}fromOpen5e(e){this.reset();const t=e.hit_dice.split(/[+d]/);this.useHitDie=!0,this.hitDieQuantity=w(t[0]),this.hitDieSize=w(t[1])}}class C extends g{constructor(){super("Speed"),this.reset()}reset(){this.walk=30,this.burrow=null,this.climb=null,this.fly=null,this.hover=!1,this.swim=null,this.useCustomText=!1,this.customText="",this.htmlCustomText=""}get jsonPropertyNames(){return["walk","burrow","climb","fly","hover","swim","useCustomText","customText"]}get text(){return this.useCustomText?this.customText:this.normalText}get htmlText(){return this.useCustomText?this.htmlCustomText:this.normalText}get normalText(){const e=[],t=this.walk?this.walk:0;if(e.push(`${t} ft.`),null!=this.burrow&&e.push(`burrow ${this.burrow} ft.`),null!=this.climb&&e.push(`climb ${this.climb} ft.`),null!=this.fly){const t=this.hover?" (hover)":"";e.push(`fly ${this.fly} ft.${t}`)}return null!=this.swim&&e.push(`swim ${this.swim} ft.`),e.join(", ")}fromOpen5e(e){this.reset(),"walk"in e.speed?this.walk=e.speed.walk:this.walk=null,"burrow"in e.speed&&(this.burrow=e.speed.burrow),"climb"in e.speed&&(this.climb=e.speed.climb),"fly"in e.speed&&(this.fly=e.speed.fly),"hover"in e.speed&&(this.hover=e.speed.hover),"swim"in e.speed&&(this.swim=e.speed.swim),"notes"in e.speed&&(this.useCustomText=!0,this.customText=`${this.normalText} (${e.speed.notes})`)}}class S extends o{constructor(){super(),this.abilities={strength:new T("strength","str"),dexterity:new T("dexterity","dex"),constitution:new T("constitution","con"),intelligence:new T("intelligence","int"),wisdom:new T("wisdom","wis"),charisma:new T("charisma","cha")},Object.freeze(this.abilities),this.reset()}reset(){for(const e of Object.values(this.abilities))e.reset()}get keys(){return Object.keys(this.abilities)}get values(){return Object.values(this.abilities)}get entries(){return Object.entries(this.abilities)}toParserOptions(){const e=this.entries.map(([e,t])=>[e,t.toParserOptions()]);return Object.fromEntries(e)}fromOpen5e(e){this.reset();for(const[t,s]of this.entries)s.fromOpen5e(e[t])}fromJson(e){this.reset();for(const[t,s]of this.entries)s.fromJson(e[t])}toJson(){const e=this.entries.map(([e,t])=>[e,t.toJson()]);return Object.fromEntries(e)}toHtml(){const e=document.createElement("abilities-block");for(const t of this.values){const s=t.abbreviation;e.dataset[s]=t.score}return e}toMarkdown(){return`>|STR|DEX|CON|INT|WIS|CHA|\n>|:---:|:---:|:---:|:---:|:---:|:---:|\n>|${this.values.map(e=>`${e.score} ${e.formattedModifier}`).join("|")}|`}}class T{constructor(e,t){this.name=e,this.abbreviation=t,this.reset()}reset(){this.score=10}get modifier(){return Math.floor((this.score-10)/2)}get formattedModifier(){return`(${E(this.modifier)})`}toParserOptions(){return{modifier:this.modifier}}fromOpen5e(e){this.score=e}fromJson(e){this.score=e}toJson(){return this.score}}class M extends g{constructor(e,t){super("Saving Throws");const s=e.keys.map(s=>[s,new B(e.abilities[s],t)]);this.savingThrows=Object.fromEntries(s),Object.freeze(this.savingThrows)}reset(){for(const e of this.values)e.reset()}get keys(){return Object.keys(this.savingThrows)}get values(){return Object.values(this.savingThrows)}get entries(){return Object.entries(this.savingThrows)}get text(){return this.values.filter(e=>e.isEnabled).map(e=>e.text).join(", ")}get htmlText(){return this.text}fromOpen5e(e){this.reset();for(const t of this.values)t.fromOpen5e(e)}fromJson(e){this.reset();for(const[t,s]of this.entries)s.fromJson(e[t])}toJson(){const e=this.entries.map(([e,t])=>[e,t.toJson()]);return Object.fromEntries(e)}}class B{constructor(e,t){this.abilityModel=e,this.challengeRatingModel=t,this.reset()}reset(){this.isEnabled=!1,this.override=null}get text(){return`${f(this.abilityModel.abbreviation)} ${this.formattedModifier}`}get modifier(){let e=this.abilityModel.modifier;if(this.isEnabled){if(null!==this.override)return this.override;e+=this.challengeRatingModel.proficiencyBonus}return e}get formattedModifier(){return E(this.modifier)}fromOpen5e(e){const t=`${this.abilityModel.name}_save`;null!==e[t]?(this.isEnabled=!0,e[t]!==this.abilityModel.modifier+this.challengeRatingModel.proficiencyBonus&&(this.override=e[t])):this.isEnabled=!1}fromJson(e){this.isEnabled=e.isEnabled,this.override=e.override}toJson(){return{isEnabled:this.isEnabled,override:this.override}}}class I extends g{constructor(e,t){super("Skills");const s=e.abilities.strength,i=e.abilities.dexterity,n=e.abilities.intelligence,a=e.abilities.wisdom,o=e.abilities.charisma;this.skills={acrobatics:new D("acrobatics","Acrobatics",i,t),animalHandling:new D("animalHandling","Animal Handling",a,t),arcana:new D("arcana","Arcana",n,t),athletics:new D("athletics","Athletics",s,t),deception:new D("deception","Deception",o,t),history:new D("history","History",n,t),insight:new D("insight","Insight",a,t),intimidation:new D("intimidation","Intimidation",o,t),investigation:new D("investigation","Investigation",n,t),medicine:new D("medicine","Medicine",a,t),nature:new D("nature","Nature",n,t),perception:new D("perception","Perception",a,t),performance:new D("performance","Performance",o,t),persuasion:new D("persuasion","Persuasion",o,t),religion:new D("religion","Religion",n,t),sleightOfHand:new D("sleightOfHand","Sleight of Hand",i,t),stealth:new D("stealth","Stealth",i,t),survival:new D("survival","Survival",a,t)},Object.freeze(this.skills)}reset(){for(const e of this.values)e.reset()}get keys(){return Object.keys(this.skills)}get values(){return Object.values(this.skills)}get entries(){return Object.entries(this.skills)}get text(){return this.values.filter(e=>e.isEnabled).map(e=>e.text).join(", ")}get htmlText(){return this.text}fromOpen5e(e){this.reset();for(const t of this.values)t.fromOpen5e(e)}fromJson(e){this.reset();for(const[t,s]of this.entries)s.fromJson(e[t])}toJson(){const e=this.entries.map(([e,t])=>[e,t.toJson()]);return Object.fromEntries(e)}}class D{constructor(e,t,s,i){this.name=e,this.prettyName=t,this.abilityModel=s,this.challengeRatingModel=i,this.reset()}reset(){this.isEnabled=!1,this.hasExpertise=!1,this.override=null}get text(){return`${this.prettyName} ${this.formattedModifier}`}get passiveScore(){let e=10+this.abilityModel.modifier;if(this.isEnabled){if(null!==this.override)return e+this.override;e+=this.challengeRatingModel.proficiencyBonus,this.hasExpertise&&(e+=this.challengeRatingModel.proficiencyBonus)}return e}get modifier(){let e=this.abilityModel.modifier;if(this.isEnabled){if(null!==this.override)return this.override;e+=this.challengeRatingModel.proficiencyBonus,this.hasExpertise&&(e+=this.challengeRatingModel.proficiencyBonus)}return e}get formattedModifier(){return E(this.modifier)}fromOpen5e(e){if(this.name in e.skills){this.isEnabled=!0;const t=e.skills[this.name],s=this.abilityModel.modifier+this.challengeRatingModel.proficiencyBonus,i=s+this.challengeRatingModel.proficiencyBonus;if(t===s)return;t===i?this.hasExpertise=!0:this.override=t}else this.isEnabled=!1}fromJson(e){this.isEnabled=e.isEnabled,this.hasExpertise=e.hasExpertise,this.override=e.override}toJson(){return{isEnabled:this.isEnabled,hasExpertise:this.hasExpertise,override:this.override}}}class P extends g{constructor(e,t,s){super(e),this.singleName=t,this.open5eJsonKey=s,this.reset()}reset(){this.clear()}clear(){this.items=[]}get jsonPropertyNames(){return["items"]}get text(){let e="",t=!0,s=!1;for(const i of this.items){const n=i.includes(",");t?(e=i,t=!1):e+=s||n?`; ${i}`:`, ${i}`,s=n}return e}get htmlText(){return this.text}fromOpen5e(e){this.clear();const t=e[this.open5eJsonKey];if(""!==t){const e=t.split(";").map(e=>e.trim());for(const t of e)if(t.includes("bludgeoning, piercing, and slashing"))this.items.push(t);else{const e=t.split(",").map(e=>e.trim()),s=P.mergeUnderstandsButTokens(e);Array.prototype.push.apply(this.items,s)}}}static mergeUnderstandsButTokens(e){let t=null;for(const[s,i]of e.entries())if(null===t&&i.startsWith("understands"))t=s;else if(null!==t&&i.includes("but")){const i=e.slice(t,s+1).join(", ");e.splice(t,s-t+1,i)}return e}}class A extends P{constructor(){super("Damage Vulnerabilities","Damage Vulnerability","damage_vulnerabilities")}}class R extends P{constructor(){super("Damage Resistances","Damage Resistance","damage_resistances")}}class L extends P{constructor(){super("Damage Immunities","Damage Immunity","damage_immunities")}}class N extends P{constructor(){super("Condition Immunities","Condition Immunity","condition_immunities")}}class z extends g{constructor(e){super("Senses"),this.skills=e,this.reset()}reset(){this.blindsight=null,this.blindBeyondThisRadius=!1,this.darkvision=null,this.tremorsense=null,this.truesight=null,this.useCustomText=!1,this.customText="",this.htmlCustomText=""}get jsonPropertyNames(){return["blindsight","blindBeyondThisRadius","darkvision","tremorsense","truesight","useCustomText","customText"]}get passivePerception(){return this.skills.skills.perception.passiveScore}get text(){return this.useCustomText?this.customText:this.normalText}get htmlText(){return this.useCustomText?this.htmlCustomText:this.normalText}get normalText(){const e=[];if(null!=this.blindsight){const t=this.blindBeyondThisRadius?" (blind beyond this radius)":"";e.push(`blindsight ${this.blindsight} ft.${t}`)}return null!=this.darkvision&&e.push(`darkvision ${this.darkvision} ft.`),null!=this.tremorsense&&e.push(`tremorsense ${this.tremorsense} ft.`),null!=this.truesight&&e.push(`truesight ${this.truesight} ft.`),e.push(`passive Perception ${this.passivePerception}`),e.join(", ")}fromOpen5e(e){this.reset();const t=e.senses,s={};let i=!1;if(t.includes("*")||t.includes("_"))i=!0;else{const e=/^(?<category>blindsight|darkvision|tremorsense|truesight)\s(?<range>\d+)\sft\.(?<blindBeyondThisRadius>\s\(blind beyond this radius\))*$/,n=t.split(",");for(const t of n.map(e=>e.trim())){if(t.includes("passive Perception"))continue;const n=t.match(e);if(null===n){i=!0;break}{const e=n.groups.category,t=n.groups.range,i=" (blind beyond this radius)"===n.groups.blindBeyondThisRadius;s[e]=w(t),i&&(s.blindBeyondThisRadius=!0)}}}i?(this.useCustomText=!0,this.customText=t):Object.assign(this,s)}}class H extends P{constructor(){super("Languages","Language","languages")}reset(){this.clear(),this.items=["any one language (usually Common)"]}clear(){super.clear(),this.telepathy=null}get text(){let e=super.text;return null!==this.telepathy&&(""!==e&&(e+=", "),e+=`telepathy ${this.telepathy} ft.`),""===e&&(e="—"),e}fromOpen5e(e){super.fromOpen5e(e);const t=/(?<=^telepathy )\d+(?= ft\.$)/,s=this.items.findIndex(e=>t.test(e));if(s>=0){const e=this.items.splice(s,1)[0].match(t)[0];this.telepathy=w(e)}}fromJson(e){super.fromJson(e),this.telepathy=e.telepathy}toJson(){const e=super.toJson();return e.telepathy=this.telepathy,e}}var $={0:10,"1/8":25,"1/4":50,"1/2":100,1:200,2:450,3:700,4:1100,5:1800,6:2300,7:2900,8:3900,9:5e3,10:5900,11:7200,12:8400,13:1e4,14:11500,15:13e3,16:15e3,17:18e3,18:2e4,19:22e3,20:25e3,21:33e3,22:41e3,23:5e4,24:62e3,25:75e3,26:9e4,27:105e3,28:12e4,29:135e3,30:155e3},O={0:2,"1/8":2,"1/4":2,"1/2":2,1:2,2:2,3:2,4:2,5:3,6:3,7:3,8:3,9:4,10:4,11:4,12:4,13:5,14:5,15:5,16:5,17:6,18:6,19:6,20:6,21:7,22:7,23:7,24:7,25:8,26:8,27:8,28:8,29:9,30:9};class F extends g{constructor(){super("Challenge"),this.reset()}reset(){this.challengeRating="0",this.experiencePoints=10,this.proficiencyBonus=2}get jsonPropertyNames(){return["challengeRating","experiencePoints","proficiencyBonus"]}updateExperiencePointsAndProficiencyBonusFromChallengeRating(){this.experiencePoints=$[this.challengeRating],this.proficiencyBonus=O[this.challengeRating]}get text(){const e=this.experiencePoints.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,");return`${this.challengeRating} (${e} XP)`}get htmlText(){return this.text}toParserOptions(){return this.proficiencyBonus}fromOpen5e(e){this.reset(),this.challengeRating=e.challenge_rating,this.updateExperiencePointsAndProficiencyBonusFromChallengeRating()}}class V{constructor(e,t,s="",i=""){this.name=e,this.text=t,this.markdownText=s,this.htmlText=i}toJson(){return{name:this.name,text:this.text}}toHtml(){return e=this.name,t=this.htmlText,p(document.createElement("property-block"),`${e}.`,t);var e,t}toMarkdown(){return e=this.name,t=this.markdownText,`> ***${e}.*** ${t}`;var e,t}}class _ extends o{constructor(e,t,s,i=V){super(),this.headingName=e,this.singleName=t,this.open5eJsonKey=s,this.blockModel=i,this.blocks=[],this.reset()}reset(){this.clear()}clear(){this.blocks.length=0}fromOpen5e(e){this.clear();const t=e[this.open5eJsonKey];if(""!==t)for(const e of t){const t=e.name,s=_.parseOpen5eBlockDescription(e.desc),i=new this.blockModel(t,s);this.blocks.push(i)}}static parseOpen5eBlockDescription(e){return e=(e=e.replace(/(?<=\.)\s*\n(?=\w)/g,"\n  ")).replace(/ *• */g,"")}fromJson(e){this.clear();for(const t of e.blocks){const e=new this.blockModel(t.name,t.text);this.blocks.push(e)}}toJson(){return{blocks:this.blocks.map(e=>e.toJson())}}toHtml(){const e=document.createDocumentFragment();if(this.headingName){const t=document.createElement("h3");t.textContent=this.headingName,e.appendChild(t)}for(const t of this.blocks)e.appendChild(t.toHtml());return e}toMarkdown(){return`${this.headingName?`> ### ${this.headingName}\n`:""}${this.blocks.map(e=>e.toMarkdown()).join("\n>\n")}`}}class J extends _{constructor(){super(null,"Special Trait","special_abilities")}}class j extends _{constructor(){super("Actions","Action","actions")}reset(){if(i)this.blocks=[];else{const e=new V("Club","*Melee Weapon Attack:* atk[str] to hit, reach 5 ft., one target. *Hit:* dmg[1d4 + str] bludgeoning damage.","*Melee Weapon Attack:* +2 to hit, reach 5 ft., one target. *Hit:* 2 (1d4) bludgeoning damage.","<em>Melee Weapon Attack:</em> +2 to hit, reach 5 ft., one target. <em>Hit:</em> 2 (1d4) bludgeoning damage.");this.blocks=[e]}}}class G extends _{constructor(){super("Reactions","Reaction","reactions")}}class Q extends V{constructor(e,t,s,i){super(e,t,s,i)}toHtml(){return e=this.name,t=this.htmlText,p(document.createElement("legendary-property-block"),`${e}.`,t);var e,t}}class W extends _{constructor(){super("Legendary Actions","Legendary Action","legendary_actions",Q)}reset(){super.reset(),this.resetDescription()}resetDescription(){this.description="[name] can take 3 legendary actions, choosing from the options below. Only one legendary action option can be used at a time and only at the end of another creature's turn. [name] regains spent legendary actions at the start of its turn.",this.markdownDescription="",this.htmlDescription=""}fromOpen5e(e){super.fromOpen5e(e),this.resetDescription();const t=e.legendary_desc;""!==t&&(this.description=t)}fromJson(e){super.fromJson(e),this.description=e.description}toJson(){const e=super.toJson();return e.description=this.description,e}toHtml(){const e=super.toHtml(),t=e.querySelector("legendary-property-block"),s=document.createElement("p");return s.innerHTML=this.htmlDescription,e.insertBefore(s,t),e}toMarkdown(){return`${`> ### ${this.headingName}\n`}${`> ${this.markdownDescription}\n`}${this.blocks.map(e=>e.toMarkdown()).join("\n>\n")}`}}class q{constructor(){this.abilities=new S,this.challengeRating=new F,this.title=new r,this.subtitle=new c,this.armorClass=new b,this.hitPoints=new k(this.abilities),this.speed=new C,this.savingThrows=new M(this.abilities,this.challengeRating),this.skills=new I(this.abilities,this.challengeRating),this.damageVulnerabilities=new A,this.damageResistances=new R,this.damageImmunities=new L,this.conditionImmunities=new N,this.senses=new z(this.skills),this.languages=new H,this.specialTraits=new J,this.actions=new j,this.reactions=new G,this.legendaryActions=new W}reset(){this.title.reset(),this.subtitle.reset(),this.armorClass.reset(),this.hitPoints.reset(),this.speed.reset(),this.abilities.reset(),this.savingThrows.reset(),this.skills.reset(),this.damageVulnerabilities.reset(),this.damageResistances.reset(),this.damageImmunities.reset(),this.conditionImmunities.reset(),this.senses.reset(),this.languages.reset(),this.challengeRating.reset(),this.specialTraits.reset(),this.actions.reset(),this.reactions.reset(),this.legendaryActions.reset()}}class U{constructor(){this.reset()}reset(){this.columns=1,this.twoColumnMode="auto",this.twoColumnHeight=600}fromJson(e){this.columns=e.columns,this.twoColumnMode=e.twoColumnMode,this.twoColumnHeight=e.twoColumnHeight}toJson(){return{columns:this.columns,twoColumnMode:this.twoColumnMode,twoColumnHeight:this.twoColumnHeight}}}class K{constructor(){this.version="0.0.0",this.emptySectionsVisibility=!0,this.gettingStartedVisibility=!0}}var Y=new class{constructor(){this.creature=new q,this.layoutSettings=new U,this.localSettings=new K}reset(){this.creature.reset(),this.layoutSettings.reset()}};function X(e,t){for(const s in t){let i=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,i)}}var Z=new class{constructor(){this.mixins=new Map}define(e,t){this.mixins.set(e,t)}applyToElement(e){const t=e.getAttribute("is");if(t){const s=this.mixins.get(t);s&&(X(e,s),e.initializeMixin())}}},ee=function(){function e(t,s,i,n){this.message=t,this.expected=s,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function s(){this.constructor=e}s.prototype=t.prototype,e.prototype=new s}(e,Error),e.buildMessage=function(e,t){var s={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,s="";for(t=0;t<e.parts.length;t++)s+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+s+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}return"Expected "+function(e){var t,i,n,a=new Array(e.length);for(t=0;t<e.length;t++)a[t]=(n=e[t],s[n.type](n));if(a.sort(),a.length>0){for(t=1,i=1;t<a.length;t++)a[t-1]!==a[t]&&(a[i]=a[t],i++);a.length=i}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,s){s=void 0!==s?s:{};var i,n={},a={start:P},o=P,r=function(e,t,s){return`${e}${t}${s}`},l=T("[name]",!1),d="[fullname]",h=T("[fullname]",!1),c={type:"any"},u=T("(",!1),m=T(")",!1),p=T("*",!1),g=T("_",!1),b=T("\n",!1),f=T("\r",!1),y=T(" ",!1),E=T("\t",!1),v=T(".",!1),x=0,w=[{line:1,column:1}],k=0,C=[],S=0;if("startRule"in s){if(!(s.startRule in a))throw new Error("Can't start parsing from rule \""+s.startRule+'".');o=a[s.startRule]}function T(e,t){return{type:"literal",text:e,ignoreCase:t}}function M(e){var s,i=w[e];if(i)return i;for(s=e-1;!w[s];)s--;for(i={line:(i=w[s]).line,column:i.column};s<e;)10===t.charCodeAt(s)?(i.line++,i.column=1):i.column++,s++;return w[e]=i,i}function B(e,t){var s=M(e),i=M(t);return{start:{offset:e,line:s.line,column:s.column},end:{offset:t,line:i.line,column:i.column}}}function I(e){x<k||(x>k&&(k=x,C=[]),C.push(e))}function D(t,s,i){return new e(e.buildMessage(t,s),t,s,i)}function P(){var e,t,s;if(e=x,t=[],(s=A())!==n)for(;s!==n;)t.push(s),s=A();else t=n;return t!==n&&(e,t=t.join("")),(e=t)===n&&(e=x,(t=j())!==n&&(e,t=""),e=t),e}function A(){var e;return(e=V())===n&&(e=function(){var e,s,i,a,o;if(e=x,(s=function(){var e,s,i;e=x,s=[],i=_();for(;i!==n;)s.push(i),i=_();e=s!==n?t.substring(e,x):s;return e}())!==n)if((i=function(){var e;(e=N())===n&&(e=L());return e}())!==n){for(a=[],o=R();o!==n;)a.push(o),o=R();a!==n&&(o=function(){var e;(e=V())===n&&(e=j());return e}())!==n?(e,r=o,s=`${s}${i}${a.join("")}${r||""}`,e=s):(x=e,e=n)}else x=e,e=n;else x=e,e=n;var r;return e}()),e}function R(){var e;return(e=function(){var e,s,i,a,o;e=x,(s=J())!==n&&(i=function(){var e,s,i;e=x,s=[],i=F();for(;i!==n;)s.push(i),i=F();e=s!==n?t.substring(e,x):s;return e}())!==n&&(a=z())!==n&&(o=N())!==n?(e,e=s=`${s}${i}${a}${o}`):(x=e,e=n);return e}())===n&&(e=function(){var e,i,a,o;e=x,(i=H())!==n?((a=function(){var e,i;e=x,"[name]"===t.substr(x,6)?(i="[name]",x+=6):(i=n,0===S&&I(l));i!==n&&(e,i=s.creature.name);return e=i}())===n&&(a=function(){var e,i;e=x,t.substr(x,10)===d?(i=d,x+=10):(i=n,0===S&&I(h));i!==n&&(e,i=s.creature.fullName);return e=i}()),a!==n&&(o=$())!==n?(e,i=r(i,a,o),e=i):(x=e,e=n)):(x=e,e=n);return e}())===n&&(e=L()),e}function L(){var e;return(e=function(){var e,s,i;if(e=x,s=[],(i=O())!==n)for(;i!==n;)s.push(i),i=O();else s=n;e=s!==n?t.substring(e,x):s;return e}())===n&&(e=z())===n&&(e=J()),e}function N(){var e,i,a,o;return e=x,(i=H())!==n?((a=function(){var e,i;e=x,"[name]"===t.substr(x,6)?(i="[name]",x+=6):(i=n,0===S&&I(l));i!==n&&(e,i=G(s.creature.name));return e=i}())===n&&(a=function(){var e,i;e=x,t.substr(x,10)===d?(i=d,x+=10):(i=n,0===S&&I(h));i!==n&&(e,i=G(s.creature.fullName));return e=i}()),a!==n&&(o=$())!==n?(e,e=i=r(i,a,o)):(x=e,e=n)):(x=e,e=n),e}function z(){var e,s,i;if(e=x,s=[],(i=_())!==n)for(;i!==n;)s.push(i),i=_();else s=n;return e=s!==n?t.substring(e,x):s}function H(){var e,s;return e=x,(s=function(){var e;40===t.charCodeAt(x)?(e="(",x++):(e=n,0===S&&I(u));return e}())===n&&(s=null),e=s!==n?t.substring(e,x):s}function $(){var e,s;return e=x,(s=function(){var e;41===t.charCodeAt(x)?(e=")",x++):(e=n,0===S&&I(m));return e}())===n&&(s=null),e=s!==n?t.substring(e,x):s}function O(){var e,s,i;return e=x,s=x,S++,(i=J())===n&&(i=_())===n&&(i=V()),S--,i===n?s=void 0:(x=s,s=n),s!==n?(t.length>x?(i=t.charAt(x),x++):(i=n,0===S&&I(c)),i!==n?e=s=[s,i]:(x=e,e=n)):(x=e,e=n),e}function F(){var e;return 42===t.charCodeAt(x)?(e="*",x++):(e=n,0===S&&I(p)),e===n&&(95===t.charCodeAt(x)?(e="_",x++):(e=n,0===S&&I(g))),e}function V(){var e,s,i,a;return 10===t.charCodeAt(x)?(e="\n",x++):(e=n,0===S&&I(b)),e===n&&(e=x,s=x,13===t.charCodeAt(x)?(i="\r",x++):(i=n,0===S&&I(f)),i!==n?(10===t.charCodeAt(x)?(a="\n",x++):(a=n,0===S&&I(b)),a===n&&(a=null),a!==n?s=i=[i,a]:(x=s,s=n)):(x=s,s=n),e=s!==n?t.substring(e,x):s),e}function _(){var e;return 32===t.charCodeAt(x)?(e=" ",x++):(e=n,0===S&&I(y)),e===n&&(9===t.charCodeAt(x)?(e="\t",x++):(e=n,0===S&&I(E))),e}function J(){var e;return 46===t.charCodeAt(x)?(e=".",x++):(e=n,0===S&&I(v)),e}function j(){var e,s;return e=x,S++,t.length>x?(s=t.charAt(x),x++):(s=n,0===S&&I(c)),S--,s===n?e=void 0:(x=e,e=n),e}function G(e){return e.charAt(0).toUpperCase()+e.slice(1)}if((i=o())!==n&&x===t.length)return i;throw i!==n&&x<t.length&&I({type:"end"}),D(C,k<t.length?t.charAt(k):null,k<t.length?B(k,k+1):B(k,k))}}}(),te=function(){function e(t,s,i,n){this.message=t,this.expected=s,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function s(){this.constructor=e}s.prototype=t.prototype,e.prototype=new s}(e,Error),e.buildMessage=function(e,t){var s={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,s="";for(t=0;t<e.parts.length;t++)s+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+s+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}return"Expected "+function(e){var t,i,n,a=new Array(e.length);for(t=0;t<e.length;t++)a[t]=(n=e[t],s[n.type](n));if(a.sort(),a.length>0){for(t=1,i=1;t<a.length;t++)a[t-1]!==a[t]&&(a[i]=a[t],i++);a.length=i}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,s){s=void 0!==s?s:{};var i,n={},a={start:Q},o=Q,r=V("sdc",!1),l=V("[",!1),d=V("]",!1),h=V("dmg",!1),c=function(e,t){const s=ne(t),i=function(e){if(0!==e){const t=re(e),s=le(e);return` ${t} ${s}`}return""}(s);return`${oe(e.average+s)} (${`${e.text}${i}`})`},u=V("atk",!1),m=V("mod",!1),p=V("+",!1),g=V("-",!1),b=/^[0-9]/,f={type:"class",parts:[["0","9"]],inverted:!1,ignoreCase:!1},y=V("d",!1),E=V("fin",!1),v=V("str",!1),x=V("dex",!1),w=V("con",!1),k=V("int",!1),C=V("wis",!1),S=V("cha",!1),T=V("prof",!1),M=function(){return parseInt(t.substring(z,N),10)},B={type:"any"},I=V("(",!1),D=V(")",!1),P=V("\n",!1),A=V("\r",!1),R=V(" ",!1),L=V("\t",!1),N=(V(".",!1),0),z=0,H=[{line:1,column:1}],$=0,O=[],F=0;if("startRule"in s){if(!(s.startRule in a))throw new Error("Can't start parsing from rule \""+s.startRule+'".');o=a[s.startRule]}function V(e,t){return{type:"literal",text:e,ignoreCase:t}}function _(e){var s,i=H[e];if(i)return i;for(s=e-1;!H[s];)s--;for(i={line:(i=H[s]).line,column:i.column};s<e;)10===t.charCodeAt(s)?(i.line++,i.column=1):i.column++,s++;return H[e]=i,i}function J(e,t){var s=_(e),i=_(t);return{start:{offset:e,line:s.line,column:s.column},end:{offset:t,line:i.line,column:i.column}}}function j(e){N<$||(N>$&&($=N,O=[]),O.push(e))}function G(t,s,i){return new e(e.buildMessage(t,s),t,s,i)}function Q(){var e,t,s;if(e=N,t=[],(s=W())!==n)for(;s!==n;)t.push(s),s=W();else t=n;return t!==n&&(z=e,t=t.join("")),(e=t)===n&&(e=N,(t=ie())!==n&&(z=e,t=""),e=t),e}function W(){var e;return(e=te())===n&&(e=function(){var e,t,s;if(e=N,t=[],(s=q())!==n)for(;s!==n;)t.push(s),s=q();else t=n;t!==n&&(s=function(){var e;(e=te())===n&&(e=ie());return e}())!==n?(z=e,i=s,t=`${t.join("")}${i||""}`,e=t):(N=e,e=n);var i;return e}()),e}function q(){var e;return(e=function(){var e,i,a,o;e=N,(i=function(){var e,s;e=N,(s=function(){var e;40===t.charCodeAt(N)?(e="(",N++):(e=n,0===F&&j(I));return e}())===n&&(s=null);e=s!==n?t.substring(e,N):s;return e}())!==n&&(a=function(){var e;(e=function(){var e,i,a,o,h,c,u,m,p,g,b;e=N,"sdc"===t.substr(N,3)?(i="sdc",N+=3):(i=n,0===F&&j(r));if(i!==n)if(91===t.charCodeAt(N)?(a="[",N++):(a=n,0===F&&j(l)),a!==n){for(o=[],h=se();h!==n;)o.push(h),h=se();if(o!==n)if((h=Z())!==n){for(c=[],u=N,m=[],p=se();p!==n;)m.push(p),p=se();if(m!==n)if((p=K())!==n){for(g=[],b=se();b!==n;)g.push(b),b=se();g!==n&&(b=Y())!==n?u=m=[m,p,g,b]:(N=u,u=n)}else N=u,u=n;else N=u,u=n;for(;u!==n;){for(c.push(u),u=N,m=[],p=se();p!==n;)m.push(p),p=se();if(m!==n)if((p=K())!==n){for(g=[],b=se();b!==n;)g.push(b),b=se();g!==n&&(b=Y())!==n?u=m=[m,p,g,b]:(N=u,u=n)}else N=u,u=n;else N=u,u=n}if(c!==n){for(u=[],m=se();m!==n;)u.push(m),m=se();u!==n?(93===t.charCodeAt(N)?(m="]",N++):(m=n,0===F&&j(d)),m!==n?(z=e,i=function(e,t){const i=ne(t);return 8+e+s.proficiencyBonus+i}(h,c),e=i):(N=e,e=n)):(N=e,e=n)}else N=e,e=n}else N=e,e=n;else N=e,e=n}else N=e,e=n;else N=e,e=n;return e}())===n&&(e=function(){var e,s,i,a,o,r,u,m,p,g,E;e=N,"dmg"===t.substr(N,3)?(s="dmg",N+=3):(s=n,0===F&&j(h));if(s!==n)if(91===t.charCodeAt(N)?(i="[",N++):(i=n,0===F&&j(l)),i!==n){for(a=[],o=se();o!==n;)a.push(o),o=se();if(a!==n)if((o=function(){var e,s,i,a,o,r;e=N,s=N,i=[],b.test(t.charAt(N))?(a=t.charAt(N),N++):(a=n,0===F&&j(f));for(;a!==n;)i.push(a),b.test(t.charAt(N))?(a=t.charAt(N),N++):(a=n,0===F&&j(f));s=i!==n?t.substring(s,N):i;if(s!==n)if(100===t.charCodeAt(N)?(i="d",N++):(i=n,0===F&&j(y)),i!==n){if(a=N,o=[],b.test(t.charAt(N))?(r=t.charAt(N),N++):(r=n,0===F&&j(f)),r!==n)for(;r!==n;)o.push(r),b.test(t.charAt(N))?(r=t.charAt(N),N++):(r=n,0===F&&j(f));else o=n;(a=o!==n?t.substring(a,N):o)!==n?(z=e,s=function(e,t){e||(e=1);const s=parseInt(e,10),i=parseInt(t,10)/2+.5;return{text:`${e}d${t}`,average:Math.floor(s*i)}}(s,a),e=s):(N=e,e=n)}else N=e,e=n;else N=e,e=n;return e}())!==n){for(r=[],u=N,m=[],p=se();p!==n;)m.push(p),p=se();if(m!==n)if((p=K())!==n){for(g=[],E=se();E!==n;)g.push(E),E=se();g!==n&&(E=Y())!==n?u=m=[m,p,g,E]:(N=u,u=n)}else N=u,u=n;else N=u,u=n;for(;u!==n;){for(r.push(u),u=N,m=[],p=se();p!==n;)m.push(p),p=se();if(m!==n)if((p=K())!==n){for(g=[],E=se();E!==n;)g.push(E),E=se();g!==n&&(E=Y())!==n?u=m=[m,p,g,E]:(N=u,u=n)}else N=u,u=n;else N=u,u=n}if(r!==n){for(u=[],m=se();m!==n;)u.push(m),m=se();u!==n?(93===t.charCodeAt(N)?(m="]",N++):(m=n,0===F&&j(d)),m!==n?(z=e,s=c(o,r),e=s):(N=e,e=n)):(N=e,e=n)}else N=e,e=n}else N=e,e=n;else N=e,e=n}else N=e,e=n;else N=e,e=n;return e}())===n&&(e=function(){var e,i,a,o,r,h,c,m,p,g,b;e=N,"atk"===t.substr(N,3)?(i="atk",N+=3):(i=n,0===F&&j(u));if(i!==n)if(91===t.charCodeAt(N)?(a="[",N++):(a=n,0===F&&j(l)),a!==n){for(o=[],r=se();r!==n;)o.push(r),r=se();if(o!==n)if((r=X())!==n){for(h=[],c=N,m=[],p=se();p!==n;)m.push(p),p=se();if(m!==n)if((p=K())!==n){for(g=[],b=se();b!==n;)g.push(b),b=se();g!==n&&(b=Y())!==n?c=m=[m,p,g,b]:(N=c,c=n)}else N=c,c=n;else N=c,c=n;for(;c!==n;){for(h.push(c),c=N,m=[],p=se();p!==n;)m.push(p),p=se();if(m!==n)if((p=K())!==n){for(g=[],b=se();b!==n;)g.push(b),b=se();g!==n&&(b=Y())!==n?c=m=[m,p,g,b]:(N=c,c=n)}else N=c,c=n;else N=c,c=n}if(h!==n){for(c=[],m=se();m!==n;)c.push(m),m=se();c!==n?(93===t.charCodeAt(N)?(m="]",N++):(m=n,0===F&&j(d)),m!==n?(z=e,i=function(e,t){const i=ne(t);return ae(e+s.proficiencyBonus+i)}(r,h),e=i):(N=e,e=n)):(N=e,e=n)}else N=e,e=n}else N=e,e=n;else N=e,e=n}else N=e,e=n;else N=e,e=n;return e}())===n&&(e=function(){var e,s,i;e=N,"mod"===t.substr(N,3)?(s="mod",N+=3):(s=n,0===F&&j(m));s!==n&&(i=U())!==n?(z=e,s=ae(i),e=s):(N=e,e=n);return e}())===n&&(e=function(){var e,t;e=N,(t=U())!==n&&(z=e,t=oe(t));return e=t}());return e}())!==n&&(o=function(){var e,s;e=N,(s=function(){var e;41===t.charCodeAt(N)?(e=")",N++):(e=n,0===F&&j(D));return e}())===n&&(s=null);e=s!==n?t.substring(e,N):s;return e}())!==n?(z=e,e=i=`${i}${a}${o}`):(N=e,e=n);return e}())===n&&(e=function(){var e,s,i;if(e=N,s=[],(i=ee())!==n)for(;i!==n;)s.push(i),i=ee();else s=n;e=s!==n?t.substring(e,N):s;return e}())===n&&(e=function(){var e,s,i;if(e=N,s=[],(i=se())!==n)for(;i!==n;)s.push(i),i=se();else s=n;e=s!==n?t.substring(e,N):s;return e}()),e}function U(){var e,s,i,a,o,r,h,c,u,m;if(e=N,91===t.charCodeAt(N)?(s="[",N++):(s=n,0===F&&j(l)),s!==n){for(i=[],a=se();a!==n;)i.push(a),a=se();if(i!==n)if((a=Y())!==n){for(o=[],r=N,h=[],c=se();c!==n;)h.push(c),c=se();if(h!==n)if((c=K())!==n){for(u=[],m=se();m!==n;)u.push(m),m=se();u!==n&&(m=Y())!==n?r=h=[h,c,u,m]:(N=r,r=n)}else N=r,r=n;else N=r,r=n;for(;r!==n;){for(o.push(r),r=N,h=[],c=se();c!==n;)h.push(c),c=se();if(h!==n)if((c=K())!==n){for(u=[],m=se();m!==n;)u.push(m),m=se();u!==n&&(m=Y())!==n?r=h=[h,c,u,m]:(N=r,r=n)}else N=r,r=n;else N=r,r=n}if(o!==n){for(r=[],h=se();h!==n;)r.push(h),h=se();r!==n?(93===t.charCodeAt(N)?(h="]",N++):(h=n,0===F&&j(d)),h!==n?(z=e,e=s=ne(o,a)):(N=e,e=n)):(N=e,e=n)}else N=e,e=n}else N=e,e=n;else N=e,e=n}else N=e,e=n;return e}function K(){var e;return 43===t.charCodeAt(N)?(e="+",N++):(e=n,0===F&&j(p)),e===n&&(45===t.charCodeAt(N)?(e="-",N++):(e=n,0===F&&j(g))),e}function Y(){var e;return(e=X())===n&&(e=function(){var e,i;e=N,"prof"===t.substr(N,4)?(i="prof",N+=4):(i=n,0===F&&j(T));i!==n&&(z=e,i=s.proficiencyBonus);return e=i}())===n&&(e=function(){var e,s,i,a;e=N,45===t.charCodeAt(N)?(s="-",N++):(s=n,0===F&&j(g));s===n&&(s=null);if(s!==n){if(i=[],b.test(t.charAt(N))?(a=t.charAt(N),N++):(a=n,0===F&&j(f)),a!==n)for(;a!==n;)i.push(a),b.test(t.charAt(N))?(a=t.charAt(N),N++):(a=n,0===F&&j(f));else i=n;i!==n?(z=e,s=M(),e=s):(N=e,e=n)}else N=e,e=n;return e}()),e}function X(){var e,i;return(e=Z())===n&&(e=N,"fin"===t.substr(N,3)?(i="fin",N+=3):(i=n,0===F&&j(E)),i!==n&&(z=e,i=s.abilities.strength.modifier>=s.abilities.dexterity.modifier?s.abilities.strength.modifier:s.abilities.dexterity.modifier),e=i),e}function Z(){var e,i;return e=N,"str"===t.substr(N,3)?(i="str",N+=3):(i=n,0===F&&j(v)),i!==n&&(z=e,i=s.abilities.strength.modifier),(e=i)===n&&(e=N,"dex"===t.substr(N,3)?(i="dex",N+=3):(i=n,0===F&&j(x)),i!==n&&(z=e,i=s.abilities.dexterity.modifier),(e=i)===n&&(e=N,"con"===t.substr(N,3)?(i="con",N+=3):(i=n,0===F&&j(w)),i!==n&&(z=e,i=s.abilities.constitution.modifier),(e=i)===n&&(e=N,"int"===t.substr(N,3)?(i="int",N+=3):(i=n,0===F&&j(k)),i!==n&&(z=e,i=s.abilities.intelligence.modifier),(e=i)===n&&(e=N,"wis"===t.substr(N,3)?(i="wis",N+=3):(i=n,0===F&&j(C)),i!==n&&(z=e,i=s.abilities.wisdom.modifier),(e=i)===n&&(e=N,"cha"===t.substr(N,3)?(i="cha",N+=3):(i=n,0===F&&j(S)),i!==n&&(z=e,i=s.abilities.charisma.modifier),e=i))))),e}function ee(){var e,s,i;return e=N,s=N,F++,(i=se())===n&&(i=te()),F--,i===n?s=void 0:(N=s,s=n),s!==n?(t.length>N?(i=t.charAt(N),N++):(i=n,0===F&&j(B)),i!==n?e=s=[s,i]:(N=e,e=n)):(N=e,e=n),e}function te(){var e,s,i,a;return 10===t.charCodeAt(N)?(e="\n",N++):(e=n,0===F&&j(P)),e===n&&(e=N,s=N,13===t.charCodeAt(N)?(i="\r",N++):(i=n,0===F&&j(A)),i!==n?(10===t.charCodeAt(N)?(a="\n",N++):(a=n,0===F&&j(P)),a===n&&(a=null),a!==n?s=i=[i,a]:(N=s,s=n)):(N=s,s=n),e=s!==n?t.substring(e,N):s),e}function se(){var e;return 32===t.charCodeAt(N)?(e=" ",N++):(e=n,0===F&&j(R)),e===n&&(9===t.charCodeAt(N)?(e="\t",N++):(e=n,0===F&&j(L))),e}function ie(){var e,s;return e=N,F++,t.length>N?(s=t.charAt(N),N++):(s=n,0===F&&j(B)),F--,s===n?e=void 0:(N=e,e=n),e}function ne(e,t=0){return e.reduce((e,t)=>{const s=t[1],i=t[3];return"+"===s?e+i:"-"===s?e-i:void 0},t)}function ae(e){return`${re(e)}${le(e)}`}function oe(e){if(e<0){return`${re(e)}${le(e)}`}return e.toString()}function re(e){return e<0?"–":"+"}function le(e){return e<0?Math.abs(e).toString():e.toString()}if((i=o())!==n&&N===t.length)return i;throw i!==n&&N<t.length&&j({type:"end"}),G(O,$<t.length?t.charAt($):null,$<t.length?J($,$+1):J($,$))}}}(),se=function(){function e(t,s,i,n){this.message=t,this.expected=s,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function s(){this.constructor=e}s.prototype=t.prototype,e.prototype=new s}(e,Error),e.buildMessage=function(e,t){var s={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,s="";for(t=0;t<e.parts.length;t++)s+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+s+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}return"Expected "+function(e){var t,i,n,a=new Array(e.length);for(t=0;t<e.length;t++)a[t]=(n=e[t],s[n.type](n));if(a.sort(),a.length>0){for(t=1,i=1;t<a.length;t++)a[t-1]!==a[t]&&(a[i]=a[t],i++);a.length=i}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,s){s=void 0!==s?s:{};var i,n={},a={start:B},o=B,r=k("**",!1),l=function(e){return`<strong>${e.join("")}</strong>`},d=k("__",!1),h=k("*",!1),c=function(e){return`<em>${e.join("")}</em>`},u=k("_",!1),m={type:"any"},p=k("\n",!1),g=k("\r",!1),b=k(" ",!1),f=k("\t",!1),y=0,E=[{line:1,column:1}],v=0,x=[],w=0;if("startRule"in s){if(!(s.startRule in a))throw new Error("Can't start parsing from rule \""+s.startRule+'".');o=a[s.startRule]}function k(e,t){return{type:"literal",text:e,ignoreCase:t}}function C(e){var s,i=E[e];if(i)return i;for(s=e-1;!E[s];)s--;for(i={line:(i=E[s]).line,column:i.column};s<e;)10===t.charCodeAt(s)?(i.line++,i.column=1):i.column++,s++;return E[e]=i,i}function S(e,t){var s=C(e),i=C(t);return{start:{offset:e,line:s.line,column:s.column},end:{offset:t,line:i.line,column:i.column}}}function T(e){y<v||(y>v&&(v=y,x=[]),x.push(e))}function M(t,s,i){return new e(e.buildMessage(t,s),t,s,i)}function B(){var e,t,s;if(e=y,t=[],(s=I())!==n)for(;s!==n;)t.push(s),s=I();else t=n;return t!==n&&(e,t=t.join("")),(e=t)===n&&(e=y,(t=z())!==n&&(e,t=""),e=t),e}function I(){var e;return(e=L())===n&&(e=function(){var e,t,s;if(e=y,t=[],(s=D())!==n)for(;s!==n;)t.push(s),s=D();else t=n;t!==n&&(s=function(){var e;(e=L())===n&&(e=z());return e}())!==n?(e,i=s,t=`${t.join("")}${i||""}`,e=t):(y=e,e=n);var i;return e}()),e}function D(){var e;return(e=function(){var e;(e=function(){var e;(e=P())===n&&(e=A());return e}())===n&&(e=function(){var e;(e=function(){var e,s,i,a;if(e=y,(s=function(){var e;42===t.charCodeAt(y)?(e="*",y++):(e=n,0===w&&T(h));return e}())!==n){if(i=[],(a=D())!==n)for(;a!==n;)i.push(a),a=D();else i=n;i!==n&&(a=function(){var e,s,i;e=y,s=y,w++,i=P(),w--,i===n?s=void 0:(y=s,s=n);s!==n?(42===t.charCodeAt(y)?(i="*",y++):(i=n,0===w&&T(h)),i!==n?e=s=[s,i]:(y=e,e=n)):(y=e,e=n);return e}())!==n?(e,s=c(i),e=s):(y=e,e=n)}else y=e,e=n;return e}())===n&&(e=function(){var e,s,i,a;if(e=y,(s=function(){var e;95===t.charCodeAt(y)?(e="_",y++):(e=n,0===w&&T(u));return e}())!==n){if(i=[],(a=D())!==n)for(;a!==n;)i.push(a),a=D();else i=n;i!==n&&(a=function(){var e,s,i;e=y,s=y,w++,i=A(),w--,i===n?s=void 0:(y=s,s=n);s!==n?(95===t.charCodeAt(y)?(i="_",y++):(i=n,0===w&&T(u)),i!==n?e=s=[s,i]:(y=e,e=n)):(y=e,e=n);return e}())!==n?(e,s=c(i),e=s):(y=e,e=n)}else y=e,e=n;return e}());return e}());return e}())===n&&(e=function(){var e,s,i;if(e=y,s=[],(i=R())!==n)for(;i!==n;)s.push(i),i=R();else s=n;e=s!==n?t.substring(e,y):s;return e}())===n&&(e=function(){var e,s,i;if(e=y,s=[],(i=N())!==n)for(;i!==n;)s.push(i),i=N();else s=n;e=s!==n?t.substring(e,y):s;return e}()),e}function P(){var e,s,i;if(e=y,function(){var e;return"**"===t.substr(y,2)?(e="**",y+=2):(e=n,0===w&&T(r)),e}()!==n){if(s=[],(i=D())!==n)for(;i!==n;)s.push(i),i=D();else s=n;s!==n&&(i=function(){var e;return"**"===t.substr(y,2)?(e="**",y+=2):(e=n,0===w&&T(r)),e}())!==n?(e,e=l(s)):(y=e,e=n)}else y=e,e=n;return e}function A(){var e,s,i;if(e=y,function(){var e;return"__"===t.substr(y,2)?(e="__",y+=2):(e=n,0===w&&T(d)),e}()!==n){if(s=[],(i=D())!==n)for(;i!==n;)s.push(i),i=D();else s=n;s!==n&&(i=function(){var e;return"__"===t.substr(y,2)?(e="__",y+=2):(e=n,0===w&&T(d)),e}())!==n?(e,e=l(s)):(y=e,e=n)}else y=e,e=n;return e}function R(){var e,s,i;return e=y,s=y,w++,(i=function(){var e;42===t.charCodeAt(y)?(e="*",y++):(e=n,0===w&&T(h));e===n&&(95===t.charCodeAt(y)?(e="_",y++):(e=n,0===w&&T(u)));return e}())===n&&(i=N())===n&&(i=L()),w--,i===n?s=void 0:(y=s,s=n),s!==n?(t.length>y?(i=t.charAt(y),y++):(i=n,0===w&&T(m)),i!==n?e=s=[s,i]:(y=e,e=n)):(y=e,e=n),e}function L(){var e,s,i,a;return 10===t.charCodeAt(y)?(e="\n",y++):(e=n,0===w&&T(p)),e===n&&(e=y,s=y,13===t.charCodeAt(y)?(i="\r",y++):(i=n,0===w&&T(g)),i!==n?(10===t.charCodeAt(y)?(a="\n",y++):(a=n,0===w&&T(p)),a===n&&(a=null),a!==n?s=i=[i,a]:(y=s,s=n)):(y=s,s=n),e=s!==n?t.substring(e,y):s),e}function N(){var e;return 32===t.charCodeAt(y)?(e=" ",y++):(e=n,0===w&&T(b)),e===n&&(9===t.charCodeAt(y)?(e="\t",y++):(e=n,0===w&&T(f))),e}function z(){var e,s;return e=y,w++,t.length>y?(s=t.charAt(y),y++):(s=n,0===w&&T(m)),w--,s===n?e=void 0:(y=e,e=n),e}if((i=o())!==n&&y===t.length)return i;throw i!==n&&y<t.length&&T({type:"end"}),M(x,v<t.length?t.charAt(v):null,v<t.length?S(v,v+1):S(v,v))}}}();function ie(e,t={}){return t.abilities=Y.creature.abilities.toParserOptions(),t.proficiencyBonus=Y.creature.challengeRating.toParserOptions(),ae(te,e,t)}function ne(e,t={}){return ae(se,e,t)}function ae(e,t,s){const i={inputText:t,outputText:null,error:null};try{const n=e.parse(t,s);i.outputText=n}catch(e){i.error={message:e.message,location:e.location}}return i}class oe extends HTMLTextAreaElement{static async define(){Z.define("block-textarea",re),i||customElements.define("block-textarea",this,{extends:"textarea"})}constructor(){super(),X(this,re),this.initializeMixin()}}const re={initializeMixin(){this.htmlText=null},get fieldName(){const e=this.getAttribute("pretty-name");return e||this.name},validate(e){this.required&&""===this.value&&e.add(this,`${this.fieldName} cannot be blank.`),this.parse(e)},parse(e=null){const t=function(e,t={}){return t.creature=Y.creature.title.toParserOptions(),ae(ee,e,t)}(y(this.value));if(t.error)return void(e&&e.add(this,`${this.fieldName} has at least one invalid name expression.`));const s=ie(t.outputText);if(e&&s.error)return void(e&&e.add(this,`${this.fieldName} has at least one invalid math expression.`));const i=s.outputText;this.markdownText=i.replace(/\n/g,"  \n> ");const n=ne(i);n.error?(e&&e.add(this,`${this.fieldName} has invalid markdown syntax.`),this.htmlText=i):this.htmlText=n.outputText}};class le extends HTMLSelectElement{static async define(){Z.define("dynamic-select",de),i||customElements.define("dynamic-select",this,{extends:"select"})}constructor(){super(),X(this,de),this.initializeMixin()}}let de={initializeMixin(){},enable(){this.removeAttribute("disabled")},disable(){this.setAttribute("disabled","")},get isEnabled(){return!this.hasAttribute("disabled")},clear(){for(;this.options.length>0;)this.remove(0)},populate(e){for(const t of e)this.add(t)}};class he extends HTMLInputElement{static get elementName(){throw new Error(`The class '${this.name}' must implement the elementName() getter.`)}static get mixin(){throw new Error(`The class '${this.name}' must implement the mixin() getter.`)}static define(){Z.define(this.elementName,this.mixin),i||customElements.define(this.elementName,this,{extends:"input"})}constructor(){super(),X(this,this.constructor.mixin),this.initializeMixin()}}function ce(e){const t=e.tagName;(function(e,t){return"INPUT"===e&&("text"===t||"number"===t)})(t,e.getAttribute("type"))||function(e){return"TEXTAREA"===e}(t)?(e.focus(),e.select()):e.focus()}function ue(e,t){const s=e.tagName,i=e.getAttribute("type");"INPUT"===s&&"checkbox"===i?e.checked=t:e.value=t,e.dispatchEvent(new Event("input"))}function me(e,t){for(const s of t)e.add(new Option(s,s))}class pe extends he{static get elementName(){return"enable-disable-elements-checkbox"}static get mixin(){return ge}constructor(){super()}}let ge={enabledElements:[],disabledElements:[],initializeMixin(){this.addEventListener("input",this.onInputCheckbox.bind(this))},onInputCheckbox(){const e=this.checked?this.enabledElements:this.disabledElements,t=this.checked?this.disabledElements:this.enabledElements;for(const[t,s]of e.entries())s.removeAttribute("disabled"),0===t&&ce(s);for(const e of t)e.setAttribute("disabled","")},enableElementsWhenChecked(...e){this.enabledElements=this.enabledElements.concat(e)},disableElementsWhenChecked(...e){this.disabledElements=this.disabledElements.concat(e)}};class be extends he{static get elementName(){return"number-input"}static get mixin(){return fe}constructor(){super()}}let fe={initializeMixin(){this.addEventListener("input",this.onInput)},onInput(){if(this.value){let e=this.valueAsInt;this.min&&e<this.minAsInt?this.value=this.min:this.max&&e>this.maxAsInt?this.value=this.max:this.value=e}},validate(e){if(null===this.valueAsInt){const t=this.getAttribute("pretty-name"),s=t||this.name;e.add(this,`${s} must be a valid number.`)}},get valueAsInt(){return w(this.value)},get minAsInt(){return w(this.min)},get maxAsInt(){return w(this.max)}};class ye extends HTMLSelectElement{static async define(){Z.define("number-select",Ee),i||customElements.define("number-select",this,{extends:"select"})}constructor(){super(),X(this,Ee),this.initializeMixin()}}let Ee={initializeMixin(){},get valueAsInt(){return w(this.value)}};class ve extends HTMLDataListElement{static async define(){Z.define("property-datalist",xe),i||customElements.define("property-datalist",this,{extends:"datalist"})}constructor(){super(),X(this,xe),this.initializeMixin()}}const xe={initializeMixin(){},setOptionEnabled(e,t){let s=null;s=i?this.findOption(e):this.options.namedItem(e),null!==s&&(t?s.removeAttribute("disabled"):s.setAttribute("disabled",""))},findOption(e){for(const t of this.childNodes)if("OPTION"===t.tagName&&t.value===e)return t;return null}},we=s(8)(window);class ke extends HTMLParagraphElement{static async define(){Z.define("sanitized-paragraph",Ce),i||customElements.define("sanitized-paragraph",this,{extends:"p"})}constructor(){super(),X(this,Ce),this.initializeMixin()}}const Ce={initializeMixin(){},set innerHTMLSanitized(e){var t;this.innerHTML=(t=e,we.sanitize(t,{ALLOWED_TAGS:["strong","em","b","i"]}))},get innerHTMLSanitized(){return this.innerHTML}};class Se extends he{static get elementName(){return"text-input"}static get mixin(){return Te}constructor(){super()}}let Te={initializeMixin(){this.htmlText=""},get fieldName(){const e=this.getAttribute("pretty-name");return e||this.name},validate(e){this.required&&""===this.value?e.add(this,`${this.fieldName} cannot be blank.`):"parsed"in this.dataset&&this.parse(e)},parse(e){const t=ne(y(this.value));if(t.error){const t=`${this.fieldName} has invalid Markdown syntax.`;e.add(this,t)}else this.htmlText=t.outputText}};var Me=new class{constructor(){this.templates=new Map}async addTemplate(e,t){const s=await n(t);this.templates.set(e,s)}hasTemplate(e){return this.templates.has(e)}getTemplate(e){return this.templates.get(e)}};class Be extends HTMLElement{static get elementName(){throw new Error(`The class '${this.name}' must implement the elementName() getter.`)}static get templatePaths(){return new Map}static async define(){for(const[e,t]of this.templatePaths)Me.hasTemplate(e)||await Me.addTemplate(e,t);customElements.define(this.elementName,this)}constructor(e){super(),this.isInitialized=!1,this.attachShadow({mode:"open"});for(const t of e.keys()){const e=Me.getTemplate(t),s=document.createRange().createContextualFragment(e);this.shadowRoot.appendChild(s.cloneNode(!0))}}connectedCallback(){}}class Ie{static get elementName(){throw new Error(`The class '${this.name}' must implement the elementName() getter.`)}static get templatePaths(){return new Map}static async define(){for(const[e,t]of this.templatePaths)Me.hasTemplate(e)||await Me.addTemplate(e,t)}constructor(e,t=null){this._parent=t,this._children=[],this.element=document.createElement(this.elementName),this.dataset=new Map,this.shadowRoot=document.createDocumentFragment();const s=document.createElement("body");this.shadowRoot.appendChild(s);for(const t of e.keys()){const e=Me.getTemplate(t);s.innerHTML+=e}}connectedCallback(){}connect(){this.isConnected=!0,this.connectedCallback()}addEventListener(e,t){this.shadowRoot.addEventListener(e,t)}dispatchEvent(e){this.shadowRoot.dispatchEvent(e),e.bubbles&&null!==this._parent&&this._parent.dispatchEvent(e)}getAttribute(e){return this.element.getAttribute(e)}setAttribute(e,t){this.element.setAttribute(e,t)}removeAttribute(e){this.element.removeAttribute(e)}get children(){return this._children}appendChild(e){this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);t>=0&&this._children.splice(t,1)}insertBefore(e,t){const s=this._children.indexOf(e),i=this._children.indexOf(t);this._children.splice(i,0,this._children.splice(s,1)[0])}}let De;De=i?Ie:Be;var Pe=De;class Ae extends Pe{static get elementName(){return"drop-down-menu"}static get templatePaths(){return super.templatePaths.set("drop-down-menu","src/html/elements/autonomous/drop-down-menu.html")}constructor(){super(Ae.templatePaths)}}class Re extends Pe{static get elementName(){return"error-messages"}static get templatePaths(){return super.templatePaths.set("error-messages","src/html/elements/autonomous/error-messages.html")}constructor(){super(Re.templatePaths),this.container=this.shadowRoot.getElementById("error-messages"),this.list=this.shadowRoot.getElementById("error-messages-list"),this.errors=[]}add(e,t){let s={fieldElement:e,message:t};this.errors.push(s),e.classList.add("section__error-highlight"),this.container.classList.remove("error-messages_hidden");let i=Re.createErrorMessageElement(t);this.list.appendChild(i)}clear(){for(this.container.classList.add("error-messages_hidden");this.errors.length>0;){this.errors.pop().fieldElement.classList.remove("section__error-highlight")}let e=this.list;for(;e.hasChildNodes();)e.removeChild(e.lastChild)}focusOnFirstErrorField(){ce(this.errors[0].fieldElement)}get any(){return this.errors.length>0}static createErrorMessageElement(e){let t=document.createElement("li"),s=document.createTextNode(e);return t.appendChild(s),t}}const Le="getting-started-help-box_hidden";class Ne extends Pe{static get elementName(){return"getting-started-help-box"}static get templatePaths(){return super.templatePaths.set("getting-started-help-box","src/html/elements/autonomous/getting-started-help-box.html")}constructor(){super(Ne.templatePaths),this.container=this.shadowRoot.getElementById("container"),this.closeButton=this.shadowRoot.getElementById("close-button")}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.closeButton.addEventListener("click",this.onClickCloseButton.bind(this)),this.isInitialized=!0)}onClickCloseButton(){const e=new CustomEvent("toggleGettingStarted",{bubbles:!0,composed:!0});this.dispatchEvent(e)}set visible(e){e?this.container.classList.remove(Le):this.container.classList.add(Le)}get visible(){return!this.container.classList.contains(Le)}}class ze extends Pe{static get elementName(){return"loading-screen"}static get templatePaths(){return super.templatePaths.set("loading-screen","src/html/elements/autonomous/loading-screen.html")}constructor(){super(ze.templatePaths),this.container=this.shadowRoot.getElementById("container"),this.statusElement=this.shadowRoot.getElementById("status")}set visible(e){e?this.container.classList.remove("loading-screen_hidden"):this.container.classList.add("loading-screen_hidden")}get visible(){return!this.container.classList.contains("loading-screen_hidden")}set status(e){this.statusElement.textContent=e}get status(){return this.statusElement.textContent}}class He extends Pe{static get elementName(){return"property-block"}static get templatePaths(){return super.templatePaths.set("property-block","src/html/elements/autonomous/property-block.html")}constructor(){super(He.templatePaths)}}class $e extends Pe{static get elementName(){return"property-line"}static get templatePaths(){return super.templatePaths.set("property-line","src/html/elements/autonomous/property-line.html")}constructor(){super($e.templatePaths)}}class Oe extends Pe{static get elementName(){return"section-divider"}static get templatePaths(){return super.templatePaths.set("section-divider","src/html/elements/autonomous/section-divider.html")}static get hiddenClassName(){return"section-divider_hidden"}constructor(){super(Oe.templatePaths),this.divider=this.shadowRoot.querySelector(".section-divider"),this.hidden=!0}get hidden(){return this.divider.classList.contains(Oe.hiddenClassName)}set hidden(e){e?this.divider.classList.add(Oe.hiddenClassName):this.divider.classList.remove(Oe.hiddenClassName)}}class Fe extends Pe{static get elementName(){return"tapered-rule"}static get templatePaths(){return super.templatePaths.set("tapered-rule","src/html/elements/autonomous/tapered-rule.html")}constructor(){super(Fe.templatePaths)}}class Ve extends Pe{static get elementName(){return"custom-dialog"}static get templatePaths(){return super.templatePaths.set("custom-dialog","src/html/elements/autonomous/dialogs/custom-dialog.html")}constructor(e,t=null){super(e,t),this.dialog=this.shadowRoot.getElementById("dialog"),this.closeButton=this.shadowRoot.getElementById("close-button")}connectedCallback(){super.connectedCallback(),this.closeButton.addEventListener("click",this.onClickCloseButton.bind(this))}onClickCloseButton(){this.closeModal()}set open(e){e?this.dialog.setAttribute("open",""):this.dialog.removeAttribute("open")}get open(){return this.dialog.getAttribute("open")}showModal(){i?this.open=!0:this.dialog.showModal()}closeModal(){i?this.open=!1:this.dialog.close()}}const _e="option-dialog__status-label_success",Je="option-dialog__status-label_error";class je extends Ve{static get elementName(){return"option-dialog"}static get templatePaths(){return super.templatePaths.set("option-dialog","src/html/elements/autonomous/dialogs/option-dialog.html")}constructor(e,t=null){super(e,t),this.statusLabel=this.shadowRoot.getElementById("status-label"),this.cancelButton=this.shadowRoot.getElementById("cancel-button")}connectedCallback(){super.connectedCallback(),this.cancelButton.addEventListener("click",this.onClickCloseButton.bind(this))}get statusText(){return this.statusLabel.textContent}get statusType(){return this.statusLabel.classList.contains(_e)?"success":this.statusLabel.classList.contains(Je)?"error":null}setStatus(e,t=null){switch(this.statusLabel.textContent=e,this.statusLabel.classList.remove(_e),this.statusLabel.classList.remove(Je),t){case"success":this.statusLabel.classList.add(_e);break;case"error":this.statusLabel.classList.add(Je)}}}class Ge extends je{static get elementName(){return"import-dialog"}static get templatePaths(){return super.templatePaths.set("import-dialog","src/html/elements/autonomous/dialogs/import-dialog.html")}constructor(e){super(e),this.importCallback=null}connectedCallback(){super.connectedCallback()}launch(e){this.importCallback=e}}class Qe extends Ge{static get elementName(){return"import-json-dialog"}static get templatePaths(){return super.templatePaths.set("import-json-dialog","src/html/elements/autonomous/dialogs/import-json-dialog.html")}constructor(){super(Qe.templatePaths),this.chooseFileButton=this.shadowRoot.getElementById("choose-file-button"),this.fileInput=this.shadowRoot.getElementById("file-input")}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.chooseFileButton.addEventListener("click",this.onClickChooseFileButton.bind(this)),this.fileInput.addEventListener("change",this.onFileSelected.bind(this)),this.isInitialized=!0)}onClickChooseFileButton(){this.fileInput.click()}async onFileSelected(){const e=this.fileInput.files[0],t=await e.text(),s=JSON.parse(t);this.importCallback(s),this.closeModal()}launch(e){super.launch(e),this.fileInput.value="",this.setStatus('Click "Choose File..." to begin.'),this.showModal()}}var We=["Aboleth","Acolyte","Adult Black Dragon","Adult Blue Dragon","Adult Brass Dragon","Adult Bronze Dragon","Adult Copper Dragon","Adult Gold Dragon","Adult Green Dragon","Adult Red Dragon","Adult Silver Dragon","Adult White Dragon","Air Elemental","Ancient Black Dragon","Ancient Blue Dragon","Ancient Brass Dragon","Ancient Bronze Dragon","Ancient Copper Dragon","Ancient Gold Dragon","Ancient Green Dragon","Ancient Red Dragon","Ancient Silver Dragon","Ancient White Dragon","Androsphinx","Animated Armor","Ankheg","Ape","Archmage","Assassin","Awakened Shrub","Awakened Tree","Axe Beak","Azer","Baboon","Badger","Balor","Bandit Captain","Bandit","Barbed Devil","Basilisk","Bat","Bearded Devil","Behir","Berserker","Black Bear","Black Dragon Wyrmling","Black Pudding","Blink Dog","Blood Hawk","Blue Dragon Wyrmling","Boar","Bone Devil","Brass Dragon Wyrmling","Bronze Dragon Wyrmling","Brown Bear","Bugbear","Bulette","Camel","Cat","Centaur","Chain Devil","Chimera","Chuul","Clay Golem","Cloaker","Cloud Giant","Cockatrice","Commoner","Constrictor Snake","Copper Dragon Wyrmling","Couatl","Crab","Crocodile","Cult Fanatic","Cultist","Darkmantle","Death Dog","Deep Gnome (Svirfneblin)","Deer","Deva","Dire Wolf","Djinni","Doppelganger","Draft Horse","Dragon Turtle","Dretch","Drider","Drow","Druid","Dryad","Duergar","Dust Mephit","Eagle","Earth Elemental","Efreeti","Elephant","Elk","Erinyes","Ettercap","Ettin","Fire Elemental","Fire Giant","Flesh Golem","Flying Snake","Flying Sword","Frog","Frost Giant","Gargoyle","Gelatinous Cube","Ghast","Ghost","Ghoul","Giant Ape","Giant Badger","Giant Bat","Giant Boar","Giant Centipede","Giant Constrictor Snake","Giant Crab","Giant Crocodile","Giant Eagle","Giant Elk","Giant Fire Beetle","Giant Frog","Giant Goat","Giant Hyena","Giant Lizard","Giant Octopus","Giant Owl","Giant Poisonous Snake","Giant Rat (Diseased)","Giant Rat","Giant Scorpion","Giant Sea Horse","Giant Shark","Giant Spider","Giant Toad","Giant Vulture","Giant Wasp","Giant Weasel","Giant Wolf Spider","Gibbering Mouther","Glabrezu","Gladiator","Gnoll","Goat","Goblin","Gold Dragon Wyrmling","Gorgon","Gray Ooze","Green Dragon Wyrmling","Green Hag","Grick","Griffon","Grimlock","Guard","Guardian Naga","Gynosphinx","Half-Red Dragon Veteran","Harpy","Hawk","Hell Hound","Hezrou","Hill Giant","Hippogriff","Hobgoblin","Homunculus","Horned Devil","Hunter Shark","Hydra","Hyena","Ice Devil","Ice Mephit","Imp","Invisible Stalker","Iron Golem","Jackal","Killer Whale","Knight","Kobold","Kraken","Lamia","Lemure","Lich","Lion","Lizard","Lizardfolk","Mage","Magma Mephit","Magmin","Mammoth","Manticore","Marilith","Mastiff","Medusa","Merfolk","Merrow","Mimic","Minotaur Skeleton","Minotaur","Mule","Mummy Lord","Mummy","Nalfeshnee","Night Hag","Nightmare","Noble","Ochre Jelly","Octopus","Ogre Zombie","Ogre","Oni","Orc","Otyugh","Owl","Owlbear","Panther","Pegasus","Phase Spider","Pit Fiend","Planetar","Plesiosaurus","Poisonous Snake","Polar Bear","Pony","Priest","Pseudodragon","Purple Worm","Quasit","Quipper","Rakshasa","Rat","Raven","Red Dragon Wyrmling","Reef Shark","Remorhaz","Rhinoceros","Riding Horse","Roc","Roper","Rug of Smothering","Rust Monster","Saber-Toothed Tiger","Sahuagin","Salamander","Satyr","Scorpion","Scout","Sea Hag","Sea Horse","Shadow","Shambling Mound","Shield Guardian","Shrieker","Silver Dragon Wyrmling","Skeleton","Solar","Specter","Spider","Spirit Naga","Sprite","Spy","Steam Mephit","Stirge","Stone Giant","Stone Golem","Storm Giant","Succubus-Incubus","Swarm of Bats","Swarm of Beetles","Swarm of Centipedes","Swarm of Insects","Swarm of Poisonous Snakes","Swarm of Quippers","Swarm of Rats","Swarm of Ravens","Swarm of Spiders","Swarm of Wasps","Tarrasque","Thug","Tiger","Treant","Tribal Warrior","Triceratops","Troll","Tyrannosaurus Rex","Unicorn","Vampire Spawn","Vampire","Veteran","Violet Fungus","Vrock","Vulture","Warhorse Skeleton","Warhorse","Water Elemental","Weasel","Werebear","Wereboar","Wererat","Weretiger","Werewolf","White Dragon Wyrmling","Wight","Will-o'-Wisp","Winter Wolf","Wolf","Worg","Wraith","Wyvern","Xorn","Young Black Dragon","Young Blue Dragon","Young Brass Dragon","Young Bronze Dragon","Young Copper Dragon","Young Gold Dragon","Young Green Dragon","Young Red Dragon","Young Silver Dragon","Young White Dragon","Zombie"];class qe extends Ge{static get elementName(){return"import-srd-dialog"}static get templatePaths(){return super.templatePaths.set("import-srd-dialog","src/html/elements/autonomous/dialogs/import-srd-dialog.html")}constructor(){super(qe.templatePaths),this.creatureSelect=this.shadowRoot.getElementById("creature-select"),this.importButton=this.shadowRoot.getElementById("import-button")}connectedCallback(){super.connectedCallback(),this.importButton.addEventListener("click",this.onClickImportButton.bind(this)),this.isInitialized=!0}async onClickImportButton(){const e=`examples/5e-srd/${this.creatureSelect.value}.json`,t=await n(e),s=JSON.parse(t);this.importCallback(s),this.closeModal()}launch(e){super.launch(e),0===this.creatureSelect.options.length&&this.creatureSelect.populate(We.map(e=>new Option(e,e))),this.setStatus("Choose a creature:"),this.showModal()}}class Ue{constructor(){this.cachedCreatureLists=new Map}static getCreatureListUrl(e){return`https://api.open5e.com/monsters/?format=json&fields=name,slug&limit=1000&document__slug=${e}`}static getCreatureUrl(e){return`https://api.open5e.com/monsters/${e}`}async loadCreatureList(e){if(this.cachedCreatureLists.has(e))return this.cachedCreatureLists.get(e);const t=Ue.getCreatureListUrl(e),s=(await fetch(t).then(e=>e.json())).results;return this.cachedCreatureLists.set(e,s),s}async loadCreature(e){const t=Ue.getCreatureUrl(e);return await fetch(t).then(e=>e.json())}}class Ke extends Ge{static get elementName(){return"import-open5e-dialog"}static get templatePaths(){return super.templatePaths.set("import-open5e-dialog","src/html/elements/autonomous/dialogs/import-open5e-dialog.html")}constructor(){super(Ke.templatePaths),this.client=new Ue,this.srdRadioButton=this.shadowRoot.getElementById("srd-radio"),this.tobRadioButton=this.shadowRoot.getElementById("tob-radio"),this.ccRadioButton=this.shadowRoot.getElementById("cc-radio"),this.creatureSelect=this.shadowRoot.getElementById("creature-select"),this.importButton=this.shadowRoot.getElementById("import-button")}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.srdRadioButton.addEventListener("change",this.onChangeSource.bind(this)),this.tobRadioButton.addEventListener("change",this.onChangeSource.bind(this)),this.ccRadioButton.addEventListener("change",this.onChangeSource.bind(this)),this.importButton.addEventListener("click",this.onClickImportButton.bind(this)),this.isInitialized=!0)}async onChangeSource(){const e=(t=this,s="source",t.shadowRoot.querySelector(`input[name="${s}"]:checked`)).value;var t,s;let i;this.setStatus("Retrieving creature list from Open5e..."),this.creatureSelect.disable(),this.creatureSelect.clear();try{i=await this.client.loadCreatureList(e)}catch(e){return void this.setStatus("Error: Unable to load creature list.","error")}this.creatureSelect.populate(i.map(e=>new Option(e.name,e.slug))),this.creatureSelect.enable(),this.setStatus("Choose a creature:")}async onClickImportButton(){const e=this.creatureSelect.value;let t;try{t=await this.client.loadCreature(e)}catch(e){this.setStatus("Error: Unable to load creature.","error")}this.importCallback(t),this.closeModal()}launch(e){super.launch(e),this.showModal()}}class Ye extends je{static get elementName(){return"reset-dialog"}static get templatePaths(){return super.templatePaths.set("reset-dialog","src/html/elements/autonomous/dialogs/reset-dialog.html")}constructor(){super(Ye.templatePaths),this.resetButton=this.shadowRoot.getElementById("reset-button"),this.resetCallback=null}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.resetButton.addEventListener("click",this.onClickResetButton.bind(this)),this.isInitialized=!0)}onClickResetButton(){this.resetCallback(),this.closeModal()}launch(e){this.resetCallback=e,this.showModal()}}class Xe extends je{static get elementName(){return"export-dialog"}static get templatePaths(){return super.templatePaths.set("export-dialog","src/html/elements/autonomous/dialogs/export-dialog.html")}constructor(){super(Xe.templatePaths),this.copyToClipboardButton=this.shadowRoot.getElementById("copy-to-clipboard-button"),this.downloadAsFileButton=this.shadowRoot.getElementById("download-as-file-button"),this.clipboard=null,this.exportContent=null,this.exportContentType=null,this.exportFileName=null}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.downloadAsFileButton.addEventListener("click",this.onClickDownloadAsFileButton.bind(this)),this.isInitialized=!0)}onClickDownloadAsFileButton(){!function(e,t,s){const i=new Blob([e],{type:t}),n=document.createElement("a");n.download=s,n.href=URL.createObjectURL(i),n.click()}(this.exportContent,this.exportContentType,this.exportFileName),this.setStatus("File download initiated.","success")}onClickCloseButton(){super.onClickCloseButton(),this.clipboard.destroy()}launch(e,t,s){this.exportContent=e,this.exportContentType=t,this.exportFileName=s,this.setStatus("Choose one of the following options:"),this.clipboard=new m(e,this.dialog,this.copyToClipboardButton),this.clipboard.setSuccessCallback(()=>{this.setStatus("Copied to clipboard.","success")}),this.clipboard.setErrorCallback(()=>{this.setStatus("Press Ctrl+C to copy to clipboard.","error")}),this.showModal()}}class Ze{constructor(e=null){this.reset(),e&&this.populateFromJsObject(e)}reset(e=!0){this.name="",this.isFinesse=!1,this._reach=5,this._normalRange=20,this._longRange=60,this.damageCategories={melee:new et({isEnabled:e}),ranged:new et,versatile:new et,bonus:new et}}populateFromJsObject(e){e.name&&(this.name=e.name),e.isFinesse&&(this.isFinesse=e.isFinesse),e.reach&&(this.reach=e.reach),e.normalRange&&(this.normalRange=e.normalRange),e.longRange&&(this.longRange=e.longRange);for(const t in this.damageCategories){const s=e.damageCategories[t]?e.damageCategories[t]:null;s&&this.damageCategories[t].populateFromJsObject(s)}}get damageCategoryKeys(){return Object.keys(this.damageCategories)}get damageCategoryEntries(){return Object.entries(this.damageCategories)}set reach(e){this._reach=e}get reach(){return this._reach?this._reach:0}set normalRange(e){this._normalRange=e}get normalRange(){return this._normalRange?this._normalRange:0}set longRange(e){this._longRange=e}get longRange(){return this._longRange?this._longRange:0}get generatedText(){const e=this.damageCategories.melee,t=this.damageCategories.ranged,s=this.damageCategories.versatile,i=this.damageCategories.bonus;if(e.isEnabled||t.isEnabled){const n=this.generatedTextParserAbilityModifier(e.isEnabled,t.isEnabled);return`*${this.generatedTextAttackType(e.isEnabled,t.isEnabled)}:* ${this.generatedTextToHit(n)}, ${this.generatedTextReachOrRange(e.isEnabled,t.isEnabled)}, one target. *Hit:* ${this.generatedTextDamage(e,t,s,i,n)}.`}return""}generatedTextParserAbilityModifier(e,t){return this.isFinesse?"fin":e?"str":t?"dex":""}generatedTextAttackType(e,t){return e&&t?"Melee or Ranged Weapon Attack":e?"Melee Weapon Attack":t?"Ranged Weapon Attack":""}generatedTextToHit(e){return`atk[${e}] to hit`}generatedTextReachOrRange(e,t){return e&&t?`reach ${this.reach} ft. or range ${this.normalRange}/${this.longRange} ft.`:e?`reach ${this.reach} ft.`:t?`range ${this.normalRange}/${this.longRange} ft.`:""}generatedTextDamage(e,t,s,i,n){const a=e.isEnabled&&t.isEnabled,o=e.hasSameValuesWith(t);return`${this.generatedTextMeleeRangedDamage(e,t,n)}${this.generatedTextVersatileDamage(s,n,a)}${this.generatedTextBonusDamage(i,s.isEnabled,a,o)}`}generatedTextMeleeRangedDamage(e,t,s){if(e.isEnabled&&t.isEnabled){const i=e.generateDamageText(s);return e.hasSameValuesWith(t)?i:`${i} in melee or ${t.generateDamageText(s)} at range`}return e.isEnabled?e.generateDamageText(s):t.isEnabled?t.generateDamageText(s):""}generatedTextVersatileDamage(e,t,s){if(e.isEnabled){return`, or ${e.generateDamageText(t)} if used with two hands${s?" to make a melee attack":""}`}return""}generatedTextBonusDamage(e,t,s,i){if(e.isEnabled){return`${t||s&&!i?",":""} plus ${e.generateDamageText()}`}return""}renderText(e){if(""===e)return"";const t=ie(e);if(t.error)return"Error: Generated text has at least one invalid math expression.";const s=ne(t.outputText);return s.error?"Error: Generated text has invalid markdown syntax.":s.outputText}}class et{constructor(e=null){this.reset(),e&&this.populateFromJsObject(e)}reset(){this.isEnabled=!1,this.damageType="",this.damageDieQuantity=1,this.damageDieSize=8}populateFromJsObject(e){e.isEnabled&&(this.isEnabled=e.isEnabled),e.damageType&&(this.damageType=e.damageType),e.damageDieQuantity&&(this.damageDieQuantity=e.damageDieQuantity),e.damageDieSize&&(this.damageDieSize=e.damageDieSize)}set damageDieQuantity(e){this._damageDieQuantity=e}get damageDieQuantity(){return this._damageDieQuantity?this._damageDieQuantity:1}set damageDieSize(e){this._damageDieSize=e}get damageDieSize(){return this._damageDieSize?this._damageDieSize:0}generateDamageText(e){const t=this.damageType?` ${this.damageType}`:"";if(1===this.damageDieSize){return`${this.damageDieQuantity*this.damageDieSize}${t} damage`}return e?`dmg[${this.damageDieQuantity}d${this.damageDieSize} + ${e}]${t} damage`:`dmg[${this.damageDieQuantity}d${this.damageDieSize}]${t} damage`}hasSameValuesWith(e){return this.damageType===e.damageType&&this.damageDieQuantity===e.damageDieQuantity&&this.damageDieSize===e.damageDieSize}}var tt={Club:{name:"Club",description:"Simple Melee, 1d4 bludgeoning, light",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:4}}},Dagger:{name:"Dagger",description:"Simple Melee, 1d4 piercing, finesse, light, thrown (range 20/60)",isFinesse:!0,reach:5,normalRange:20,longRange:60,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:4},ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:4}}},Greatclub:{name:"Greatclub",description:"Simple Melee, 1d8 bludgeoning, two-handed",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:8}}},Handaxe:{name:"Handaxe",description:"Simple Melee, 1d6 slashing, light, thrown (range 20/60)",reach:5,normalRange:20,longRange:60,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:6},ranged:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:6}}},Javelin:{name:"Javelin",description:"Simple Melee, 1d6 piercing, thrown (range 30/120)",reach:5,normalRange:30,longRange:120,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6},ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6}}},"Light Hammer":{name:"Light Hammer",description:"Simple Melee, 1d4 bludgeoning, light, thrown (range 20/60)",reach:5,normalRange:20,longRange:60,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:4},ranged:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:4}}},Mace:{name:"Mace",description:"Simple Melee, 1d6 bludgeoning",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:6}}},Quarterstaff:{name:"Quarterstaff",description:"Simple Melee, 1d6 bludgeoning, versatile (1d8)",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:6},versatile:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:8}}},Sickle:{name:"Sickle",description:"Simple Melee, 1d4 slashing, light",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:4}}},Spear:{name:"Spear",description:"Simple Melee, 1d6 piercing, thrown (range 20/60), versatile (1d8)",reach:5,normalRange:20,longRange:60,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6},ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6},versatile:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}},"Light Crossbow":{name:"Light Crossbow",description:"Simple Ranged, 1d8 piercing, ammunition (range 80/320), loading, two-handed",normalRange:80,longRange:320,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}},Dart:{name:"Dart",description:"Simple Ranged, 1d4 piercing, finesse, thrown (range 20/60)",isFinesse:!0,normalRange:20,longRange:60,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:4}}},Shortbow:{name:"Shortbow",description:"Simple Ranged, 1d6 piercing, ammunition (range 80/320), two-handed",normalRange:80,longRange:320,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6}}},Sling:{name:"Sling",description:"Simple Ranged, 1d4 bludgeoning, ammunition (range 30/120)",normalRange:30,longRange:120,damageCategories:{ranged:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:4}}},Battleaxe:{name:"Battleaxe",description:"Martial Melee, 1d8 slashing, versatile (1d10)",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:8},versatile:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:10}}},Flail:{name:"Flail",description:"Martial Melee, 1d8 bludgeoning",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:8}}},Glaive:{name:"Glaive",description:"Martial Melee, 1d10 slashing, heavy, reach, two-handed",reach:10,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:10}}},Greataxe:{name:"Greataxe",description:"Martial Melee, 1d12 slashing, heavy, two-handed",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:12}}},Greatsword:{name:"Greatsword",description:"Martial Melee, 2d6 slashing, heavy, two-handed",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:2,damageDieSize:6}}},Halberd:{name:"Halberd",description:"Martial Melee, 1d10 slashing, heavy, reach, two-handed",reach:10,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:10}}},Lance:{name:"Lance",description:"Martial Melee, 1d12 piercing, reach, special",reach:10,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:12}}},Longsword:{name:"Longsword",description:"Martial Melee, 1d8 slashing, versatile (1d10)",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:8},versatile:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:10}}},Maul:{name:"Maul",description:"Martial Melee, 2d6 bludgeoning, heavy, two-handed",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:2,damageDieSize:6}}},Morningstar:{name:"Morningstar",description:"Martial Melee, 1d8 piercing",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}},Pike:{name:"Pike",description:"Martial Melee, 1d10 piercing, heavy, reach, two-handed",reach:10,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:10}}},Rapier:{name:"Rapier",description:"Martial Melee, 1d8 piercing, finesse",isFinesse:!0,reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}},Scimitar:{name:"Scimitar",description:"Martial Melee, 1d6 slashing, finesse, light",isFinesse:!0,reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:6}}},Shortsword:{name:"Shortsword",description:"Martial Melee, 1d6 piercing, finesse, light",isFinesse:!0,reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6}}},Trident:{name:"Trident",description:"Martial Melee, 1d6 piercing, thrown (range 20/60), versatile (1d8)",reach:5,normalRange:20,longRange:60,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6},ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6},versatile:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}},"War Pick":{name:"War Pick",description:"Martial Melee, 1d8 piercing",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}},Warhammer:{name:"Warhammer",description:"Martial Melee, 1d8 bludgeoning, versatile (1d10)",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:8},versatile:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:10}}},Whip:{name:"Whip",description:"Martial Melee, 1d4 slashing, finesse, reach",isFinesse:!0,reach:10,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:4}}},Blowgun:{name:"Blowgun",description:"Martial Ranged, 1 piercing, ammunition (range 25/100), loading",normalRange:25,longRange:100,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:1}}},"Hand Crossbow":{name:"Hand Crossbow",description:"Martial Ranged, 1d6 piercing, ammunition (range 30/120), light, loading",normalRange:30,longRange:120,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6}}},"Heavy Crossbow":{name:"Heavy Crossbow",description:"Martial Ranged, 1d10 piercing, ammunition (range 100/400), heavy, loading, two-handed",normalRange:100,longRange:400,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:10}}},Longbow:{name:"Longbow",description:"Martial Ranged, 1d8 piercing, ammunition (range 150/600), heavy, two-handed",normalRange:150,longRange:600,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}}};class st extends Ve{static get elementName(){return"generate-attack-dialog"}static get templatePaths(){return super.templatePaths.set("generate-attack-dialog","src/html/elements/autonomous/dialogs/generate-attack-dialog.html")}constructor(e=null){super(st.templatePaths,e),this.attackModel=new Ze,this.errorMessages=this.shadowRoot.getElementById("error-messages"),this.weaponNameInput=this.shadowRoot.getElementById("weapon-name-input"),this.finesseInput=this.shadowRoot.getElementById("finesse-input"),this.predefinedWeaponsDatalist=this.shadowRoot.getElementById("predefined-weapons"),this.damageCategoryInputs={};for(const e of this.attackModel.damageCategoryKeys)this.damageCategoryInputs[e]={enabled:this.shadowRoot.getElementById(`${e}-enabled-input`),damageType:this.shadowRoot.getElementById(`${e}-damage-type-input`),damageDieQuantity:this.shadowRoot.getElementById(`${e}-damage-die-quantity-input`),damageDieSize:this.shadowRoot.getElementById(`${e}-damage-die-size-input`)};this.reachInput=this.shadowRoot.getElementById("reach-input"),this.normalRangeInput=this.shadowRoot.getElementById("normal-range-input"),this.longRangeInput=this.shadowRoot.getElementById("long-range-input"),this.generatedTextElement=this.shadowRoot.getElementById("generated-text"),this.renderedTextElement=this.shadowRoot.getElementById("rendered-text"),this.cancelButton=this.shadowRoot.getElementById("cancel-button"),this.resetButton=this.shadowRoot.getElementById("reset-button"),this.generateAttackButton=this.shadowRoot.getElementById("generate-attack-button")}connectedCallback(){if(this.isConnected&&!this.isInitialized){super.connectedCallback();for(const e of this.attackModel.damageCategoryKeys){const t=this.damageCategoryInputs[e],s=[t.damageType,t.damageDieQuantity,t.damageDieSize];"melee"===e?s.push(this.reachInput):"ranged"===e&&(s.push(this.normalRangeInput),s.push(this.longRangeInput)),t.enabled.enableElementsWhenChecked(...s),t.enabled.addEventListener("input",this.onInputDamageCategoryEnabled.bind(this,e)),t.damageType.addEventListener("input",this.onInputDamageCategoryDamageType.bind(this,e)),t.damageDieQuantity.addEventListener("input",this.onInputDamageCategoryDamageDieQuantity.bind(this,e)),t.damageDieSize.addEventListener("input",this.onInputDamageCategoryDamageDieSize.bind(this,e))}this.weaponNameInput.addEventListener("input",this.onInputWeaponName.bind(this)),this.finesseInput.addEventListener("input",this.onInputFinesse.bind(this)),this.reachInput.addEventListener("input",this.onInputReach.bind(this)),this.normalRangeInput.addEventListener("input",this.onInputNormalRange.bind(this)),this.longRangeInput.addEventListener("input",this.onInputLongRange.bind(this)),this.cancelButton.addEventListener("click",this.onClickCloseButton.bind(this)),this.resetButton.addEventListener("click",this.onClickResetButton.bind(this)),this.generateAttackButton.addEventListener("click",this.onClickGenerateAttackButton.bind(this));for(const e of Object.values(tt)){const t=new Option(e.description,e.name);this.predefinedWeaponsDatalist.appendChild(t)}this.isInitialized=!0,this.update()}}onInputWeaponName(){const e=this.weaponNameInput.value,t=tt[e];t?(this.reset(!1),this.attackModel.populateFromJsObject(t),this.populateFieldsFromModel(this.attackModel)):this.attackModel.name=e,this.update()}onInputFinesse(){this.attackModel.isFinesse=this.finesseInput.checked,this.update()}onInputDamageCategoryEnabled(e){this.attackModel.damageCategories[e].isEnabled=this.damageCategoryInputs[e].enabled.checked,this.update()}onInputDamageCategoryDamageType(e){this.attackModel.damageCategories[e].damageType=this.damageCategoryInputs[e].damageType.value,this.update()}onInputDamageCategoryDamageDieQuantity(e){this.attackModel.damageCategories[e].damageDieQuantity=this.damageCategoryInputs[e].damageDieQuantity.valueAsInt,this.update()}onInputDamageCategoryDamageDieSize(e){this.attackModel.damageCategories[e].damageDieSize=this.damageCategoryInputs[e].damageDieSize.valueAsInt,this.update()}onInputReach(){this.attackModel.reach=this.reachInput.valueAsInt,this.update()}onInputNormalRange(){this.attackModel.normalRange=this.normalRangeInput.valueAsInt,this.update()}onInputLongRange(){this.attackModel.longRange=this.longRangeInput.valueAsInt,this.update()}onClickResetButton(){this.reset()}onClickGenerateAttackButton(){this.generateAttack()}get generatedText(){return this.generatedTextElement.textContent}get renderedText(){return this.renderedTextElement.innerHTMLSanitized}launch(){this.showModal(),ce(this.weaponNameInput)}reset(e=!0){this.attackModel.reset(e),this.populateFieldsFromModel(this.attackModel),this.update(),ce(this.weaponNameInput)}checkForErrors(){this.weaponNameInput.validate(this.errorMessages);const e=this.damageCategoryInputs.melee.enabled,t=this.damageCategoryInputs.ranged.enabled;e.checked||t.checked||this.errorMessages.add(e,'At least one of "Melee" or "Ranged" must be enabled.')}generateAttack(){if(this.errorMessages.clear(),this.checkForErrors(),this.errorMessages.any)return void this.errorMessages.focusOnFirstErrorField();const e=new CustomEvent("generateAttack",{bubbles:!0,composed:!0,detail:{name:this.attackModel.name,text:this.attackModel.generatedText}});this.dispatchEvent(e),this.closeModal(),this.reset()}populateFieldsFromModel(e){this.weaponNameInput.value=e.name,this.finesseInput.checked=e.isFinesse;for(const t of e.damageCategoryKeys){const s=e.damageCategories[t],i=this.damageCategoryInputs[t];i.enabled.checked=s.isEnabled,i.enabled.dispatchEvent(new Event("input")),i.damageType.value=s.damageType,i.damageDieQuantity.value=s.damageDieQuantity,i.damageDieSize.value=s.damageDieSize}this.reachInput.value=e.reach,this.normalRangeInput.value=e.normalRange,this.longRangeInput.value=e.longRange}update(){const e=this.attackModel.generatedText;this.generatedTextElement.textContent=e,this.renderedTextElement.innerHTMLSanitized=this.attackModel.renderText(e)}}class it extends Pe{static get elementName(){return"help-tooltip"}static get templatePaths(){return super.templatePaths.set("help-tooltip","src/html/elements/autonomous/tooltips/help-tooltip.html")}constructor(){super(it.templatePaths)}}class nt extends Pe{static get elementName(){return"custom-text-help-tooltip"}static get templatePaths(){return super.templatePaths.set("custom-text-help-tooltip","src/html/elements/autonomous/tooltips/custom-text-help-tooltip.html")}constructor(){super(nt.templatePaths)}}class at extends Pe{static get elementName(){return"display-block"}static get templatePaths(){return super.templatePaths.set("display-block","src/html/elements/autonomous/lists/display-block.html")}constructor(){super(at.templatePaths),this.blockElement=this.shadowRoot.getElementById("display-block"),this.nameElement=this.shadowRoot.getElementById("display-block-name"),this.textElement=this.shadowRoot.getElementById("display-block-text")}applyLegendaryActionStyles(){this.blockElement.classList.add("display-block_no-spacing"),this.blockElement.classList.add("display-block_hanging-indent"),this.nameElement.classList.add("display-block__name_no-italic")}get name(){return this.nameElement.textContent}set name(e){this.nameElement.textContent=e}get text(){return this.textElement.innerHTMLSanitized}set text(e){this.textElement.innerHTMLSanitized=e}}class ot extends Pe{static get elementName(){return"display-block-list"}static get templatePaths(){return super.templatePaths.set("display-block-list","src/html/elements/autonomous/lists/display-block-list.html")}constructor(){super(ot.templatePaths),this.isLegendaryActionList=!1}get blocks(){return Array.from(this.children)}clear(){for(const e of this.blocks)this.removeChild(e)}addBlock(e,t){const s=ot.createBlock(e,t);this.isLegendaryActionList&&s.applyLegendaryActionStyles(),this.appendChild(s)}static createBlock(e,t){const s=i?new at:document.createElement("display-block");return s.name=e,s.text=t,s}}class rt extends Pe{static get templatePaths(){return super.templatePaths.set("drag-and-drop-list-item","src/html/elements/autonomous/lists/drag-and-drop-list-item.html")}constructor(e,t){super(e,t),this.list=null,this.dragImage=null,this.container=this.shadowRoot.getElementById("drag-and-drop-list-item-container"),this.dragHandle=this.shadowRoot.getElementById("drag-and-drop-list-item-drag-handle")}connectedCallback(){this.dragHandle.style.cssText="user-select: none; -webkit-user-drag: element;",this.dragHandle.setAttribute("draggable","true"),this.addEventListener("dragstart",this.onDragStartItem.bind(this)),this.addEventListener("dragover",this.onDragOverItem.bind(this)),this.addEventListener("dragleave",this.onDragLeaveItem.bind(this)),this.addEventListener("dragend",this.onDragEndItem.bind(this)),this.addEventListener("drop",this.onDropItem.bind(this))}onDragStartItem(e){e.dataTransfer.setData("text",""),e.dataTransfer.setDragImage(this.dragImage,0,0),this.list.draggedItem=e.target}onDragOverItem(e){if(e.preventDefault(),null!==this.list.draggedItem){e.dataTransfer.dropEffect="move";let t=e.target.getBoundingClientRect(),s=t.y+t.height/2;e.clientY<s?this.dragoverRegion="top":this.dragoverRegion="bottom"}else e.dataTransfer.dropEffect="none"}onDragLeaveItem(){this.dragoverRegion="none"}onDragEndItem(){this.list.draggedItem=null}onDropItem(e){e.preventDefault(),"top"===this.dragoverRegion?(this.list.insertDraggedItemBefore(this),this.dragoverRegion="none"):"bottom"===this.dragoverRegion&&(this.list.insertDraggedItemBefore(this.nextElementSibling),this.dragoverRegion="none")}get dragoverRegion(){return this.dataset.dragoverRegion}set dragoverRegion(e){const t="drag-and-drop-list-item__container_dragover-top",s="drag-and-drop-list-item__container_dragover-bottom";switch(e){case"top":this.dataset.dragoverRegion="top",this.container.classList.add(t),this.container.classList.remove(s);break;case"bottom":this.dataset.dragoverRegion="bottom",this.container.classList.remove(t),this.container.classList.add(s);break;default:this.dataset.dragoverRegion="none",this.container.classList.remove(t),this.container.classList.remove(s)}}}class lt extends rt{static get elementName(){return"editable-block"}static get templatePaths(){return super.templatePaths.set("editable-block","src/html/elements/autonomous/lists/editable-block.html")}constructor(){super(lt.templatePaths),this.nameInput=this.shadowRoot.getElementById("editable-block-name"),this.textArea=this.shadowRoot.getElementById("editable-block-textarea"),this.previewContainer=this.shadowRoot.getElementById("editable-block-preview-container"),this.namePreviewElement=this.shadowRoot.getElementById("editable-block-name-preview"),this.textPreviewElement=this.shadowRoot.getElementById("editable-block-text-preview"),this.removeButton=this.shadowRoot.getElementById("editable-block-remove-button"),this.dragImage=this.nameInput,this.isLegendaryActionBlock=!1,Z.applyToElement(this.nameInput),Z.applyToElement(this.textArea)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.nameInput.addEventListener("input",this.onInputName.bind(this)),this.textArea.addEventListener("input",this.onInputText.bind(this)),this.removeButton.addEventListener("click",this.onClickRemoveButton.bind(this)),this.isInitialized=!0)}onInputName(){this.nameInput.value=this.nameInput.value.replace(/\.+$/,""),this.namePreviewElement.textContent=this.nameInput.value}onInputText(){this.textArea.parse(),this.textPreviewElement.innerHTMLSanitized=this.textArea.htmlText}onClickRemoveButton(){this.remove()}convertToLegendaryActionBlock(){this.isLegendaryActionBlock=!0,this.previewContainer.classList.add("editable-block__preview_hanging-indent"),this.nameInput.classList.add("editable-block__name_no-italic"),this.namePreviewElement.classList.add("editable-block__name-preview_no-italic")}set name(e){this.nameInput.value=e}get name(){return this.nameInput.value}set text(e){this.textArea.value=e}get text(){return this.textArea.value}get markdownText(){return this.textArea.markdownText}get htmlText(){return this.textArea.htmlText}set previewName(e){this.namePreviewElement.textContent=e}get previewName(){return this.namePreviewElement.textContent}set previewText(e){this.textPreviewElement.innerHTMLSanitized=e}get previewText(){return this.textPreviewElement.innerHTMLSanitized}validate(e){this.nameInput.validate(e),this.textArea.validate(e)}parse(){this.textArea.parse()}remove(){this.list.removeChild(this)}toModel(){return new(this.isLegendaryActionBlock?Q:V)(this.name,this.text,this.markdownText,this.htmlText)}}class dt extends Pe{constructor(e,t){super(e,t),this.draggedItem=null}insertDraggedItemBefore(e){null!==this.draggedItem&&(this.insertBefore(this.draggedItem,e),this.draggedItem=null)}}class ht extends dt{static get elementName(){return"editable-block-list"}static get templatePaths(){return super.templatePaths.set("editable-block-list","src/html/elements/autonomous/lists/editable-block-list.html")}constructor(){super(ht.templatePaths),this.singleName=null,this.isLegendaryActionList=!1}get blocks(){return Array.from(this.children)}clear(){for(const e of this.blocks)e.remove()}addBlock(e="",t=""){const s=this.createBlock(e,t);return this.isLegendaryActionList&&s.convertToLegendaryActionBlock(),i&&s.connect(),this.appendChild(s),ce(s.nameInput),s}createBlock(e,t){const s=i?new lt:document.createElement("editable-block");return s.list=this,s.name=e,s.text=t,s.nameInput.setAttribute("pretty-name",`${this.singleName} Name`),s.textArea.setAttribute("pretty-name",`${this.singleName} Text`),s}validate(e){for(const t of this.blocks)t.validate(e)}parse(){for(const e of this.blocks)e.parse()}toModel(){return this.blocks.map(e=>e.toModel())}}class ct extends rt{static get elementName(){return"property-list-item"}static get templatePaths(){return super.templatePaths.set("property-list-item","src/html/elements/autonomous/lists/property-list-item.html")}constructor(e){super(ct.templatePaths,e),this.label=this.shadowRoot.getElementById("property-list-item-label"),this.removeButton=this.shadowRoot.getElementById("property-list-item-remove-button"),this.dragImage=this.label}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.removeButton.addEventListener("click",this.onClickRemoveButton.bind(this)),this.isInitialized=!0)}onClickRemoveButton(){this.remove()}get text(){return this.label.textContent}set text(e){this.label.textContent=e}remove(){const e=new CustomEvent("propertyListItemRemoved",{bubbles:!0,composed:!0,detail:{itemText:this.text}});this.dispatchEvent(e),this.list.removeChild(this)}}class ut extends dt{static get elementName(){return"property-list"}static get templatePaths(){return super.templatePaths.set("property-list","src/html/elements/autonomous/lists/property-list.html")}constructor(e){super(ut.templatePaths,e)}set items(e){this.clearItems();for(const t of e)this.addItem(t)}get items(){return Array.from(this.children)}get itemsAsText(){return this.items.map(e=>e.text)}contains(e){return this.itemsAsText.includes(e)}addItem(e){const t=ut.createListItem(this,e);i&&t.connect(),this.appendChild(t)}clearItems(){for(const e of this.items)e.remove()}findItem(e){return this.items.filter(t=>t.text===e)[0]}static createListItem(e,t){const s=i?new ct(e):document.createElement("property-list-item");return s.list=e,s.text=t,s}}class mt extends Pe{static get templatePaths(){return super.templatePaths.set("section","src/html/elements/autonomous/sections/section.html")}constructor(e,t,s,i){super(e),this.modelPropertyName=t,this.dataset.mode="show",this.showElements=new s(this.shadowRoot),this.editElements=new i(this.shadowRoot),this.errorMessages=this.shadowRoot.querySelector("error-messages")}connectedCallback(){this.updateView(),this.showElements.section.addEventListener("click",()=>{this.edit()}),this.showElements.section.addEventListener("animationend",()=>{"edit"===this.mode&&this.focusOnInitialEditSectionElement()}),this.editElements.section.addEventListener("submit",e=>{e.preventDefault(),this.save()})}get mode(){return this.dataset.mode}set mode(e){const t="section_hidden";switch(e){case"hidden":this.dataset.mode="hidden",this.showElements.section.classList.add(t),this.editElements.section.classList.add(t);break;case"show":this.dataset.mode="show",this.showElements.section.classList.remove(t),this.editElements.section.classList.add(t);break;case"edit":this.dataset.mode="edit",this.showElements.section.classList.add(t),this.editElements.section.classList.remove(t);break;default:throw new Error(`'${e}' is not a valid section mode.`)}}get empty(){return"empty"in this.dataset}set empty(e){e?(this.dataset.empty="",this.showElements.section.classList.add("section_empty")):(delete this.dataset.empty,this.showElements.section.classList.remove("section_empty"))}setEmptyVisibility(e){this.empty?e?"hidden"===this.mode&&(this.mode="show",this.dispatchModeChangedEvent()):"show"===this.mode&&(this.mode="hidden",this.dispatchModeChangedEvent()):"hidden"===this.mode&&(this.mode="show",this.dispatchModeChangedEvent())}focusOnInitialEditSectionElement(){ce(this.editElements.initiallySelectedElement)}edit(){this.mode="edit",this.dispatchModeChangedEvent(),this.focusOnInitialEditSectionElement()}save(){this.errorMessages.clear(),this.checkForErrors(),this.errorMessages.any?this.errorMessages.focusOnFirstErrorField():(this.updateModel(),this.updateShowModeView(),this.empty&&!Y.localSettings.emptySectionsVisibility?this.mode="hidden":this.mode="show",this.dispatchModeChangedEvent(),this.dispatchSectionSavedEvent())}checkForErrors(){throw new Error(`The class '${this.constructor.name}' must implement the checkForErrors() method.`)}updateModel(){throw new Error(`The class '${this.constructor.name}' must implement the updateModel() method.`)}updateEditModeView(){throw new Error(`The class '${this.constructor.name}' must implement the updateEditModeView() method.`)}updateShowModeView(){throw new Error(`The class '${this.constructor.name}' must implement the updateShowModeView() method.`)}updateView(){this.updateEditModeView(),this.updateShowModeView()}dispatchModeChangedEvent(){const e=new CustomEvent("sectionModeChanged",{bubbles:!0,composed:!0});this.dispatchEvent(e)}dispatchSectionSavedEvent(){const e=new CustomEvent("sectionSaved",{bubbles:!0,composed:!0});this.dispatchEvent(e)}importFromOpen5e(e){Y.creature[this.modelPropertyName].fromOpen5e(e),this.updateView(),this.setEmptyVisibility(Y.localSettings.emptySectionsVisibility)}importFromJson(e){Y.creature[this.modelPropertyName].fromJson(e),this.updateView(),this.setEmptyVisibility(Y.localSettings.emptySectionsVisibility)}exportToJson(){return Y.creature[this.modelPropertyName].toJson()}exportToHtml(){return Y.creature[this.modelPropertyName].toHtml()}exportToMarkdown(){return Y.creature[this.modelPropertyName].toMarkdown()}}class pt{constructor(e){this.section=e.getElementById("show-section")}}class gt{constructor(e){this.section=e.getElementById("edit-section"),this.saveButton=e.getElementById("save-button")}get initiallySelectedElement(){throw new Error(`The class '${this.constructor.name}' must implement the initiallySelectedElement() getter.`)}submitForm(){this.section.dispatchEvent(new Event("submit"))}}class bt extends mt{static get elementName(){return"title-section"}static get templatePaths(){return super.templatePaths.set("title-section","src/html/elements/autonomous/sections/title-section.html")}constructor(){super(bt.templatePaths,"title",ft,yt)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.fullName.addEventListener("input",this.onInputCreatureName.bind(this)),this.editElements.shortName.addEventListener("input",this.onInputShortName.bind(this)),this.editElements.properNoun.addEventListener("input",this.onInputProperNoun.bind(this)))}onInputCreatureName(){const e=this.editElements.fullName.value;""!==e&&(Y.creature.title.fullName=e,this.dispatchCreatureNameChangedEvent())}onInputShortName(){Y.creature.title.shortName=this.editElements.shortName.value,this.dispatchCreatureNameChangedEvent()}onInputProperNoun(){Y.creature.title.isProperNoun=this.editElements.properNoun.checked,this.dispatchCreatureNameChangedEvent()}get title(){return this.showElements.title.textContent}dispatchCreatureNameChangedEvent(){const e=Y.creature.title,t=new CustomEvent("creatureNameChanged",{bubbles:!0,composed:!0,detail:{creatureName:e.fullName,shortName:e.shortName,isProperNoun:e.isProperNoun}});this.dispatchEvent(t)}checkForErrors(){this.editElements.fullName.value=f(this.editElements.fullName.value.trim()),this.editElements.fullName.validate(this.errorMessages)}updateModel(){const e=Y.creature.title;e.fullName=this.editElements.fullName.value,e.shortName=this.editElements.shortName.value,e.isProperNoun=this.editElements.properNoun.checked}updateEditModeView(){const e=Y.creature.title;this.editElements.fullName.value=e.fullName,this.editElements.shortName.value=e.shortName,this.editElements.properNoun.checked=e.isProperNoun}updateShowModeView(){this.showElements.title.textContent=Y.creature.title.fullName}}class ft extends pt{constructor(e){super(e),this.title=e.getElementById("title-text")}}class yt extends gt{constructor(e){super(e),this.fullName=e.getElementById("full-name-input"),this.shortName=e.getElementById("short-name-input"),this.properNoun=e.getElementById("proper-noun-input")}get initiallySelectedElement(){return this.fullName}}var Et=["aarakocra","aasimar","any race","bullywug","demon","devil","dragonborn","dwarf","elf","firbolg","gith","gnoll","gnome","goblinoid","goliath","grimlock","half-elf","halfling","half-orc","human","kenku","kobold","kuo-toa","lizardfolk","merfolk","orc","quaggoth","sahuagin","shapechanger","tabaxi","thri-kreen","tiefling","titan","triton","troglodyte","yuan-ti","yugoloth"];class vt extends mt{static get elementName(){return"subtitle-section"}static get templatePaths(){return super.templatePaths.set("subtitle-section","src/html/elements/autonomous/sections/subtitle-section.html")}constructor(){super(vt.templatePaths,"subtitle",xt,wt),me(this.editElements.size,Object.keys(l)),me(this.editElements.type,d),function(e,t){for(const s of t)e.appendChild(new Option("",s))}(this.editElements.tagsDataList,Et),me(this.editElements.alignment,h)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.useCustomText.disableElementsWhenChecked(this.editElements.size,this.editElements.type,this.editElements.tags,this.editElements.alignment),this.editElements.useCustomText.enableElementsWhenChecked(this.editElements.customText),this.editElements.size.addEventListener("input",this.onInputCreatureSize.bind(this)),this.isInitialized=!0)}onInputCreatureSize(){const e=this.editElements.size.value;Y.creature.subtitle.size=e,Y.creature.hitPoints.hitDieSize=l[e],this.dispatchCreatureSizeChangedEvent()}dispatchCreatureSizeChangedEvent(){const e=Y.creature.subtitle,t=new CustomEvent("creatureSizeChanged",{bubbles:!0,composed:!0,detail:{creatureSize:e.size}});this.dispatchEvent(t)}checkForErrors(){this.editElements.tags.value=this.editElements.tags.value.trim(),this.editElements.useCustomText.checked&&this.editElements.customText.validate(this.errorMessages)}updateModel(){const e=Y.creature.subtitle;e.size=this.editElements.size.value,e.type=this.editElements.type.value,e.tags=this.editElements.tags.value,e.alignment=this.editElements.alignment.value,e.useCustomText=this.editElements.useCustomText.checked,e.customText=this.editElements.customText.value}updateEditModeView(){const e=Y.creature.subtitle;this.editElements.size.value=e.size,this.editElements.type.value=e.type,this.editElements.tags.value=e.tags,this.editElements.alignment.value=e.alignment,this.editElements.useCustomText.checked=e.useCustomText,this.editElements.customText.value=e.customText,this.editElements.useCustomText.onInputCheckbox()}updateShowModeView(){this.showElements.text.textContent=Y.creature.subtitle.text}}class xt extends pt{constructor(e){super(e),this.text=e.getElementById("subtitle-text")}}class wt extends gt{constructor(e){super(e),this.size=e.getElementById("size-input"),this.type=e.getElementById("type-input"),this.tags=e.getElementById("tags-input"),this.tagsDataList=e.getElementById("tags-list"),this.alignment=e.getElementById("alignment-input"),this.useCustomText=e.getElementById("use-custom-text-input"),this.customText=e.getElementById("custom-text-input")}get initiallySelectedElement(){return this.size}}class kt extends mt{constructor(e,t,s,i){super(e,t,s,i)}}class Ct extends pt{constructor(e){super(e),this.heading=e.getElementById("show-section-heading"),this.text=e.getElementById("show-section-text")}}class St extends gt{constructor(e){super(e)}}class Tt extends kt{static get elementName(){return"armor-class-section"}static get templatePaths(){return super.templatePaths.set("armor-class-section","src/html/elements/autonomous/sections/armor-class-section.html")}constructor(){super(Tt.templatePaths,"armorClass",Mt,Bt)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.useCustomText.disableElementsWhenChecked(this.editElements.armorClass,this.editElements.armorType,this.editElements.hasShield),this.editElements.useCustomText.enableElementsWhenChecked(this.editElements.customText),this.isInitialized=!0)}checkForErrors(){this.editElements.armorType.value=this.editElements.armorType.value.trim(),this.editElements.customText.value=this.editElements.customText.value.trim(),this.editElements.useCustomText.checked?this.editElements.customText.validate(this.errorMessages):this.editElements.armorClass.validate(this.errorMessages)}updateModel(){const e=Y.creature.armorClass;e.armorClass=this.editElements.armorClass.valueAsInt,e.armorType=this.editElements.armorType.value,e.hasShield=this.editElements.hasShield.checked,e.useCustomText=this.editElements.useCustomText.checked,e.customText=this.editElements.customText.value,e.htmlCustomText=this.editElements.customText.htmlText}updateEditModeView(){const e=Y.creature.armorClass;this.editElements.armorClass.value=e.armorClass,this.editElements.armorType.value=e.armorType,this.editElements.hasShield.checked=e.hasShield,this.editElements.useCustomText.checked=e.useCustomText,this.editElements.customText.value=e.customText,e.useCustomText&&(this.editElements.customText.parse(),e.htmlCustomText=this.editElements.customText.htmlText),this.editElements.useCustomText.onInputCheckbox()}updateShowModeView(){const e=Y.creature.armorClass;Y.creature.armorClass.useCustomText?this.showElements.text.innerHTMLSanitized=e.htmlCustomText:this.showElements.text.textContent=e.normalText}}class Mt extends Ct{constructor(e){super(e)}}class Bt extends St{constructor(e){super(e),this.armorClass=e.getElementById("armor-class-input"),this.armorType=e.getElementById("armor-type-input"),this.hasShield=e.getElementById("shield-input"),this.useCustomText=e.getElementById("use-custom-text-input"),this.customText=e.getElementById("custom-text-input")}get initiallySelectedElement(){return this.useCustomText.checked?this.customText:this.armorClass}}class It extends kt{static get elementName(){return"hit-points-section"}static get templatePaths(){return super.templatePaths.set("hit-points-section","src/html/elements/autonomous/sections/hit-points-section.html")}constructor(){super(It.templatePaths,"hitPoints",Dt,Pt)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.useHitDie.disableElementsWhenChecked(this.editElements.hitPoints),this.editElements.useHitDie.enableElementsWhenChecked(this.editElements.hitDieQuantity,this.editElements.hitDieSize),this.editElements.hitPoints.addEventListener("input",this.onInputHitPoints.bind(this)),this.editElements.useHitDie.addEventListener("input",this.onInputUseHitDie.bind(this)),this.editElements.hitDieQuantity.addEventListener("input",this.onInputHitDieQuantity.bind(this)),this.editElements.hitDieSize.addEventListener("input",this.onInputHitDieSize.bind(this)),this.isInitialized=!0)}onInputHitPoints(){this.updateModelHitPoints()}onInputUseHitDie(){this.updateModelUseHitDie(),this.updateEditModeViewHitPoints()}onInputHitDieQuantity(){this.updateModelHitDieQuantity(),this.updateEditModeViewHitPoints(),this.updateEditModeViewConstitutionHitPoints()}onInputHitDieSize(){this.updateModelHitDieSize(),this.updateEditModeViewHitPoints()}checkForErrors(){Y.creature.hitPoints.useHitDie?this.editElements.hitDieQuantity.validate(this.errorMessages):this.editElements.hitPoints.validate(this.errorMessages)}updateModel(){this.updateModelHitPoints(),this.updateModelUseHitDie(),this.updateModelHitDieQuantity(),this.updateModelHitDieSize()}updateModelHitPoints(){const e=this.editElements.hitPoints.valueAsInt;null!==e&&(Y.creature.hitPoints.hitPoints=e)}updateModelUseHitDie(){Y.creature.hitPoints.useHitDie=this.editElements.useHitDie.checked}updateModelHitDieQuantity(){const e=this.editElements.hitDieQuantity.valueAsInt;null!==e&&(Y.creature.hitPoints.hitDieQuantity=e)}updateModelHitDieSize(){const e=this.editElements.hitDieSize.valueAsInt;null!==e&&(Y.creature.hitPoints.hitDieSize=e)}updateEditModeView(){const e=Y.creature.hitPoints;this.editElements.hitPoints.value=e.hitPoints,this.editElements.useHitDie.checked=e.useHitDie,this.editElements.hitDieQuantity.value=e.hitDieQuantity,this.editElements.hitDieSize.value=e.hitDieSize,this.editElements.constitutionHitPoints.textContent=e.constitutionHitPointsText}updateEditModeViewHitPoints(){this.editElements.hitPoints.value=Y.creature.hitPoints.hitPoints}updateEditModeViewConstitutionHitPoints(){this.editElements.constitutionHitPoints.textContent=Y.creature.hitPoints.constitutionHitPointsText}updateShowModeView(){this.showElements.text.textContent=Y.creature.hitPoints.text}}class Dt extends Ct{constructor(e){super(e)}}class Pt extends St{constructor(e){super(e),this.hitPoints=e.getElementById("hit-points-input"),this.useHitDie=e.getElementById("use-hit-die-input"),this.hitDieQuantity=e.getElementById("hit-die-quantity-input"),this.hitDieSize=e.getElementById("hit-die-size-input"),this.constitutionHitPoints=e.getElementById("constitution-hit-points-value-label")}get initiallySelectedElement(){return this.useHitDie.checked?this.hitDieQuantity:this.hitPoints}}class At extends kt{static get elementName(){return"speed-section"}static get templatePaths(){return super.templatePaths.set("speed-section","src/html/elements/autonomous/sections/speed-section.html")}constructor(){super(At.templatePaths,"speed",Rt,Lt)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.useCustomText.disableElementsWhenChecked(this.editElements.walk,this.editElements.burrow,this.editElements.climb,this.editElements.fly,this.editElements.hover,this.editElements.swim),this.editElements.useCustomText.enableElementsWhenChecked(this.editElements.customText),this.isInitialized=!0)}checkForErrors(){this.editElements.customText.value=this.editElements.customText.value.trim(),this.editElements.useCustomText.checked&&this.editElements.customText.validate(this.errorMessages)}updateModel(){const e=Y.creature.speed;e.walk=this.editElements.walk.valueAsInt,e.burrow=this.editElements.burrow.valueAsInt,e.climb=this.editElements.climb.valueAsInt,e.fly=this.editElements.fly.valueAsInt,e.hover=this.editElements.hover.checked,e.swim=this.editElements.swim.valueAsInt,e.useCustomText=this.editElements.useCustomText.checked,e.customText=this.editElements.customText.value,e.htmlCustomText=this.editElements.customText.htmlText}updateEditModeView(){const e=Y.creature.speed;this.editElements.walk.value=e.walk,this.editElements.burrow.value=e.burrow,this.editElements.climb.value=e.climb,this.editElements.fly.value=e.fly,this.editElements.hover.checked=e.hover,this.editElements.swim.value=e.swim,this.editElements.useCustomText.checked=e.useCustomText,this.editElements.customText.value=e.customText,e.useCustomText&&(this.editElements.customText.parse(),e.htmlCustomText=this.editElements.customText.htmlText),this.editElements.useCustomText.onInputCheckbox()}updateShowModeView(){const e=Y.creature.speed;e.useCustomText?this.showElements.text.innerHTMLSanitized=e.htmlCustomText:this.showElements.text.textContent=e.normalText}}class Rt extends Ct{constructor(e){super(e)}}class Lt extends St{constructor(e){super(e),this.walk=e.getElementById("walk-input"),this.burrow=e.getElementById("burrow-input"),this.climb=e.getElementById("climb-input"),this.fly=e.getElementById("fly-input"),this.hover=e.getElementById("hover-input"),this.swim=e.getElementById("swim-input"),this.useCustomText=e.getElementById("use-custom-text-input"),this.customText=e.getElementById("custom-text-input")}get initiallySelectedElement(){return this.useCustomText.checked?this.customText:this.walk}}class Nt extends mt{static get elementName(){return"ability-scores-section"}static get templatePaths(){return super.templatePaths.set("ability-scores-section","src/html/elements/autonomous/sections/ability-scores-section.html")}constructor(){super(Nt.templatePaths,"abilities",zt,Ht);for(const e of Y.creature.abilities.keys)this.editElements.score[e].addEventListener("input",this.onInputAbilityScore.bind(this,e))}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.isInitialized=!0)}onInputAbilityScore(e){this.updateModelAbilityScore(e),this.updateEditModeViewAbilityModifier(e),this.updateShowModeViewAbility(e)}checkForErrors(){for(const e of Y.creature.abilities.keys)this.editElements.score[e].validate(this.errorMessages)}updateModel(){for(const e of Y.creature.abilities.keys)this.updateModelAbilityScore(e)}updateModelAbilityScore(e){const t=this.editElements.score[e].valueAsInt;null!==t&&(Y.creature.abilities.abilities[e].score=t,this.dispatchAbilityScoreChangedEvent(e))}dispatchAbilityScoreChangedEvent(e){const t=new CustomEvent("abilityScoreChanged",{bubbles:!0,composed:!0,detail:{abilityName:e}});this.dispatchEvent(t)}updateEditModeView(){for(const e of Y.creature.abilities.keys)this.updateEditModeViewAbilityScore(e),this.updateEditModeViewAbilityModifier(e)}updateEditModeViewAbilityScore(e){this.editElements.score[e].value=Y.creature.abilities.abilities[e].score}updateEditModeViewAbilityModifier(e){this.editElements.modifier[e].textContent=Y.creature.abilities.abilities[e].formattedModifier}updateShowModeView(){for(const e of Y.creature.abilities.keys)this.updateShowModeViewAbility(e)}updateShowModeViewAbility(e){const t=Y.creature.abilities.abilities[e];this.showElements.score[e].textContent=t.score,this.showElements.modifier[e].textContent=t.formattedModifier}importFromJson(e){Y.creature.abilities.fromJson(e),this.updateView()}}class zt extends pt{constructor(e){super(e),this.score={},this.modifier={};for(const t of Y.creature.abilities.keys)this.score[t]=e.getElementById(`${t}-score-show`),this.modifier[t]=e.getElementById(`${t}-modifier-show`)}}class Ht extends gt{constructor(e){super(e),this.score={},this.modifier={};for(const t of Y.creature.abilities.keys)this.score[t]=e.getElementById(`${t}-score-edit`),this.modifier[t]=e.getElementById(`${t}-modifier-edit`)}get initiallySelectedElement(){return this.score.strength}}class $t extends kt{static get elementName(){return"saving-throws-section"}static get templatePaths(){return super.templatePaths.set("saving-throws-section","src/html/elements/autonomous/sections/saving-throws-section.html")}constructor(){super($t.templatePaths,"savingThrows",Ot,Ft),this.empty=!0}connectedCallback(){if(this.isConnected&&!this.isInitialized){super.connectedCallback();for(const e of Y.creature.savingThrows.keys)this.initializeSavingThrowElements(e);this.isInitialized=!0}}initializeSavingThrowElements(e){const t=this.editElements.savingThrow[e];t.enable.enableElementsWhenChecked(t.label,t.modifier,t.override),t.enable.addEventListener("input",this.onInputSavingThrowEnabled.bind(this,e)),t.override.addEventListener("input",this.onInputSavingThrowOverride.bind(this,e))}onInputSavingThrowEnabled(e){const t=this.editElements.savingThrow[e];t.enable.checked||ue(t.override,""),this.updateModelSavingThrowEnabled(e),this.updateEditModeViewSavingThrowModifier(e),this.updateShowModeView()}onInputSavingThrowOverride(e){this.updateModelSavingThrowOverride(e),this.updateEditModeViewSavingThrowModifier(e),this.updateShowModeView()}checkForErrors(){}updateModel(){for(const e of Y.creature.savingThrows.keys)this.updateModelSavingThrowEnabled(e),this.updateModelSavingThrowOverride(e)}updateModelSavingThrowEnabled(e){Y.creature.savingThrows.savingThrows[e].isEnabled=this.editElements.savingThrow[e].enable.checked}updateModelSavingThrowOverride(e){Y.creature.savingThrows.savingThrows[e].override=this.editElements.savingThrow[e].override.valueAsInt}updateViewOnAttributeChange(e){if(e)this.updateEditModeViewSavingThrowModifier(e);else for(const e of Y.creature.savingThrows.keys)this.updateEditModeViewSavingThrowModifier(e);this.updateShowModeView()}updateEditModeView(){for(const e of Y.creature.savingThrows.keys)this.updateEditModeViewSavingThrow(e),this.editElements.savingThrow[e].enable.onInputCheckbox()}updateEditModeViewSavingThrow(e){const t=this.editElements.savingThrow[e],s=Y.creature.savingThrows;t.enable.checked=s.savingThrows[e].isEnabled,t.modifier.textContent=s.savingThrows[e].formattedModifier,t.override.value=s.savingThrows[e].override}updateEditModeViewSavingThrowModifier(e){this.editElements.savingThrow[e].modifier.textContent=Y.creature.savingThrows.savingThrows[e].formattedModifier}updateShowModeView(){const e=Y.creature.savingThrows.text;this.empty=""===e,this.showElements.text.textContent=e}}class Ot extends Ct{constructor(e){super(e)}}class Ft extends St{constructor(e){super(e),this.savingThrow={};for(const t of Y.creature.savingThrows.keys)this.savingThrow[t]={enable:e.getElementById(`${t}-enable`),label:e.getElementById(`${t}-label`),modifier:e.getElementById(`${t}-saving-throw-modifier`),override:e.getElementById(`${t}-override`)}}get initiallySelectedElement(){return this.savingThrow.strength.enable}}class Vt extends kt{static get elementName(){return"skills-section"}static get templatePaths(){return super.templatePaths.set("skills-section","src/html/elements/autonomous/sections/skills-section.html")}constructor(){super(Vt.templatePaths,"skills",_t,Jt),this.empty=!0}connectedCallback(){if(this.isConnected&&!this.isInitialized){super.connectedCallback();for(const e of Y.creature.skills.keys)this.initializeSkillElements(e);this.isInitialized=!0}}initializeSkillElements(e){const t=this.editElements.skill[e];t.enable.enableElementsWhenChecked(t.label,t.modifier,t.expert,t.override),t.enable.addEventListener("input",this.onInputSkillEnabled.bind(this,e)),t.expert.addEventListener("input",this.onInputSkillExpertise.bind(this,e)),t.override.addEventListener("input",this.onInputSkillOverride.bind(this,e))}onInputSkillEnabled(e){const t=this.editElements.skill[e];t.enable.checked||(ue(t.expert,!1),ue(t.override,"")),this.updateModelSkillEnabled(e),this.updateEditModeViewSkillModifier(e),this.updateShowModeView(),this.dispatchSkillChangedEvent(e)}onInputSkillExpertise(e){this.updateModelSkillExpertise(e),this.updateEditModeViewSkillModifier(e),this.updateShowModeView(),this.dispatchSkillChangedEvent(e)}onInputSkillOverride(e){this.updateModelSkillOverride(e),this.updateEditModeViewSkillModifier(e),this.updateShowModeView(),this.dispatchSkillChangedEvent(e)}dispatchSkillChangedEvent(e){const t=new CustomEvent("skillChanged",{bubbles:!0,composed:!0,detail:{skillName:e}});this.dispatchEvent(t)}checkForErrors(){}updateModel(){for(const e of Y.creature.skills.keys)this.updateModelSkillEnabled(e),this.updateModelSkillExpertise(e),this.updateModelSkillOverride(e)}updateModelSkillEnabled(e){Y.creature.skills.skills[e].isEnabled=this.editElements.skill[e].enable.checked}updateModelSkillExpertise(e){Y.creature.skills.skills[e].hasExpertise=this.editElements.skill[e].expert.checked}updateModelSkillOverride(e){Y.creature.skills.skills[e].override=this.editElements.skill[e].override.valueAsInt}updateViewOnAttributeChange(e){const t=Y.creature.skills;if(e)for(const[s,i]of t.entries)Y.creature.abilities.abilities[e]===i.abilityModel&&this.updateEditModeViewSkillModifier(s);else for(const e of t.keys)this.updateEditModeViewSkillModifier(e);this.updateShowModeView()}updateEditModeView(){for(const e of Y.creature.skills.keys)this.updateEditModeViewSkill(e),this.editElements.skill[e].enable.onInputCheckbox()}updateEditModeViewSkill(e){const t=this.editElements.skill[e],s=Y.creature.skills;t.enable.checked=s.skills[e].isEnabled,t.modifier.textContent=s.skills[e].formattedModifier,t.expert.checked=s.skills[e].hasExpertise,t.override.value=s.skills[e].override}updateEditModeViewSkillModifier(e){this.editElements.skill[e].modifier.textContent=Y.creature.skills.skills[e].formattedModifier}updateShowModeView(){const e=Y.creature.skills.text;this.empty=""===e,this.showElements.text.textContent=e}}class _t extends Ct{constructor(e){super(e)}}class Jt extends St{constructor(e){super(e),this.skill={};for(const t of Y.creature.skills.keys)this.skill[t]={enable:e.getElementById(`${t}-enable`),label:e.getElementById(`${t}-label`),modifier:e.getElementById(`${t}-skill-modifier`),expert:e.getElementById(`${t}-expert`),override:e.getElementById(`${t}-override`)}}get initiallySelectedElement(){return this.skill.acrobatics.enable}}class jt extends kt{static get templatePaths(){return super.templatePaths.set("property-list-section","src/html/elements/autonomous/sections/property-list-section.html")}constructor(e,t,s=Gt,i=Qt){super(e,t,s,i);const n=Y.creature[this.modelPropertyName];this.showElements.heading.textContent=n.headingName,this.editElements.label.textContent=`${n.headingName}:`}connectedCallback(){super.connectedCallback(),this.editElements.input.addEventListener("keydown",this.onEnterKeyDownOnInputField.bind(this)),this.editElements.addButton.addEventListener("click",this.onClickAddButton.bind(this)),this.addEventListener("propertyListItemRemoved",this.onPropertyListItemRemoved.bind(this))}onEnterKeyDownOnInputField(e){"Enter"===e.key&&(e.preventDefault(),this.addItemFromInput())}onClickAddButton(){this.addItemFromInput()}onPropertyListItemRemoved(e){const t=e.detail.itemText;this.editElements.dataList.setOptionEnabled(t,!0)}addItemFromInput(){const e=Y.creature[this.modelPropertyName],t=this.editElements.input.value.trim();this.editElements.input.value=t,this.errorMessages.clear(),""===t?this.errorMessages.add(this.editElements.input,`Cannot add a blank ${e.singleName}.`):this.editElements.propertyList.contains(t)&&this.errorMessages.add(this.editElements.input,`Cannot add a duplicate ${e.singleName}.`),this.errorMessages.any?this.errorMessages.focusOnFirstErrorField():(this.addItem(t),this.editElements.input.value="",this.editElements.input.select())}addItem(e){this.editElements.propertyList.addItem(e),this.editElements.dataList.setOptionEnabled(e,!1)}checkForErrors(){const e=this.editElements.input;if(""!==e.value){const t=`Cannot save while the ${Y.creature[this.modelPropertyName].singleName} field contains text.\nClear or add the field, then try again.`;this.errorMessages.add(e,t)}}updateModel(){Y.creature[this.modelPropertyName].items=this.editElements.propertyList.itemsAsText}updateEditModeView(){this.editElements.propertyList.items=Y.creature[this.modelPropertyName].items}updateShowModeView(){const e=Y.creature[this.modelPropertyName].text;this.empty=""===e,this.showElements.text.textContent=e}}class Gt extends Ct{constructor(e){super(e)}}class Qt extends St{constructor(e){super(e),this.label=e.getElementById("property-list-label"),this.input=e.getElementById("property-list-input"),this.addButton=e.getElementById("property-list-add-button"),this.propertyList=e.getElementById("property-list"),this.dataList=e.getElementById("property-list-datalist")}get initiallySelectedElement(){return this.input}}class Wt extends jt{static get elementName(){return"damage-vulnerabilities-section"}static get templatePaths(){return super.templatePaths.set("damage-vulnerabilities-section","src/html/elements/autonomous/sections/damage-vulnerabilities-section.html")}constructor(){super(Wt.templatePaths,"damageVulnerabilities"),this.empty=!0}}class qt extends jt{static get elementName(){return"damage-resistances-section"}static get templatePaths(){return super.templatePaths.set("damage-resistances-section","src/html/elements/autonomous/sections/damage-resistances-section.html")}constructor(){super(qt.templatePaths,"damageResistances"),this.empty=!0}}class Ut extends jt{static get elementName(){return"damage-immunities-section"}static get templatePaths(){return super.templatePaths.set("damage-immunities-section","src/html/elements/autonomous/sections/damage-immunities-section.html")}constructor(){super(Ut.templatePaths,"damageImmunities"),this.empty=!0}}class Kt extends jt{static get elementName(){return"condition-immunities-section"}static get templatePaths(){return super.templatePaths.set("condition-immunities-section","src/html/elements/autonomous/sections/condition-immunities-section.html")}constructor(){super(Kt.templatePaths,"conditionImmunities"),this.empty=!0}}class Yt extends kt{static get elementName(){return"senses-section"}static get templatePaths(){return super.templatePaths.set("senses-section","src/html/elements/autonomous/sections/senses-section.html")}constructor(){super(Yt.templatePaths,"senses",Xt,Zt)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.useCustomText.disableElementsWhenChecked(this.editElements.blindsight,this.editElements.blindBeyondThisRadius,this.editElements.darkvision,this.editElements.tremorsense,this.editElements.truesight),this.editElements.useCustomText.enableElementsWhenChecked(this.editElements.customText))}checkForErrors(){this.editElements.customText.value=this.editElements.customText.value.trim(),this.editElements.useCustomText.checked&&this.editElements.customText.validate(this.errorMessages)}updateModel(){const e=Y.creature.senses;e.blindsight=this.editElements.blindsight.valueAsInt,e.blindBeyondThisRadius=this.editElements.blindBeyondThisRadius.checked,e.darkvision=this.editElements.darkvision.valueAsInt,e.tremorsense=this.editElements.tremorsense.valueAsInt,e.truesight=this.editElements.truesight.valueAsInt,e.useCustomText=this.editElements.useCustomText.checked,e.customText=this.editElements.customText.value,e.htmlCustomText=this.editElements.customText.htmlText}updateViewOnAttributeChange(){this.updateEditModeViewPassivePerception(),this.updateShowModeView()}updateEditModeView(){const e=Y.creature.senses;this.editElements.blindsight.value=e.blindsight,this.editElements.blindBeyondThisRadius.checked=e.blindBeyondThisRadius,this.editElements.darkvision.value=e.darkvision,this.editElements.tremorsense.value=e.tremorsense,this.editElements.truesight.value=e.truesight,this.editElements.useCustomText.checked=e.useCustomText,this.editElements.customText.value=e.customText,e.useCustomText&&(this.editElements.customText.parse(),e.htmlCustomText=this.editElements.customText.htmlText),this.updateEditModeViewPassivePerception(),this.editElements.useCustomText.onInputCheckbox()}updateEditModeViewPassivePerception(){this.editElements.passivePerception.textContent=Y.creature.senses.passivePerception}updateShowModeView(){const e=Y.creature.senses;e.useCustomText?this.showElements.text.innerHTMLSanitized=e.htmlCustomText:this.showElements.text.textContent=e.normalText}}class Xt extends Ct{constructor(e){super(e)}}class Zt extends St{constructor(e){super(e),this.blindsight=e.getElementById("blindsight-input"),this.blindBeyondThisRadius=e.getElementById("blind-beyond-this-radius-input"),this.darkvision=e.getElementById("darkvision-input"),this.tremorsense=e.getElementById("tremorsense-input"),this.truesight=e.getElementById("truesight-input"),this.passivePerception=e.getElementById("passive-perception-value"),this.useCustomText=e.getElementById("use-custom-text-input"),this.customText=e.getElementById("custom-text-input")}get initiallySelectedElement(){return this.useCustomText.checked?this.customText:this.blindsight}}class es extends jt{static get elementName(){return"languages-section"}static get templatePaths(){return super.templatePaths.set("languages-section","src/html/elements/autonomous/sections/languages-section.html")}constructor(){super(es.templatePaths,"languages",ts,ss)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.isInitialized=!0)}updateModel(){super.updateModel(),Y.creature.languages.telepathy=this.editElements.telepathy.valueAsInt}updateEditModeView(){super.updateEditModeView(),this.editElements.telepathy.value=Y.creature.languages.telepathy}}class ts extends Gt{constructor(e){super(e)}}class ss extends Qt{constructor(e){super(e),this.telepathy=e.getElementById("telepathy-input")}}class is extends kt{static get elementName(){return"challenge-rating-section"}static get templatePaths(){return super.templatePaths.set("challenge-rating-section","src/html/elements/autonomous/sections/challenge-rating-section.html")}constructor(){super(is.templatePaths,"challengeRating",ns,as),this.editElements.challengeRating.addEventListener("input",this.onInputChallengeRating.bind(this)),this.editElements.experiencePoints.addEventListener("input",this.onInputExperiencePoints.bind(this)),this.editElements.proficiencyBonus.addEventListener("input",this.onInputProficiencyBonus.bind(this))}onInputChallengeRating(){const e=this.editElements.challengeRating.value;Y.creature.challengeRating.challengeRating=e,Y.creature.challengeRating.updateExperiencePointsAndProficiencyBonusFromChallengeRating(),this.updateEditModeView(),this.dispatchProficiencyBonusChangedEvent()}onInputExperiencePoints(){const e=this.editElements.experiencePoints.valueAsInt;null!==e&&(Y.creature.challengeRating.experiencePoints=e)}onInputProficiencyBonus(){const e=this.editElements.proficiencyBonus.valueAsInt;null!==e&&(Y.creature.challengeRating.proficiencyBonus=e,this.dispatchProficiencyBonusChangedEvent())}checkForErrors(){this.editElements.experiencePoints.validate(this.errorMessages),this.editElements.proficiencyBonus.validate(this.errorMessages)}updateModel(){}updateEditModeView(){const e=Y.creature.challengeRating;this.editElements.challengeRating.value=e.challengeRating,this.editElements.experiencePoints.value=e.experiencePoints,this.editElements.proficiencyBonus.value=e.proficiencyBonus}updateShowModeView(){this.showElements.text.textContent=Y.creature.challengeRating.text}dispatchProficiencyBonusChangedEvent(){const e=new CustomEvent("proficiencyBonusChanged",{bubbles:!0,composed:!0,detail:{}});this.dispatchEvent(e)}}class ns extends Ct{constructor(e){super(e)}}class as extends St{constructor(e){super(e),this.challengeRating=e.getElementById("challenge-rating-input"),this.experiencePoints=e.getElementById("experience-points-input"),this.proficiencyBonus=e.getElementById("proficiency-bonus-input")}get initiallySelectedElement(){return this.challengeRating}}class os extends mt{static get templatePaths(){return super.templatePaths.set("block-list-section","src/html/elements/autonomous/sections/block-list-section.html")}constructor(e,t,s=rs,i=ls){super(e,t,s,i),this.heading=this.shadowRoot.getElementById("heading")}connectedCallback(){this.editElements.editableBlockList.singleName=Y.creature[this.modelPropertyName].singleName,super.connectedCallback(),this.reparse(),this.editElements.addButton.addEventListener("click",this.onClickAddTextBlockButton.bind(this))}onClickAddTextBlockButton(){this.addBlock()}addBlock(e="",t=""){this.editElements.editableBlockList.addBlock(e,t)}get mode(){return super.mode}set mode(e){super.mode=e;switch(e){case"hidden":this.heading.classList.add("block-list-section__heading_hidden");break;case"show":case"edit":this.heading.classList.remove("block-list-section__heading_hidden")}}get empty(){return super.empty}set empty(e){super.empty=e;e?this.showElements.emptyLabel.classList.remove("block-list-section__empty-label_hidden"):this.showElements.emptyLabel.classList.add("block-list-section__empty-label_hidden")}checkForErrors(){this.editElements.editableBlockList.validate(this.errorMessages)}updateModel(){Y.creature[this.modelPropertyName].blocks=this.editElements.editableBlockList.toModel()}updateEditModeView(){const e=Y.creature[this.modelPropertyName].blocks;this.editElements.editableBlockList.clear();for(const t of e)this.editElements.editableBlockList.addBlock(t.name,t.text)}updateShowModeView(){const e=Y.creature[this.modelPropertyName].blocks;this.showElements.displayBlockList.clear();for(const t of e)this.showElements.displayBlockList.addBlock(t.name,t.htmlText);this.empty=e.length<=0}reparse(){this.editElements.editableBlockList.parse(),this.updateModel();for(const[e,t]of Y.creature[this.modelPropertyName].blocks.entries()){const s=this.editElements.editableBlockList.blocks[e];if(s.previewName=t.name,s.previewText=t.htmlText,"show"===this.mode){this.showElements.displayBlockList.blocks[e].text=t.htmlText}}}importFromOpen5e(e){super.importFromOpen5e(e),this.reparse()}importFromJson(e){super.importFromJson(e),this.reparse()}}class rs extends pt{constructor(e){super(e),this.emptyLabel=e.getElementById("empty-label"),this.displayBlockList=e.getElementById("display-block-list")}}class ls extends gt{constructor(e){super(e),this.editableBlockList=e.getElementById("editable-block-list"),this.addButton=e.getElementById("add-button")}get initiallySelectedElement(){return this.editableBlockList.blocks.length>0?this.editableBlockList.blocks[0].nameInput:this.addButton}}class ds extends os{static get elementName(){return"special-traits-section"}static get templatePaths(){return super.templatePaths.set("special-traits-section","src/html/elements/autonomous/sections/special-traits-section.html")}constructor(){super(ds.templatePaths,"specialTraits"),this.empty=!0}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.isInitialized=!0)}}class hs extends os{static get elementName(){return"actions-section"}static get templatePaths(){return super.templatePaths.set("actions-section","src/html/elements/autonomous/sections/actions-section.html")}constructor(){super(hs.templatePaths,"actions",cs,us),this.empty=!0}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.generateAttackButton.addEventListener("click",this.onClickGenerateAttackButton.bind(this)),this.addEventListener("generateAttack",this.onGenerateAttackEvent.bind(this)),this.isInitialized=!0)}onClickGenerateAttackButton(){this.editElements.generateAttackDialog.launch()}onGenerateAttackEvent(e){this.addBlock(e.detail.name,e.detail.text),this.reparse()}reparse(){super.reparse(),this.editElements.generateAttackDialog.update()}}class cs extends rs{constructor(e){super(e)}}class us extends ls{constructor(e){super(e),this.generateAttackButton=e.getElementById("generate-attack-button"),this.generateAttackDialog=e.getElementById("generate-attack-dialog")}}class ms extends os{static get elementName(){return"reactions-section"}static get templatePaths(){return super.templatePaths.set("reactions-section","src/html/elements/autonomous/sections/reactions-section.html")}constructor(){super(ms.templatePaths,"reactions"),this.empty=!0}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.isInitialized=!0)}}class ps extends os{static get elementName(){return"legendary-actions-section"}static get templatePaths(){return super.templatePaths.set("legendary-actions-section","src/html/elements/autonomous/sections/legendary-actions-section.html")}constructor(){super(ps.templatePaths,"legendaryActions",gs,bs),this.empty=!0}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.showElements.displayBlockList.isLegendaryActionList=!0,this.editElements.editableBlockList.isLegendaryActionList=!0,this.isInitialized=!0)}get empty(){return super.empty}set empty(e){super.empty=e;e?this.showElements.description.classList.add("legendary-actions-show-section__text_hidden"):this.showElements.description.classList.remove("legendary-actions-show-section__text_hidden")}checkForErrors(){super.checkForErrors(),this.editElements.description.validate(this.errorMessages)}updateModel(){super.updateModel();const e=Y.creature.legendaryActions;e.description=this.editElements.description.value,e.markdownDescription=this.editElements.description.markdownText,e.htmlDescription=this.editElements.description.htmlText}updateEditModeView(){super.updateEditModeView(),this.editElements.description.value=Y.creature.legendaryActions.description}updateShowModeView(){super.updateShowModeView(),this.showElements.description.innerHTMLSanitized=Y.creature.legendaryActions.htmlDescription}reparse(){this.editElements.description.parse(),super.reparse(),"show"===this.mode&&(this.showElements.description.innerHTMLSanitized=Y.creature.legendaryActions.htmlDescription)}}class gs extends rs{constructor(e){super(e),this.description=e.getElementById("description-show")}}class bs extends ls{constructor(e){super(e),this.description=e.getElementById("description-edit")}}function fs(e){const t=function(e){const t=document.createElement("iframe");return t.addEventListener("load",ys),t.style.position="fixed",t.style.right="0",t.style.bottom="0",t.style.width="0",t.style.height="0",t.style.border="0",t.srcdoc=e,t}(e);document.body.appendChild(t)}function ys(){this.contentWindow.__container__=this,this.contentWindow.addEventListener("beforeunload",Es),this.contentWindow.addEventListener("afterprint",Es),this.contentWindow.focus(),this.contentWindow.print()}function Es(){document.body.removeChild(this.__container__)}class vs extends Pe{static get elementName(){return"stat-block-menu"}static get templatePaths(){return super.templatePaths.set("stat-block-menu","src/html/elements/autonomous/containers/stat-block-menu.html")}constructor(e=null){super(vs.templatePaths,e),this.oneColumnButton=this.shadowRoot.getElementById("one-column-label"),this.twoColumnButton=this.shadowRoot.getElementById("two-column-label"),this.showEmptySectionsButton=this.shadowRoot.getElementById("show-empty-sections-label"),this.hideEmptySectionsButton=this.shadowRoot.getElementById("hide-empty-sections-label"),this.editAllSectionsButton=this.shadowRoot.getElementById("edit-all-sections-button"),this.saveAllSectionsButton=this.shadowRoot.getElementById("save-all-sections-button"),this.resetButton=this.shadowRoot.getElementById("reset-button"),this.importJsonButton=this.shadowRoot.getElementById("import-json-button"),this.importSrdButton=this.shadowRoot.getElementById("import-srd-button"),this.importOpen5eButton=this.shadowRoot.getElementById("import-open5e-button"),this.exportJsonButton=this.shadowRoot.getElementById("export-json-button"),this.exportHtmlButton=this.shadowRoot.getElementById("export-html-button"),this.exportMarkdownButton=this.shadowRoot.getElementById("export-markdown-button"),this.printButton=this.shadowRoot.getElementById("print-button"),this.gettingStartedButton=this.shadowRoot.getElementById("getting-started-button"),this.wikiButton=this.shadowRoot.getElementById("wiki-button"),this.githubButton=this.shadowRoot.getElementById("github-button"),this.versionButton=this.shadowRoot.getElementById("version-button")}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.oneColumnButton.addEventListener("click",this.onClickOneColumnButton.bind(this)),this.twoColumnButton.addEventListener("click",this.onClickTwoColumnButton.bind(this)),this.showEmptySectionsButton.addEventListener("click",this.onClickShowEmptySectionsButton.bind(this)),this.hideEmptySectionsButton.addEventListener("click",this.onClickHideEmptySectionsButton.bind(this)),this.editAllSectionsButton.addEventListener("click",this.onClickEditAllSectionsButton.bind(this)),this.saveAllSectionsButton.addEventListener("click",this.onClickSaveAllSectionsButton.bind(this)),this.resetButton.addEventListener("click",this.onClickResetButton.bind(this)),this.importJsonButton.addEventListener("click",this.onClickImportJsonButton.bind(this)),this.importSrdButton.addEventListener("click",this.onClickImportSrdButton.bind(this)),this.importOpen5eButton.addEventListener("click",this.onClickImportOpen5eButton.bind(this)),this.exportJsonButton.addEventListener("click",this.onClickExportJsonButton.bind(this)),this.exportHtmlButton.addEventListener("click",this.onClickExportHtmlButton.bind(this)),this.exportMarkdownButton.addEventListener("click",this.onClickExportMarkdownButton.bind(this)),this.printButton.addEventListener("click",this.onClickPrintButton.bind(this)),this.gettingStartedButton.addEventListener("click",this.onClickGettingStartedButton.bind(this)),this.wikiButton.addEventListener("click",this.onClickWikiButton.bind(this)),this.githubButton.addEventListener("click",this.onClickGithubButton.bind(this)),this.versionButton.addEventListener("click",this.onClickVersionButton.bind(this)),this.versionButton.textContent=`Version: ${Y.localSettings.version}`,this.isInitialized=!0)}onClickOneColumnButton(){this.dispatchMenuEvent("numberOfColumnsChanged",{columns:1})}onClickTwoColumnButton(){this.dispatchMenuEvent("numberOfColumnsChanged",{columns:2})}onClickShowEmptySectionsButton(){this.dispatchMenuEvent("emptySectionsVisibilityChanged",{visibility:!0})}onClickHideEmptySectionsButton(){this.dispatchMenuEvent("emptySectionsVisibilityChanged",{visibility:!1})}onClickEditAllSectionsButton(){this.dispatchMenuEvent("allSectionsAction",{action:"edit"})}onClickSaveAllSectionsButton(){this.dispatchMenuEvent("allSectionsAction",{action:"save"})}onClickResetButton(){this.dispatchMenuEvent("resetAction")}onClickImportJsonButton(){this.dispatchMenuEvent("importAction",{format:"json"})}onClickImportSrdButton(){this.dispatchMenuEvent("importAction",{format:"srd"})}onClickImportOpen5eButton(){this.dispatchMenuEvent("importAction",{format:"open5e"})}onClickExportJsonButton(){this.dispatchMenuEvent("exportAction",{format:"json"})}onClickExportHtmlButton(){this.dispatchMenuEvent("exportAction",{format:"html"})}onClickExportMarkdownButton(){this.dispatchMenuEvent("exportAction",{format:"markdown"})}onClickPrintButton(){this.dispatchMenuEvent("printAction")}onClickGettingStartedButton(){this.dispatchMenuEvent("toggleGettingStarted")}onClickWikiButton(){window.open("https://github.com/Frumple/statblock5e-creator/wiki")}onClickGithubButton(){window.open("https://github.com/Frumple/statblock5e-creator")}onClickVersionButton(){window.open("https://github.com/Frumple/statblock5e-creator/releases")}dispatchMenuEvent(e,t=null){const s=new CustomEvent(e,{bubbles:!0,composed:!0,detail:t});this.dispatchEvent(s)}updateColumnControls(){const e=Y.layoutSettings;1===e.columns?this.oneColumnButton.click():2===e.columns&&this.twoColumnButton.click()}updateEmptySectionControls(){Y.localSettings.emptySectionsVisibility?this.showEmptySectionsButton.click():this.hideEmptySectionsButton.click()}}class xs extends Pe{static get elementName(){return"stat-block-sidebar"}static get templatePaths(){return super.templatePaths.set("stat-block-sidebar","src/html/elements/autonomous/containers/stat-block-sidebar.html")}constructor(e=null){super(xs.templatePaths,e),this.sidebar=this.shadowRoot.getElementById("stat-block-sidebar"),this.autoHeightModeButton=this.shadowRoot.getElementById("auto-height-mode-label"),this.manualHeightModeButton=this.shadowRoot.getElementById("manual-height-mode-label"),this.manualHeightSliderContainer=this.shadowRoot.getElementById("slider-container"),this.manualHeightSlider=this.shadowRoot.getElementById("slider")}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.autoHeightModeButton.addEventListener("click",this.onClickAutoHeightModeButton.bind(this)),this.manualHeightModeButton.addEventListener("click",this.onClickManualHeightModeButton.bind(this)),this.manualHeightSlider.addEventListener("input",this.onInputSlider.bind(this)),this.isInitialized=!0)}onClickAutoHeightModeButton(){this.heightMode="auto",this.dispatchHeightChangedEvent("auto")}onClickManualHeightModeButton(){this.heightMode="manual",this.dispatchHeightChangedEvent("manual")}onInputSlider(){this.dispatchHeightChangedEvent("manual")}dispatchHeightChangedEvent(e){const t=w(this.manualHeightSlider.value),s=new CustomEvent("twoColumnHeightChanged",{bubbles:!0,composed:!0,detail:{mode:e,height:t}});this.dispatchEvent(s)}get visible(){return"visible"in this.dataset}set visible(e){e?(this.dataset.visible="",this.sidebar.classList.remove("stat-block-sidebar_hidden")):(delete this.dataset.visible,this.sidebar.classList.add("stat-block-sidebar_hidden"))}get heightMode(){return this.dataset.heightMode}set heightMode(e){"auto"===e?(this.dataset.heightMode="auto",this.manualHeightSliderContainer.classList.add("stat-block-sidebar__slider-container_hidden")):"manual"===e&&(this.dataset.heightMode="manual",this.manualHeightSliderContainer.classList.remove("stat-block-sidebar__slider-container_hidden"))}updateControls(){const e=Y.layoutSettings;this.manualHeightSlider.value=e.twoColumnHeight,"auto"===e.twoColumnMode?this.autoHeightModeButton.click():"manual"===e.twoColumnMode&&this.manualHeightModeButton.click()}}class ws extends Pe{constructor(e){super(e),this.sections=new Map}setEmptyVisibility(e){for(const t of this.sections.values())t.setEmptyVisibility(e)}edit(){for(const e of this.sections.values())e.edit()}save(){for(const e of this.sections.values())e.save()}updateView(){for(const e of Array.from(this.sections.values()))e.updateView()}importFromOpen5e(e){for(const t of this.sections.values())t.importFromOpen5e(e)}importFromJson(e){for(const t of this.sections.values())t.importFromJson(e[t.modelPropertyName])}exportToJson(){const e=Array.from(this.sections.entries()).map(([e,t])=>[e,t.exportToJson()]);return Object.fromEntries(e)}exportToHtml(){const e=document.createDocumentFragment();for(const t of this.sections.values())t.empty||e.appendChild(t.exportToHtml());return e}exportToMarkdown(){return Array.from(this.sections.values()).filter(e=>!e.empty).map(e=>e.exportToMarkdown()).join("\n")}}class ks extends ws{constructor(e){super(e),this.dividers=this.querySelectorAll("section-divider"),this.addEventListener("sectionModeChanged",()=>{this.updateSectionDividers()})}setEmptyVisibility(e){super.setEmptyVisibility(e),this.updateSectionDividers()}updateSectionDividers(){for(const e of this.dividers)e.hidden=!0;let e=null;for(const t of this.sections.values())if("hidden"!==t.mode){if(e&&ks.shouldSectionDividerBeDisplayed(e,t)){t.previousElementSibling.hidden=!1}e=t}}static shouldSectionDividerBeDisplayed(e,t){return"edit"===e.mode&&"hidden"!==t.mode||"edit"===t.mode&&"hidden"!==e.mode}}class Cs extends ks{static get elementName(){return"heading-stats"}static get templatePaths(){return super.templatePaths.set("heading-stats","src/html/elements/autonomous/containers/heading-stats.html")}constructor(){super(Cs.templatePaths),this.sections.set("title",document.querySelector("title-section")),this.sections.set("subtitle",document.querySelector("subtitle-section"))}edit(){this.sections.get("subtitle").edit(),this.sections.get("title").edit()}exportToJson(){return{title:this.sections.get("title").exportToJson(),subtitle:this.sections.get("subtitle").exportToJson()}}exportToHtml(){const e=document.createElement("creature-heading"),t=this.sections.get("title").exportToHtml(),s=this.sections.get("subtitle").exportToHtml();return e.appendChild(t),e.appendChild(s),e}exportToMarkdown(){return`${this.sections.get("title").exportToMarkdown()}\n${this.sections.get("subtitle").exportToMarkdown()}`}}class Ss extends ws{static get elementName(){return"top-stats"}static get templatePaths(){return super.templatePaths.set("top-stats","src/html/elements/autonomous/containers/top-stats.html")}constructor(){super(Ss.templatePaths),this.sections.set("basicStats",document.querySelector("basic-stats")),this.sections.set("abilityScores",document.querySelector("ability-scores-section")),this.sections.set("advancedStats",document.querySelector("advanced-stats"))}updateHitPointsView(){this.sections.get("basicStats").updateHitPointsView()}updateSavingThrowsView(e){this.sections.get("advancedStats").updateSavingThrowsView(e)}updateSkillsView(e){this.sections.get("advancedStats").updateSkillsView(e)}updateSensesView(){this.sections.get("advancedStats").updateSensesView()}importFromOpen5e(e){this.sections.get("abilityScores").importFromOpen5e(e),this.sections.get("advancedStats").importFromOpen5e(e),this.sections.get("basicStats").importFromOpen5e(e)}importFromJson(e){this.sections.get("abilityScores").importFromJson(e.abilityScores),this.sections.get("advancedStats").importFromJson(e),this.sections.get("basicStats").importFromJson(e)}exportToJson(){const e={};return Object.assign(e,this.sections.get("basicStats").exportToJson()),e.abilityScores=this.sections.get("abilityScores").exportToJson(),Object.assign(e,this.sections.get("advancedStats").exportToJson()),e}exportToHtml(){const e=document.createElement("top-stats"),t=this.sections.get("basicStats").exportToHtml(),s=this.sections.get("abilityScores").exportToHtml(),i=this.sections.get("advancedStats").exportToHtml();return e.appendChild(t),e.appendChild(s),e.appendChild(i),e}exportToMarkdown(){return`>___\n${this.sections.get("basicStats").exportToMarkdown()}\n>___\n${this.sections.get("abilityScores").exportToMarkdown()}\n>___\n${this.sections.get("advancedStats").exportToMarkdown()}\n>___`}}class Ts extends ws{static get elementName(){return"bottom-stats"}static get templatePaths(){return super.templatePaths.set("bottom-stats","src/html/elements/autonomous/containers/bottom-stats.html")}constructor(){super(Ts.templatePaths),this.sections.set("specialTraits",document.querySelector("special-traits-section")),this.sections.set("actions",document.querySelector("actions-section")),this.sections.set("reactions",document.querySelector("reactions-section")),this.sections.set("legendaryActions",document.querySelector("legendary-actions-section"))}reparseAllSections(){for(const e of this.sections.values())e.reparse()}}class Ms extends Pe{static get elementName(){return"stat-block"}static get templatePaths(){return super.templatePaths.set("stat-block","src/html/elements/autonomous/containers/stat-block.html")}constructor(e=null){super(Ms.templatePaths,e),i?(this.headingStats=new Cs,this.topStats=new Ss,this.bottomStats=new Ts):(this.headingStats=document.querySelector("heading-stats"),this.topStats=document.querySelector("top-stats"),this.bottomStats=document.querySelector("bottom-stats")),this.gettingStartedHelpBox=this.shadowRoot.getElementById("getting-started-help-box")}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.addEventListener("creatureNameChanged",this.onCreatureNameChanged.bind(this)),this.addEventListener("creatureSizeChanged",this.onCreatureSizeChanged.bind(this)),this.addEventListener("abilityScoreChanged",this.onAbilityScoreChanged.bind(this)),this.addEventListener("proficiencyBonusChanged",this.onProficiencyBonusChanged.bind(this)),this.addEventListener("skillChanged",this.onSkillChanged.bind(this)),this.isInitialized=!0)}onCreatureNameChanged(){this.reparseBlockSections()}onCreatureSizeChanged(){this.topStats.updateHitPointsView()}onAbilityScoreChanged(){const e=event.detail.abilityName;"constitution"===e?this.topStats.updateHitPointsView():"wisdom"===e&&this.topStats.updateSensesView(),this.topStats.updateSavingThrowsView(e),this.topStats.updateSkillsView(e),this.reparseBlockSections()}onProficiencyBonusChanged(){this.topStats.updateSavingThrowsView(),this.topStats.updateSkillsView(),this.topStats.updateSensesView(),this.reparseBlockSections()}onSkillChanged(){"perception"===event.detail.skillName&&this.topStats.updateSensesView()}setColumns(e){1===e?delete this.dataset.twoColumn:2===e&&(this.dataset.twoColumn="")}setColumnHeight(e,t){"auto"===e?this.removeAttribute("style"):"manual"===e&&this.setAttribute("style",`--statblock-content-height: ${t}px;`)}setEmptyVisibility(e){this.headingStats.setEmptyVisibility(e),this.topStats.setEmptyVisibility(e),this.bottomStats.setEmptyVisibility(e)}setGettingStartedVisibility(e){this.gettingStartedHelpBox.visible=e}edit(){this.bottomStats.edit(),this.topStats.edit(),this.headingStats.edit()}save(){this.bottomStats.save(),this.topStats.save(),this.headingStats.save()}updateView(){this.headingStats.updateView(),this.topStats.updateView(),this.bottomStats.updateView()}reparseBlockSections(){this.bottomStats.reparseAllSections()}importFromOpen5e(e){this.headingStats.importFromOpen5e(e),this.topStats.importFromOpen5e(e),this.bottomStats.importFromOpen5e(e)}importFromJson(e){this.headingStats.importFromJson(e),this.topStats.importFromJson(e),this.bottomStats.importFromJson(e)}exportToJson(){const e={};return Object.assign(e,this.headingStats.exportToJson()),Object.assign(e,this.topStats.exportToJson()),Object.assign(e,this.bottomStats.exportToJson()),e}exportToHtml(){const e=Y.layoutSettings,t=document.createElement("stat-block"),s=this.headingStats.exportToHtml(),i=this.topStats.exportToHtml(),n=this.bottomStats.exportToHtml();return t.appendChild(s),t.appendChild(i),t.appendChild(n),2===e.columns&&(t.dataset.twoColumn="","manual"===e.twoColumnMode&&t.setAttribute("style",`--data-content-height: ${e.twoColumnHeight}px`)),t}exportToMarkdown(){let e="___";return 2===Y.layoutSettings.columns&&(e+="\n___"),`${e}\n${this.headingStats.exportToMarkdown()}\n${this.topStats.exportToMarkdown()}\n${this.bottomStats.exportToMarkdown()}`}}var Bs=new class{constructor(){this.jsonKey="json",this.localSettingsKey="localSettings"}loadJson(){return localStorage.getItem(this.jsonKey)}saveJson(e){localStorage.setItem(this.jsonKey,e)}clearJson(){localStorage.removeItem(this.jsonKey)}loadLocalSettings(){return localStorage.getItem(this.localSettingsKey)}saveLocalSettings(e){localStorage.setItem(this.localSettingsKey,e)}clearLocalSettings(){localStorage.removeItem(this.localSettingsKey)}};const Is=s(9).html;class Ds extends Pe{static get elementName(){return"stat-block-editor"}static get templatePaths(){return super.templatePaths.set("stat-block-editor","src/html/elements/autonomous/containers/stat-block-editor.html")}constructor(){super(Ds.templatePaths),i?(this.statBlockMenu=new vs(this),this.statBlockSidebar=new xs(this),this.statBlock=new Ms(this),this.resetDialog=new Ye,this.importJsonDialog=new Qe,this.importSrdDialog=new qe,this.importOpen5eDialog=new Ke,this.exportJsonDialog=new Xe,this.exportHtmlDialog=new Xe,this.exportMarkdownDialog=new Xe):(this.statBlockMenu=document.querySelector("stat-block-menu"),this.statBlockSidebar=document.querySelector("stat-block-sidebar"),this.statBlock=document.querySelector("stat-block"),this.resetDialog=this.shadowRoot.getElementById("reset-dialog"),this.importJsonDialog=this.shadowRoot.getElementById("import-json-dialog"),this.importSrdDialog=this.shadowRoot.getElementById("import-srd-dialog"),this.importOpen5eDialog=this.shadowRoot.getElementById("import-open5e-dialog"),this.exportJsonDialog=this.shadowRoot.getElementById("export-json-dialog"),this.exportHtmlDialog=this.shadowRoot.getElementById("export-html-dialog"),this.exportMarkdownDialog=this.shadowRoot.getElementById("export-markdown-dialog"))}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.addEventListener("numberOfColumnsChanged",this.onNumberOfColumnsChanged.bind(this)),this.addEventListener("twoColumnHeightChanged",this.onTwoColumnHeightChanged.bind(this)),this.addEventListener("emptySectionsVisibilityChanged",this.onEmptySectionsVisibilityChanged.bind(this)),this.addEventListener("allSectionsAction",this.onAllSectionsAction.bind(this)),this.addEventListener("resetAction",this.onResetAction.bind(this)),this.addEventListener("importAction",this.onImportAction.bind(this)),this.addEventListener("exportAction",this.onExportAction.bind(this)),this.addEventListener("printAction",this.onPrintAction.bind(this)),this.addEventListener("toggleGettingStarted",this.onToggleGettingStarted.bind(this)),this.addEventListener("sectionSaved",this.onSectionSaved.bind(this)),this.isInitialized=!0)}onNumberOfColumnsChanged(e){const t=Y.layoutSettings,s=e.detail.columns;t.columns=s,1===s?(this.statBlockSidebar.visible=!1,this.statBlock.setColumnHeight("auto")):2===s&&(this.statBlockSidebar.visible=!0,this.statBlock.setColumnHeight(t.twoColumnMode,t.twoColumnHeight)),this.statBlock.setColumns(s),this.saveJsonToLocalStorage()}onTwoColumnHeightChanged(e){const t=Y.layoutSettings,s=e.detail.mode,i=e.detail.height;t.twoColumnMode=s,t.twoColumnHeight=i,this.statBlock.setColumnHeight(s,i),this.saveJsonToLocalStorage()}onEmptySectionsVisibilityChanged(e){const t=Y.localSettings,s=e.detail.visibility;t.emptySectionsVisibility=s,this.statBlock.setEmptyVisibility(s),this.saveLocalSettingsToLocalStorage()}onAllSectionsAction(e){const t=e.detail.action;"edit"===t?this.statBlock.edit():"save"===t&&this.statBlock.save()}onResetAction(){this.openResetDialog()}onImportAction(e){const t=e.detail.format;switch(t){case"json":this.openImportJsonDialog();break;case"srd":this.openImportSrdDialog();break;case"open5e":this.openImportOpen5eDialog();break;default:throw new Error(`Unknown import format: '${t}'.`)}}onExportAction(e){const t=e.detail.format;switch(t){case"json":this.openExportJsonDialog();break;case"html":this.openExportHtmlDialog();break;case"markdown":this.openExportMarkdownDialog();break;default:throw new Error(`Unknown export format: '${t}'.`)}}onPrintAction(){fs(this.exportToHtml(Y.creature.title.fullName))}onToggleGettingStarted(){const e=Y.localSettings;e.gettingStartedVisibility=!e.gettingStartedVisibility,this.saveLocalSettingsToLocalStorage(),this.statBlock.setGettingStartedVisibility(e.gettingStartedVisibility)}onSectionSaved(){this.saveJsonToLocalStorage()}openResetDialog(){this.resetDialog.launch(this.reset.bind(this))}openImportJsonDialog(){this.importJsonDialog.launch(this.importFromJson.bind(this))}openImportSrdDialog(){this.importSrdDialog.launch(this.importFromJson.bind(this))}openImportOpen5eDialog(){this.importOpen5eDialog.launch(this.importFromOpen5e.bind(this))}openExportJsonDialog(){const e=this.exportToJson();this.exportJsonDialog.launch(e,"application/json",`${Y.creature.title.fullName}.json`)}openExportHtmlDialog(){const e=this.exportToHtml(`Statblock5e - ${Y.creature.title.fullName}`);this.exportHtmlDialog.launch(e,"text/html",`${Y.creature.title.fullName}.html`)}openExportMarkdownDialog(){const e=this.exportToMarkdown();this.exportMarkdownDialog.launch(e,"text/markdown",`${Y.creature.title.fullName}.md`)}loadJsonFromLocalStorage(){const e=Bs.loadJson();if(null!==e){const t=JSON.parse(e);t.meta.version===Y.localSettings.version&&this.importFromJson(t)}}saveJsonToLocalStorage(){const e=this.exportToJson();Bs.saveJson(e)}loadLocalSettingsFromLocalStorage(){const e=Bs.loadLocalSettings();if(null!==e){const t=JSON.parse(e);t.version===Y.localSettings.version&&(Object.assign(Y.localSettings,t),this.statBlockMenu.updateEmptySectionControls(),this.statBlock.setGettingStartedVisibility(t.gettingStartedVisibility))}}saveLocalSettingsToLocalStorage(){const e=JSON.stringify(Y.localSettings);Bs.saveLocalSettings(e)}reset(){Y.reset(),Bs.clearJson(),this.statBlock.updateView(),this.statBlockMenu.updateColumnControls(),this.statBlockMenu.updateEmptySectionControls(),this.statBlockSidebar.updateControls()}importFromOpen5e(e){this.statBlock.importFromOpen5e(e),this.saveJsonToLocalStorage()}importFromJson(e){Y.layoutSettings.fromJson(e.layout),this.statBlock.importFromJson(e),this.statBlockMenu.updateColumnControls(),this.statBlockSidebar.updateControls(),this.saveJsonToLocalStorage()}exportToJson(){const e=Y.layoutSettings,t=Y.localSettings.version,s=this.statBlock.exportToJson();return s.layout=e.toJson(),s.meta={version:t,description:"Created using statblock5e-creator",url:"https://frumple.github.io/statblock5e-creator"},JSON.stringify(s,null,2)}exportToHtml(e){const t=a.cloneNode(!0),s=t.querySelector("title"),i=t.querySelector("body"),n=this.statBlock.exportToHtml();s.textContent=e,i.appendChild(n);const o=`<!DOCTYPE html>${t.documentElement.outerHTML}`;return Is(o,{indent_size:2,content_unformatted:"p"})}exportToMarkdown(){return this.statBlock.exportToMarkdown()}}class Ps extends ks{static get elementName(){return"basic-stats"}static get templatePaths(){return super.templatePaths.set("basic-stats","src/html/elements/autonomous/containers/basic-stats.html")}constructor(){super(Ps.templatePaths),this.sections.set("armorClass",document.querySelector("armor-class-section")),this.sections.set("hitPoints",document.querySelector("hit-points-section")),this.sections.set("speed",document.querySelector("speed-section"))}updateHitPointsView(){this.sections.get("hitPoints").updateView()}}class As extends ks{static get elementName(){return"advanced-stats"}static get templatePaths(){return super.templatePaths.set("advanced-stats","src/html/elements/autonomous/containers/advanced-stats.html")}constructor(){super(As.templatePaths);const e=document.querySelector("saving-throws-section"),t=document.querySelector("skills-section"),s=document.querySelector("damage-vulnerabilities-section"),i=document.querySelector("damage-resistances-section"),n=document.querySelector("damage-immunities-section"),a=document.querySelector("condition-immunities-section"),o=document.querySelector("senses-section"),r=document.querySelector("languages-section"),l=document.querySelector("challenge-rating-section");this.sections.set("savingThrows",e),this.sections.set("skills",t),this.sections.set("damageVulnerabilities",s),this.sections.set("damageResistances",i),this.sections.set("damageImmunities",n),this.sections.set("conditionImmunities",a),this.sections.set("senses",o),this.sections.set("languages",r),this.sections.set("challengeRating",l),this.importOrder=[l,e,t,s,i,n,a,o,r]}updateSavingThrowsView(e){this.sections.get("savingThrows").updateViewOnAttributeChange(e)}updateSkillsView(e){this.sections.get("skills").updateViewOnAttributeChange(e)}updateSensesView(){this.sections.get("senses").updateViewOnAttributeChange()}importFromOpen5e(e){for(const t of this.importOrder)t.importFromOpen5e(e)}importFromJson(e){for(const t of this.importOrder)t.importFromJson(e[t.modelPropertyName])}}!async function(){Y.localSettings.version=await async function(){const e=await n("package.json");return JSON.parse(e).version}(),await async function(){const e=[oe,le,pe,be,ye,ve,ke,Se,Ae,Re,Ne,ze,He,$e,Oe,Fe,Qe,qe,Ke,Ye,Xe,st,it,nt,ot,at,lt,ht,ct,ut,bt,vt,Tt,It,At,Nt,$t,Vt,Wt,qt,Ut,Kt,Yt,es,is,ds,hs,ms,ps,Ds,vs,xs,Ms,Cs,Ss,Ts,Ps,As];for(const t of e)await t.define()}();const e=document.querySelector("loading-screen"),t=document.querySelector("stat-block-editor");e.status="Initializing HTML export template...",await async function(){const e=await n("src/html/export-inlined.html"),t=new DOMParser;return a=t.parseFromString(e,"text/html"),a}(),e.status="Loading JSON from local storage...",t.loadJsonFromLocalStorage(),e.status="Loading local settings from local storage...",t.loadLocalSettingsFromLocalStorage(),e.status="Waiting for elements to load...",await async function(){return new Promise(e=>{const t=window.setInterval((function(){void 0!==document.getElementsByTagName("body")[0]&&(window.clearInterval(t),e())}),1e3)})}(),t.classList.remove("stat-block-editor_hidden"),e.visible=!1}()},2:function(e,t){}});