!function(e){function t(t){for(var i,o,r=t[0],l=t[1],h=t[2],d=0,u=[];d<r.length;d++)o=r[d],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&u.push(n[o][0]),n[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);for(c&&c(t);u.length;)u.shift()();return a.push.apply(a,h||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],i=!0,r=1;r<s.length;r++){var l=s[r];0!==n[l]&&(i=!1)}i&&(a.splice(t--,1),e=o(o.s=s[0]))}return e}var i={},n={0:0},a=[];function o(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=i,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(s,i,function(t){return e[t]}.bind(null,i));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var r=window.webpackJsonp=window.webpackJsonp||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var h=0;h<r.length;h++)t(r[h]);var c=l;a.push([11,1]),s()}({11:function(e,t,s){"use strict";s.r(t);var i=navigator.userAgent.includes("jsdom");async function n(e){if(i){const t=s(2),i=s(3).promisify(t.readFile);return await i(e).then(e=>e.toString())}return await fetch(e).then(e=>e.text())}let a=null;class o{constructor(){}reset(){throw new Error(`The class '${this.constructor.name}' must implement the reset() method.`)}get jsonPropertyNames(){return[]}fromJson(e){for(const t of this.jsonPropertyNames)t in e&&(this[t]=e[t])}toJson(){const e={};for(const t of this.jsonPropertyNames)t in this&&(e[t]=this[t]);return e}toHtml(){throw new Error(`The class '${this.constructor.name}' must implement the toHtml() method.`)}toHomebrewery(){throw new Error(`The class '${this.constructor.name}' must implement the toHomebrewery() method.`)}}class r extends o{constructor(){super(),this.reset()}reset(){this.fullName="Commoner",this.shortName="",this.isProperNoun=!1}get jsonPropertyNames(){return["fullName","shortName","isProperNoun"]}get grammaticalFullName(){return this.grammaticize(this.fullName)}get grammaticalShortName(){return this.grammaticize(this.shortName)}get grammaticalName(){return""!==this.shortName?this.grammaticalShortName:this.grammaticalFullName}grammaticize(e){return this.isProperNoun?e:`the ${e.toLowerCase()}`}toParserOptions(){return{name:this.grammaticalName,fullName:this.grammaticalFullName}}toHtml(){const e=document.createElement("h1");return e.textContent=this.fullName,e}toHomebrewery(){return`> ## ${this.fullName}`}}class l extends o{constructor(){super(),this.reset()}reset(){this.size="Medium",this.type="humanoid",this.tags="",this.alignment="unaligned",this.useCustomText=!1,this.customText=""}get jsonPropertyNames(){return["size","type","tags","alignment","useCustomText","customText"]}get text(){return this.useCustomText?this.customText:""===this.tags?`${this.size} ${this.type}, ${this.alignment}`:`${this.size} ${this.type} (${this.tags}), ${this.alignment}`}toHtml(){const e=document.createElement("h2");return e.textContent=this.text,e}toHomebrewery(){return`>*${this.text}*`}}const h=s(7);class c{constructor(e,t,s){this.clipboard=new h(s,{container:t,text:function(){return e}})}setSuccessCallback(e){this.clipboard.on("success",e)}setErrorCallback(e){this.clipboard.on("error",e)}destroy(){this.clipboard.destroy()}}function d(e,t,s){const i=document.createElement("h4"),n=document.createElement("p");return i.textContent=t,n.innerHTML=s,e.appendChild(i),e.appendChild(n),e}class u extends o{constructor(e){super(),this.headingName=e}get text(){throw new Error(`The class '${this.constructor.name}' must implement the text() method.`)}get htmlText(){throw new Error(`The class '${this.constructor.name}' must implement the htmlText() method.`)}toHtml(){return e=this.headingName,t=this.htmlText,d(document.createElement("property-line"),e,t);var e,t}toHomebrewery(){return e=this.headingName,t=this.text,`> - **${e}** ${t}`;var e,t}}class m extends u{constructor(){super("Armor Class"),this.reset()}reset(){this.armorClass=10,this.armorType="",this.hasShield=!1,this.useCustomText=!1,this.customText="",this.htmlCustomText=""}get jsonPropertyNames(){return["armorClass","armorType","hasShield","useCustomText","customText"]}get text(){return this.useCustomText?this.customText:this.nonCustomText}get htmlText(){return this.useCustomText?this.htmlCustomText:this.nonCustomText}get nonCustomText(){return this.armorType?this.hasShield?`${this.armorClass} (${this.armorType}, shield)`:`${this.armorClass} (${this.armorType})`:this.hasShield?`${this.armorClass} (shield)`:this.armorClass}}function p(e){return e.charAt(0).toUpperCase()+e.slice(1)}function g(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function b(e){return`${E(e)}${f(e)}`}function E(e){return e<0?"–":"+"}function f(e){return e<0?Math.abs(e).toString():e.toString()}class y extends u{constructor(e){super("Hit Points"),this.abilities=e,this.reset()}reset(){this._hitPoints=4,this.useHitDie=!0,this.hitDieQuantity=1,this.hitDieSize=8}get jsonPropertyNames(){return["hitPoints","useHitDie","hitDieQuantity","hitDieSize"]}get hitDieAverage(){return this.hitDieSize/2+.5}get constitutionHitPoints(){const e=this.abilities.abilities.constitution.modifier;return this.hitDieQuantity*e}set hitPoints(e){this._hitPoints=e}get hitPoints(){if(this.useHitDie){const e=Math.floor(this.hitDieQuantity*this.hitDieAverage)+this.constitutionHitPoints;this._hitPoints=Math.max(0,e)}return this._hitPoints}get text(){return this.useHitDie?this.textWithHitDie:this.hitPoints}get htmlText(){return this.text}get textWithHitDie(){return 0!=this.constitutionHitPoints?`${this.hitPoints} (${this.hitDieQuantity}d${this.hitDieSize} ${this.constitutionHitPointsText})`:`${this.hitPoints} (${this.hitDieQuantity}d${this.hitDieSize})`}get constitutionHitPointsText(){const e=this.constitutionHitPoints;return`${E(e)} ${f(e)}`}}class v extends u{constructor(){super("Speed"),this.reset()}reset(){this.walk=30,this.burrow=null,this.climb=null,this.fly=null,this.hover=!1,this.swim=null,this.useCustomText=!1,this.customText="",this.htmlCustomText=""}get jsonPropertyNames(){return["walk","burrow","climb","fly","hover","swim","useCustomText","customText"]}get text(){return this.useCustomText?this.customText:this.nonCustomText}get htmlText(){return this.useCustomText?this.htmlCustomText:this.nonCustomText}get nonCustomText(){const e=[],t=this.walk?this.walk:0;if(e.push(`${t} ft.`),null!=this.burrow&&e.push(`burrow ${this.burrow} ft.`),null!=this.climb&&e.push(`climb ${this.climb} ft.`),null!=this.fly){const t=this.hover?" (hover)":"";e.push(`fly ${this.fly} ft.${t}`)}return null!=this.swim&&e.push(`swim ${this.swim} ft.`),e.join(", ")}}class x extends o{constructor(){super(),this.abilities={strength:new w("str"),dexterity:new w("dex"),constitution:new w("con"),intelligence:new w("int"),wisdom:new w("wis"),charisma:new w("cha")},Object.freeze(this.abilities),this.reset()}reset(){for(const e of Object.values(this.abilities))e.reset()}get keys(){return Object.keys(this.abilities)}get values(){return Object.values(this.abilities)}get entries(){return Object.entries(this.abilities)}toParserOptions(){const e=this.entries.map(([e,t])=>[e,t.toParserOptions()]);return Object.fromEntries(e)}fromJson(e){for(const[t,s]of this.entries)s.fromJson(e[t])}toJson(){const e=this.entries.map(([e,t])=>[e,t.toJson()]);return Object.fromEntries(e)}toHtml(){const e=document.createElement("abilities-block");for(const t of this.values){const s=t.abbreviation;e.dataset[s]=t.score}return e}toHomebrewery(){return`>|STR|DEX|CON|INT|WIS|CHA|\n>|:---:|:---:|:---:|:---:|:---:|:---:|\n>|${this.values.map(e=>`${e.score} ${e.formattedModifier}`).join("|")}|`}}class w{constructor(e){this.abbreviation=e,this.reset()}reset(){this.score=10}get modifier(){return Math.floor((this.score-10)/2)}get formattedModifier(){return`(${b(this.modifier)})`}toParserOptions(){return{modifier:this.modifier}}fromJson(e){this.score=e}toJson(){return this.score}}class C extends u{constructor(e,t){super("Saving Throws");const s=e.keys.map(s=>[s,new k(e.abilities[s],t)]);this.savingThrows=Object.fromEntries(s),Object.freeze(this.savingThrows)}reset(){for(const e of Object.values(this.savingThrows))e.reset()}get keys(){return Object.keys(this.savingThrows)}get values(){return Object.values(this.savingThrows)}get entries(){return Object.entries(this.savingThrows)}get text(){return this.values.filter(e=>e.isEnabled).map(e=>e.text).join(", ")}get htmlText(){return this.text}fromJson(e){for(const[t,s]of this.entries)s.fromJson(e[t])}toJson(){const e=this.entries.map(([e,t])=>[e,t.toJson()]);return Object.fromEntries(e)}}class k{constructor(e,t){this.ability=e,this.challengeRatingModel=t,this.reset()}reset(){this.isEnabled=!1,this.isProficient=!1,this.override=null}get text(){return`${p(this.ability.abbreviation)} ${this.formattedModifier}`}get modifier(){let e=0;if(this.isEnabled){if(null!==this.override)return this.override;this.isProficient&&(e+=this.challengeRatingModel.proficiencyBonus)}return e+=this.ability.modifier,e}get formattedModifier(){return b(this.modifier)}fromJson(e){this.isEnabled=e.isEnabled,this.isProficient=e.isProficient,this.override=e.override}toJson(){return{isEnabled:this.isEnabled,isProficient:this.isProficient,override:this.override}}}class T extends u{constructor(e,t){super("Skills");const s=e.abilities.strength,i=e.abilities.dexterity,n=e.abilities.intelligence,a=e.abilities.wisdom,o=e.abilities.charisma;this.skills={acrobatics:new S("Acrobatics",i,t),animalHandling:new S("Animal Handling",a,t),arcana:new S("Arcana",n,t),athletics:new S("Athletics",s,t),deception:new S("Deception",o,t),history:new S("History",n,t),insight:new S("Insight",a,t),intimidation:new S("Intimidation",o,t),investigation:new S("Investigation",n,t),medicine:new S("Medicine",a,t),nature:new S("Nature",n,t),perception:new S("Perception",a,t),performance:new S("Performance",o,t),persuasion:new S("Persuasion",o,t),religion:new S("Religion",n,t),sleightOfHand:new S("Sleight of Hand",i,t),stealth:new S("Stealth",i,t),survival:new S("Survival",a,t)},Object.freeze(this.skills)}reset(){for(const e of this.values)e.reset()}get keys(){return Object.keys(this.skills)}get values(){return Object.values(this.skills)}get entries(){return Object.entries(this.skills)}get text(){return this.values.filter(e=>e.isEnabled).map(e=>e.text).join(", ")}get htmlText(){return this.text}fromJson(e){for(const[t,s]of this.entries)s.fromJson(e[t])}toJson(){const e=this.entries.map(([e,t])=>[e,t.toJson()]);return Object.fromEntries(e)}}class S{constructor(e,t,s){this.prettyName=e,this.ability=t,this.challengeRatingModel=s,this.reset()}reset(){this.isEnabled=!1,this.isProficient=!1,this.override=null}get text(){return`${this.prettyName} ${this.formattedModifier}`}get passiveScore(){let e=10;if(this.isEnabled){if(null!==this.override)return e+this.override;this.isProficient&&(e+=this.challengeRatingModel.proficiencyBonus)}return e+=this.ability.modifier,e}get modifier(){let e=0;if(this.isEnabled){if(null!==this.override)return this.override;this.isProficient&&(e+=this.challengeRatingModel.proficiencyBonus)}return e+=this.ability.modifier,e}get formattedModifier(){return b(this.modifier)}fromJson(e){this.isEnabled=e.isEnabled,this.isProficient=e.isProficient,this.override=e.override}toJson(){return{isEnabled:this.isEnabled,isProficient:this.isProficient,override:this.override}}}class I extends u{constructor(e,t){super(e),this.singleName=t,this.reset()}reset(){this.items=[]}get jsonPropertyNames(){return["items"]}get text(){return this.items.join(", ")}get htmlText(){return this.text}}class P extends I{constructor(){super("Damage Vulnerabilities","Damage Vulnerability")}}class M extends I{constructor(){super("Damage Resistances","Damage Resistance")}}class B extends I{constructor(){super("Damage Immunities","Damage Immunity")}}class D extends I{constructor(){super("Condition Immunities","Condition Immunity")}}class N extends u{constructor(e){super("Senses"),this.skills=e,this.reset()}reset(){this.blindsight=null,this.darkvision=null,this.tremorsense=null,this.truesight=null,this.useCustomText=!1,this.customText="",this.htmlCustomText=""}get jsonPropertyNames(){return["blindsight","darkvision","tremorsense","truesight","useCustomText","customText"]}get passivePerception(){return this.skills.skills.perception.passiveScore}get text(){return this.useCustomText?this.customText:this.nonCustomText}get htmlText(){return this.useCustomText?this.htmlCustomText:this.nonCustomText}get nonCustomText(){const e=[];return null!=this.blindsight&&e.push(`blindsight ${this.blindsight} ft.`),null!=this.darkvision&&e.push(`darkvision ${this.darkvision} ft.`),null!=this.tremorsense&&e.push(`tremorsense ${this.tremorsense} ft.`),null!=this.truesight&&e.push(`truesight ${this.truesight} ft.`),e.push(`passive Perception ${this.passivePerception}`),e.join(", ")}}class A extends I{constructor(){super("Languages","Language")}reset(){this.items=["Common"]}get text(){let e=super.text;return""===e&&(e="—"),e}}class R extends u{constructor(){super("Challenge"),this.reset()}reset(){this.challengeRating=0,this.experiencePoints=10,this.proficiencyBonus=2}get jsonPropertyNames(){return["challengeRating","experiencePoints","proficiencyBonus"]}get challengeRatingAsFraction(){switch(this.challengeRating){case.125:return"1/8";case.25:return"1/4";case.5:return"1/2";default:return this.challengeRating}}get text(){return`${this.challengeRatingAsFraction} (${this.experiencePoints} XP)`}get htmlText(){return this.text}toParserOptions(){return this.proficiencyBonus}}class H{constructor(e,t,s="",i=""){this.name=e,this.text=t,this.homebreweryText=s,this.htmlText=i}toJson(){return{name:this.name,text:this.text}}toHtml(){return e=this.name,t=this.htmlText,d(document.createElement("property-block"),`${e}.`,t);var e,t}toHomebrewery(){return e=this.name,t=this.homebreweryText,`> ***${e}.*** ${t}`;var e,t}}class L extends o{constructor(e,t){super(),this.headingName=e,this.singleName=t,this.blocks=[],this.reset()}reset(){this.clear()}clear(){this.blocks.length=0}fromJson(e){this.clear();for(const t of e.blocks){const e=new H(t.name,t.text);this.blocks.push(e)}}toJson(){return{blocks:this.blocks.map(e=>e.toJson())}}toHtml(){const e=document.createDocumentFragment();if(this.headingName){const t=document.createElement("h3");t.textContent=this.headingName,e.appendChild(t)}for(const t of this.blocks)e.appendChild(t.toHtml());return e}toHomebrewery(){return`${this.headingName?`> ### ${this.headingName}\n`:""}${this.blocks.map(e=>e.toHomebrewery()).join("\n>\n")}`}}class z extends L{constructor(){super(null,"Special Trait")}}class $ extends L{constructor(){super("Actions","Action")}reset(){this.blocks=i?[]:[{name:"Club",text:"*Melee Weapon Attack:* atk[str] to hit, reach 5 ft., one target. *Hit:* dmg[1d4 + str] bludgeoning damage.",homebreweryText:"*Melee Weapon Attack:* +2 to hit, reach 5 ft., one target. *Hit:* 2 (1d4) bludgeoning damage.",htmlText:"<em>Melee Weapon Attack:</em> +2 to hit, reach 5 ft., one target. <em>Hit:</em> 2 (1d4) bludgeoning damage."}]}}class _ extends L{constructor(){super("Reactions","Reaction")}}class V extends L{constructor(){super("Legendary Actions","Legendary Action")}reset(){super.reset(),this.description="[name] can take 3 legendary actions, choosing from the options below. Only one legendary action option can be used at a time and only at the end of another creature's turn. [name] regains spent legendary actions at the start of its turn.",this.homebreweryDescription="",this.htmlDescription=""}fromJson(e){super.fromJson(e),this.description=e.description}toJson(){const e=super.toJson();return e.description=this.description,e}toHtml(){const e=super.toHtml(),t=e.querySelector("property-block"),s=document.createElement("p");return s.innerHTML=this.htmlDescription,e.insertBefore(s,t),e}toHomebrewery(){return`${`> ### ${this.headingName}\n`}${`> ${this.homebreweryDescription}\n`}${this.blocks.map(e=>e.toHomebrewery()).join("\n>\n")}`}}class F{constructor(){this.abilities=new x,this.challengeRating=new R,this.title=new r,this.subtitle=new l,this.armorClass=new m,this.hitPoints=new y(this.abilities),this.speed=new v,this.savingThrows=new C(this.abilities,this.challengeRating),this.skills=new T(this.abilities,this.challengeRating),this.damageVulnerabilities=new P,this.damageResistances=new M,this.damageImmunities=new B,this.conditionImmunities=new D,this.senses=new N(this.skills),this.languages=new A,this.specialTraits=new z,this.actions=new $,this.reactions=new _,this.legendaryActions=new V}reset(){this.title.reset(),this.subtitle.reset(),this.armorClass.reset(),this.hitPoints.reset(),this.speed.reset(),this.abilities.reset(),this.savingThrows.reset(),this.skills.reset(),this.damageVulnerabilities.reset(),this.damageResistances.reset(),this.damageImmunities.reset(),this.conditionImmunities.reset(),this.senses.reset(),this.languages.reset(),this.challengeRating.reset(),this.specialTraits.reset(),this.actions.reset(),this.reactions.reset(),this.legendaryActions.reset()}}class O{constructor(){this.reset()}reset(){this.columns=1,this.twoColumnMode="auto",this.twoColumnHeight=600,this.emptySectionsVisibility=!0}fromJson(e){this.columns=e.columns,this.twoColumnMode=e.twoColumnMode,this.twoColumnHeight=e.twoColumnHeight,this.emptySectionsVisibility=e.emptySectionsVisibility}toJson(){return{columns:this.columns,twoColumnMode:this.twoColumnMode,twoColumnHeight:this.twoColumnHeight,emptySectionsVisibility:this.emptySectionsVisibility}}}var J=new class{constructor(){this.version="0.0.0",this.creature=new F,this.layoutSettings=new O}reset(){this.creature.reset(),this.layoutSettings.reset()}};function j(e,t){for(const s in t){let i=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,i)}}var Q=new class{constructor(){this.mixins=new Map}define(e,t){this.mixins.set(e,t)}applyToElement(e){const t=e.getAttribute("is");if(t){const s=this.mixins.get(t);s&&(j(e,s),e.initializeMixin())}}},W=function(){function e(t,s,i,n){this.message=t,this.expected=s,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function s(){this.constructor=e}s.prototype=t.prototype,e.prototype=new s}(e,Error),e.buildMessage=function(e,t){var s={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,s="";for(t=0;t<e.parts.length;t++)s+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+s+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}return"Expected "+function(e){var t,i,n,a=new Array(e.length);for(t=0;t<e.length;t++)a[t]=(n=e[t],s[n.type](n));if(a.sort(),a.length>0){for(t=1,i=1;t<a.length;t++)a[t-1]!==a[t]&&(a[i]=a[t],i++);a.length=i}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,s){s=void 0!==s?s:{};var i,n={},a={start:S},o=S,r=x("[name]",!1),l="[fullname]",h=x("[fullname]",!1),c={type:"any"},d=x("\n",!1),u=x("\r",!1),m=x(" ",!1),p=x("\t",!1),g=x(".",!1),b=0,E=[{line:1,column:1}],f=0,y=[],v=0;if("startRule"in s){if(!(s.startRule in a))throw new Error("Can't start parsing from rule \""+s.startRule+'".');o=a[s.startRule]}function x(e,t){return{type:"literal",text:e,ignoreCase:t}}function w(e){var s,i=E[e];if(i)return i;for(s=e-1;!E[s];)s--;for(i={line:(i=E[s]).line,column:i.column};s<e;)10===t.charCodeAt(s)?(i.line++,i.column=1):i.column++,s++;return E[e]=i,i}function C(e,t){var s=w(e),i=w(t);return{start:{offset:e,line:s.line,column:s.column},end:{offset:t,line:i.line,column:i.column}}}function k(e){b<f||(b>f&&(f=b,y=[]),y.push(e))}function T(t,s,i){return new e(e.buildMessage(t,s),t,s,i)}function S(){var e,t,s;if(e=b,t=[],(s=I())!==n)for(;s!==n;)t.push(s),s=I();else t=n;return t!==n&&(e,t=t.join("")),(e=t)===n&&(e=b,(t=L())!==n&&(e,t=""),e=t),e}function I(){var e;return(e=A())===n&&(e=function(){var e,t,s,i;if(e=b,(t=function(){var e;(e=B())===n&&(e=M());return e}())!==n){for(s=[],i=P();i!==n;)s.push(i),i=P();s!==n&&(i=function(){var e;(e=A())===n&&(e=L());return e}())!==n?(e,a=i,t=`${t}${s.join("")}${a||""}`,e=t):(b=e,e=n)}else b=e,e=n;var a;return e}()),e}function P(){var e;return(e=function(){var e,t,s,i;e=b,(t=H())!==n&&(s=D())!==n&&(i=B())!==n?(e,e=t=`${t}${s}${i}`):(b=e,e=n);return e}())===n&&(e=function(){var e;(e=function(){var e,i;e=b,"[name]"===t.substr(b,6)?(i="[name]",b+=6):(i=n,0===v&&k(r));i!==n&&(e,i=s.creature.name);return e=i}())===n&&(e=function(){var e,i;e=b,t.substr(b,10)===l?(i=l,b+=10):(i=n,0===v&&k(h));i!==n&&(e,i=s.creature.fullName);return e=i}());return e}())===n&&(e=M()),e}function M(){var e;return(e=function(){var e,s,i;if(e=b,s=[],(i=N())!==n)for(;i!==n;)s.push(i),i=N();else s=n;e=s!==n?t.substring(e,b):s;return e}())===n&&(e=D())===n&&(e=H()),e}function B(){var e;return(e=function(){var e,i;e=b,"[name]"===t.substr(b,6)?(i="[name]",b+=6):(i=n,0===v&&k(r));i!==n&&(e,i=z(s.creature.name));return e=i}())===n&&(e=function(){var e,i;e=b,t.substr(b,10)===l?(i=l,b+=10):(i=n,0===v&&k(h));i!==n&&(e,i=z(s.creature.fullName));return e=i}()),e}function D(){var e,s,i;if(e=b,s=[],(i=R())!==n)for(;i!==n;)s.push(i),i=R();else s=n;return e=s!==n?t.substring(e,b):s}function N(){var e,s,i;return e=b,s=b,v++,(i=H())===n&&(i=R())===n&&(i=A()),v--,i===n?s=void 0:(b=s,s=n),s!==n?(t.length>b?(i=t.charAt(b),b++):(i=n,0===v&&k(c)),i!==n?e=s=[s,i]:(b=e,e=n)):(b=e,e=n),e}function A(){var e,s,i,a;return 10===t.charCodeAt(b)?(e="\n",b++):(e=n,0===v&&k(d)),e===n&&(e=b,s=b,13===t.charCodeAt(b)?(i="\r",b++):(i=n,0===v&&k(u)),i!==n?(10===t.charCodeAt(b)?(a="\n",b++):(a=n,0===v&&k(d)),a===n&&(a=null),a!==n?s=i=[i,a]:(b=s,s=n)):(b=s,s=n),e=s!==n?t.substring(e,b):s),e}function R(){var e;return 32===t.charCodeAt(b)?(e=" ",b++):(e=n,0===v&&k(m)),e===n&&(9===t.charCodeAt(b)?(e="\t",b++):(e=n,0===v&&k(p))),e}function H(){var e;return 46===t.charCodeAt(b)?(e=".",b++):(e=n,0===v&&k(g)),e}function L(){var e,s;return e=b,v++,t.length>b?(s=t.charAt(b),b++):(s=n,0===v&&k(c)),v--,s===n?e=void 0:(b=e,e=n),e}function z(e){return e.charAt(0).toUpperCase()+e.slice(1)}if((i=o())!==n&&b===t.length)return i;throw i!==n&&b<t.length&&k({type:"end"}),T(y,f<t.length?t.charAt(f):null,f<t.length?C(f,f+1):C(f,f))}}}(),q=function(){function e(t,s,i,n){this.message=t,this.expected=s,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function s(){this.constructor=e}s.prototype=t.prototype,e.prototype=new s}(e,Error),e.buildMessage=function(e,t){var s={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,s="";for(t=0;t<e.parts.length;t++)s+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+s+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}return"Expected "+function(e){var t,i,n,a=new Array(e.length);for(t=0;t<e.length;t++)a[t]=(n=e[t],s[n.type](n));if(a.sort(),a.length>0){for(t=1,i=1;t<a.length;t++)a[t-1]!==a[t]&&(a[i]=a[t],i++);a.length=i}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,s){s=void 0!==s?s:{};var i,n={},a={start:j},o=j,r=_("sdc",!1),l=_("[",!1),h=_("]",!1),c=_("dmg",!1),d=function(e,t){const s=se(t),i=function(e){if(0!==e){const t=ae(e),s=oe(e);return` ${t} ${s}`}return""}(s);return`${ne(e.average+s)} (${`${e.text}${i}`})`},u=_("atk",!1),m=_("mod",!1),p=_("+",!1),g=_("-",!1),b=/^[0-9]/,E={type:"class",parts:[["0","9"]],inverted:!1,ignoreCase:!1},f=_("d",!1),y=_("fin",!1),v=_("str",!1),x=_("dex",!1),w=_("con",!1),C=_("int",!1),k=_("wis",!1),T=_("cha",!1),S=_("prof",!1),I=function(){return parseInt(t.substring(R,A),10)},P={type:"any"},M=_("\n",!1),B=_("\r",!1),D=_(" ",!1),N=_("\t",!1),A=(_(".",!1),0),R=0,H=[{line:1,column:1}],L=0,z=[],$=0;if("startRule"in s){if(!(s.startRule in a))throw new Error("Can't start parsing from rule \""+s.startRule+'".');o=a[s.startRule]}function _(e,t){return{type:"literal",text:e,ignoreCase:t}}function V(e){var s,i=H[e];if(i)return i;for(s=e-1;!H[s];)s--;for(i={line:(i=H[s]).line,column:i.column};s<e;)10===t.charCodeAt(s)?(i.line++,i.column=1):i.column++,s++;return H[e]=i,i}function F(e,t){var s=V(e),i=V(t);return{start:{offset:e,line:s.line,column:s.column},end:{offset:t,line:i.line,column:i.column}}}function O(e){A<L||(A>L&&(L=A,z=[]),z.push(e))}function J(t,s,i){return new e(e.buildMessage(t,s),t,s,i)}function j(){var e,t,s;if(e=A,t=[],(s=Q())!==n)for(;s!==n;)t.push(s),s=Q();else t=n;return t!==n&&(R=e,t=t.join("")),(e=t)===n&&(e=A,(t=te())!==n&&(R=e,t=""),e=t),e}function Q(){var e;return(e=Z())===n&&(e=function(){var e,t,s;if(e=A,t=[],(s=W())!==n)for(;s!==n;)t.push(s),s=W();else t=n;t!==n&&(s=function(){var e;(e=Z())===n&&(e=te());return e}())!==n?(R=e,i=s,t=`${t.join("")}${i||""}`,e=t):(A=e,e=n);var i;return e}()),e}function W(){var e;return(e=function(){var e,i,a,o,c,d,u,m,p,g,b;e=A,"sdc"===t.substr(A,3)?(i="sdc",A+=3):(i=n,0===$&&O(r));if(i!==n)if(91===t.charCodeAt(A)?(a="[",A++):(a=n,0===$&&O(l)),a!==n){for(o=[],c=ee();c!==n;)o.push(c),c=ee();if(o!==n)if((c=X())!==n){for(d=[],u=A,m=[],p=ee();p!==n;)m.push(p),p=ee();if(m!==n)if((p=G())!==n){for(g=[],b=ee();b!==n;)g.push(b),b=ee();g!==n&&(b=U())!==n?u=m=[m,p,g,b]:(A=u,u=n)}else A=u,u=n;else A=u,u=n;for(;u!==n;){for(d.push(u),u=A,m=[],p=ee();p!==n;)m.push(p),p=ee();if(m!==n)if((p=G())!==n){for(g=[],b=ee();b!==n;)g.push(b),b=ee();g!==n&&(b=U())!==n?u=m=[m,p,g,b]:(A=u,u=n)}else A=u,u=n;else A=u,u=n}if(d!==n){for(u=[],m=ee();m!==n;)u.push(m),m=ee();u!==n?(93===t.charCodeAt(A)?(m="]",A++):(m=n,0===$&&O(h)),m!==n?(R=e,i=function(e,t){const i=se(t);return 8+e+s.proficiencyBonus+i}(c,d),e=i):(A=e,e=n)):(A=e,e=n)}else A=e,e=n}else A=e,e=n;else A=e,e=n}else A=e,e=n;else A=e,e=n;return e}())===n&&(e=function(){var e,s,i,a,o,r,u,m,p,g,y;e=A,"dmg"===t.substr(A,3)?(s="dmg",A+=3):(s=n,0===$&&O(c));if(s!==n)if(91===t.charCodeAt(A)?(i="[",A++):(i=n,0===$&&O(l)),i!==n){for(a=[],o=ee();o!==n;)a.push(o),o=ee();if(a!==n)if((o=function(){var e,s,i,a,o,r;e=A,s=A,i=[],b.test(t.charAt(A))?(a=t.charAt(A),A++):(a=n,0===$&&O(E));for(;a!==n;)i.push(a),b.test(t.charAt(A))?(a=t.charAt(A),A++):(a=n,0===$&&O(E));s=i!==n?t.substring(s,A):i;if(s!==n)if(100===t.charCodeAt(A)?(i="d",A++):(i=n,0===$&&O(f)),i!==n){if(a=A,o=[],b.test(t.charAt(A))?(r=t.charAt(A),A++):(r=n,0===$&&O(E)),r!==n)for(;r!==n;)o.push(r),b.test(t.charAt(A))?(r=t.charAt(A),A++):(r=n,0===$&&O(E));else o=n;(a=o!==n?t.substring(a,A):o)!==n?(R=e,s=function(e,t){e||(e=1);const s=parseInt(e,10),i=parseInt(t,10)/2+.5;return{text:`${e}d${t}`,average:Math.floor(s*i)}}(s,a),e=s):(A=e,e=n)}else A=e,e=n;else A=e,e=n;return e}())!==n){for(r=[],u=A,m=[],p=ee();p!==n;)m.push(p),p=ee();if(m!==n)if((p=G())!==n){for(g=[],y=ee();y!==n;)g.push(y),y=ee();g!==n&&(y=U())!==n?u=m=[m,p,g,y]:(A=u,u=n)}else A=u,u=n;else A=u,u=n;for(;u!==n;){for(r.push(u),u=A,m=[],p=ee();p!==n;)m.push(p),p=ee();if(m!==n)if((p=G())!==n){for(g=[],y=ee();y!==n;)g.push(y),y=ee();g!==n&&(y=U())!==n?u=m=[m,p,g,y]:(A=u,u=n)}else A=u,u=n;else A=u,u=n}if(r!==n){for(u=[],m=ee();m!==n;)u.push(m),m=ee();u!==n?(93===t.charCodeAt(A)?(m="]",A++):(m=n,0===$&&O(h)),m!==n?(R=e,s=d(o,r),e=s):(A=e,e=n)):(A=e,e=n)}else A=e,e=n}else A=e,e=n;else A=e,e=n}else A=e,e=n;else A=e,e=n;return e}())===n&&(e=function(){var e,i,a,o,r,c,d,m,p,g,b;e=A,"atk"===t.substr(A,3)?(i="atk",A+=3):(i=n,0===$&&O(u));if(i!==n)if(91===t.charCodeAt(A)?(a="[",A++):(a=n,0===$&&O(l)),a!==n){for(o=[],r=ee();r!==n;)o.push(r),r=ee();if(o!==n)if((r=K())!==n){for(c=[],d=A,m=[],p=ee();p!==n;)m.push(p),p=ee();if(m!==n)if((p=G())!==n){for(g=[],b=ee();b!==n;)g.push(b),b=ee();g!==n&&(b=U())!==n?d=m=[m,p,g,b]:(A=d,d=n)}else A=d,d=n;else A=d,d=n;for(;d!==n;){for(c.push(d),d=A,m=[],p=ee();p!==n;)m.push(p),p=ee();if(m!==n)if((p=G())!==n){for(g=[],b=ee();b!==n;)g.push(b),b=ee();g!==n&&(b=U())!==n?d=m=[m,p,g,b]:(A=d,d=n)}else A=d,d=n;else A=d,d=n}if(c!==n){for(d=[],m=ee();m!==n;)d.push(m),m=ee();d!==n?(93===t.charCodeAt(A)?(m="]",A++):(m=n,0===$&&O(h)),m!==n?(R=e,i=function(e,t){const i=se(t);return ie(e+s.proficiencyBonus+i)}(r,c),e=i):(A=e,e=n)):(A=e,e=n)}else A=e,e=n}else A=e,e=n;else A=e,e=n}else A=e,e=n;else A=e,e=n;return e}())===n&&(e=function(){var e,s,i;e=A,"mod"===t.substr(A,3)?(s="mod",A+=3):(s=n,0===$&&O(m));s!==n&&(i=q())!==n?(R=e,s=ie(i),e=s):(A=e,e=n);return e}())===n&&(e=function(){var e,t;e=A,(t=q())!==n&&(R=e,t=ne(t));return e=t}())===n&&(e=function(){var e,s,i;if(e=A,s=[],(i=Y())!==n)for(;i!==n;)s.push(i),i=Y();else s=n;e=s!==n?t.substring(e,A):s;return e}())===n&&(e=function(){var e,s,i;if(e=A,s=[],(i=ee())!==n)for(;i!==n;)s.push(i),i=ee();else s=n;e=s!==n?t.substring(e,A):s;return e}()),e}function q(){var e,s,i,a,o,r,c,d,u,m;if(e=A,91===t.charCodeAt(A)?(s="[",A++):(s=n,0===$&&O(l)),s!==n){for(i=[],a=ee();a!==n;)i.push(a),a=ee();if(i!==n)if((a=U())!==n){for(o=[],r=A,c=[],d=ee();d!==n;)c.push(d),d=ee();if(c!==n)if((d=G())!==n){for(u=[],m=ee();m!==n;)u.push(m),m=ee();u!==n&&(m=U())!==n?r=c=[c,d,u,m]:(A=r,r=n)}else A=r,r=n;else A=r,r=n;for(;r!==n;){for(o.push(r),r=A,c=[],d=ee();d!==n;)c.push(d),d=ee();if(c!==n)if((d=G())!==n){for(u=[],m=ee();m!==n;)u.push(m),m=ee();u!==n&&(m=U())!==n?r=c=[c,d,u,m]:(A=r,r=n)}else A=r,r=n;else A=r,r=n}if(o!==n){for(r=[],c=ee();c!==n;)r.push(c),c=ee();r!==n?(93===t.charCodeAt(A)?(c="]",A++):(c=n,0===$&&O(h)),c!==n?(R=e,e=s=se(o,a)):(A=e,e=n)):(A=e,e=n)}else A=e,e=n}else A=e,e=n;else A=e,e=n}else A=e,e=n;return e}function G(){var e;return 43===t.charCodeAt(A)?(e="+",A++):(e=n,0===$&&O(p)),e===n&&(45===t.charCodeAt(A)?(e="-",A++):(e=n,0===$&&O(g))),e}function U(){var e;return(e=K())===n&&(e=function(){var e,i;e=A,"prof"===t.substr(A,4)?(i="prof",A+=4):(i=n,0===$&&O(S));i!==n&&(R=e,i=s.proficiencyBonus);return e=i}())===n&&(e=function(){var e,s,i,a;e=A,45===t.charCodeAt(A)?(s="-",A++):(s=n,0===$&&O(g));s===n&&(s=null);if(s!==n){if(i=[],b.test(t.charAt(A))?(a=t.charAt(A),A++):(a=n,0===$&&O(E)),a!==n)for(;a!==n;)i.push(a),b.test(t.charAt(A))?(a=t.charAt(A),A++):(a=n,0===$&&O(E));else i=n;i!==n?(R=e,s=I(),e=s):(A=e,e=n)}else A=e,e=n;return e}()),e}function K(){var e,i;return(e=X())===n&&(e=A,"fin"===t.substr(A,3)?(i="fin",A+=3):(i=n,0===$&&O(y)),i!==n&&(R=e,i=s.abilities.strength.modifier>=s.abilities.dexterity.modifier?s.abilities.strength.modifier:s.abilities.dexterity.modifier),e=i),e}function X(){var e,i;return e=A,"str"===t.substr(A,3)?(i="str",A+=3):(i=n,0===$&&O(v)),i!==n&&(R=e,i=s.abilities.strength.modifier),(e=i)===n&&(e=A,"dex"===t.substr(A,3)?(i="dex",A+=3):(i=n,0===$&&O(x)),i!==n&&(R=e,i=s.abilities.dexterity.modifier),(e=i)===n&&(e=A,"con"===t.substr(A,3)?(i="con",A+=3):(i=n,0===$&&O(w)),i!==n&&(R=e,i=s.abilities.constitution.modifier),(e=i)===n&&(e=A,"int"===t.substr(A,3)?(i="int",A+=3):(i=n,0===$&&O(C)),i!==n&&(R=e,i=s.abilities.intelligence.modifier),(e=i)===n&&(e=A,"wis"===t.substr(A,3)?(i="wis",A+=3):(i=n,0===$&&O(k)),i!==n&&(R=e,i=s.abilities.wisdom.modifier),(e=i)===n&&(e=A,"cha"===t.substr(A,3)?(i="cha",A+=3):(i=n,0===$&&O(T)),i!==n&&(R=e,i=s.abilities.charisma.modifier),e=i))))),e}function Y(){var e,s,i;return e=A,s=A,$++,(i=ee())===n&&(i=Z()),$--,i===n?s=void 0:(A=s,s=n),s!==n?(t.length>A?(i=t.charAt(A),A++):(i=n,0===$&&O(P)),i!==n?e=s=[s,i]:(A=e,e=n)):(A=e,e=n),e}function Z(){var e,s,i,a;return 10===t.charCodeAt(A)?(e="\n",A++):(e=n,0===$&&O(M)),e===n&&(e=A,s=A,13===t.charCodeAt(A)?(i="\r",A++):(i=n,0===$&&O(B)),i!==n?(10===t.charCodeAt(A)?(a="\n",A++):(a=n,0===$&&O(M)),a===n&&(a=null),a!==n?s=i=[i,a]:(A=s,s=n)):(A=s,s=n),e=s!==n?t.substring(e,A):s),e}function ee(){var e;return 32===t.charCodeAt(A)?(e=" ",A++):(e=n,0===$&&O(D)),e===n&&(9===t.charCodeAt(A)?(e="\t",A++):(e=n,0===$&&O(N))),e}function te(){var e,s;return e=A,$++,t.length>A?(s=t.charAt(A),A++):(s=n,0===$&&O(P)),$--,s===n?e=void 0:(A=e,e=n),e}function se(e,t=0){return e.reduce((e,t)=>{const s=t[1],i=t[3];return"+"===s?e+i:"-"===s?e-i:void 0},t)}function ie(e){return`${ae(e)}${oe(e)}`}function ne(e){if(e<0){return`${ae(e)}${oe(e)}`}return e.toString()}function ae(e){return e<0?"–":"+"}function oe(e){return e<0?Math.abs(e).toString():e.toString()}if((i=o())!==n&&A===t.length)return i;throw i!==n&&A<t.length&&O({type:"end"}),J(z,L<t.length?t.charAt(L):null,L<t.length?F(L,L+1):F(L,L))}}}(),G=function(){function e(t,s,i,n){this.message=t,this.expected=s,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function s(){this.constructor=e}s.prototype=t.prototype,e.prototype=new s}(e,Error),e.buildMessage=function(e,t){var s={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,s="";for(t=0;t<e.parts.length;t++)s+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+s+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}return"Expected "+function(e){var t,i,n,a=new Array(e.length);for(t=0;t<e.length;t++)a[t]=(n=e[t],s[n.type](n));if(a.sort(),a.length>0){for(t=1,i=1;t<a.length;t++)a[t-1]!==a[t]&&(a[i]=a[t],i++);a.length=i}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,s){s=void 0!==s?s:{};var i,n={},a={start:P},o=P,r=C("**",!1),l=function(e){return`<strong>${e.join("")}</strong>`},h=C("__",!1),c=C("*",!1),d=function(e){return`<em>${e.join("")}</em>`},u=C("_",!1),m={type:"any"},p=C("\n",!1),g=C("\r",!1),b=C(" ",!1),E=C("\t",!1),f=0,y=[{line:1,column:1}],v=0,x=[],w=0;if("startRule"in s){if(!(s.startRule in a))throw new Error("Can't start parsing from rule \""+s.startRule+'".');o=a[s.startRule]}function C(e,t){return{type:"literal",text:e,ignoreCase:t}}function k(e){var s,i=y[e];if(i)return i;for(s=e-1;!y[s];)s--;for(i={line:(i=y[s]).line,column:i.column};s<e;)10===t.charCodeAt(s)?(i.line++,i.column=1):i.column++,s++;return y[e]=i,i}function T(e,t){var s=k(e),i=k(t);return{start:{offset:e,line:s.line,column:s.column},end:{offset:t,line:i.line,column:i.column}}}function S(e){f<v||(f>v&&(v=f,x=[]),x.push(e))}function I(t,s,i){return new e(e.buildMessage(t,s),t,s,i)}function P(){var e,t,s;if(e=f,t=[],(s=M())!==n)for(;s!==n;)t.push(s),s=M();else t=n;return t!==n&&(e,t=t.join("")),(e=t)===n&&(e=f,(t=L())!==n&&(e,t=""),e=t),e}function M(){var e;return(e=R())===n&&(e=function(){var e,t,s;if(e=f,t=[],(s=B())!==n)for(;s!==n;)t.push(s),s=B();else t=n;t!==n&&(s=function(){var e;(e=R())===n&&(e=L());return e}())!==n?(e,i=s,t=`${t.join("")}${i||""}`,e=t):(f=e,e=n);var i;return e}()),e}function B(){var e;return(e=function(){var e;(e=function(){var e;(e=D())===n&&(e=N());return e}())===n&&(e=function(){var e;(e=function(){var e,s,i,a;if(e=f,(s=function(){var e;42===t.charCodeAt(f)?(e="*",f++):(e=n,0===w&&S(c));return e}())!==n){if(i=[],(a=B())!==n)for(;a!==n;)i.push(a),a=B();else i=n;i!==n&&(a=function(){var e,s,i;e=f,s=f,w++,i=D(),w--,i===n?s=void 0:(f=s,s=n);s!==n?(42===t.charCodeAt(f)?(i="*",f++):(i=n,0===w&&S(c)),i!==n?e=s=[s,i]:(f=e,e=n)):(f=e,e=n);return e}())!==n?(e,s=d(i),e=s):(f=e,e=n)}else f=e,e=n;return e}())===n&&(e=function(){var e,s,i,a;if(e=f,(s=function(){var e;95===t.charCodeAt(f)?(e="_",f++):(e=n,0===w&&S(u));return e}())!==n){if(i=[],(a=B())!==n)for(;a!==n;)i.push(a),a=B();else i=n;i!==n&&(a=function(){var e,s,i;e=f,s=f,w++,i=N(),w--,i===n?s=void 0:(f=s,s=n);s!==n?(95===t.charCodeAt(f)?(i="_",f++):(i=n,0===w&&S(u)),i!==n?e=s=[s,i]:(f=e,e=n)):(f=e,e=n);return e}())!==n?(e,s=d(i),e=s):(f=e,e=n)}else f=e,e=n;return e}());return e}());return e}())===n&&(e=function(){var e,s,i;if(e=f,s=[],(i=A())!==n)for(;i!==n;)s.push(i),i=A();else s=n;e=s!==n?t.substring(e,f):s;return e}())===n&&(e=function(){var e,s,i;if(e=f,s=[],(i=H())!==n)for(;i!==n;)s.push(i),i=H();else s=n;e=s!==n?t.substring(e,f):s;return e}()),e}function D(){var e,s,i;if(e=f,function(){var e;return"**"===t.substr(f,2)?(e="**",f+=2):(e=n,0===w&&S(r)),e}()!==n){if(s=[],(i=B())!==n)for(;i!==n;)s.push(i),i=B();else s=n;s!==n&&(i=function(){var e;return"**"===t.substr(f,2)?(e="**",f+=2):(e=n,0===w&&S(r)),e}())!==n?(e,e=l(s)):(f=e,e=n)}else f=e,e=n;return e}function N(){var e,s,i;if(e=f,function(){var e;return"__"===t.substr(f,2)?(e="__",f+=2):(e=n,0===w&&S(h)),e}()!==n){if(s=[],(i=B())!==n)for(;i!==n;)s.push(i),i=B();else s=n;s!==n&&(i=function(){var e;return"__"===t.substr(f,2)?(e="__",f+=2):(e=n,0===w&&S(h)),e}())!==n?(e,e=l(s)):(f=e,e=n)}else f=e,e=n;return e}function A(){var e,s,i;return e=f,s=f,w++,(i=function(){var e;42===t.charCodeAt(f)?(e="*",f++):(e=n,0===w&&S(c));e===n&&(95===t.charCodeAt(f)?(e="_",f++):(e=n,0===w&&S(u)));return e}())===n&&(i=H())===n&&(i=R()),w--,i===n?s=void 0:(f=s,s=n),s!==n?(t.length>f?(i=t.charAt(f),f++):(i=n,0===w&&S(m)),i!==n?e=s=[s,i]:(f=e,e=n)):(f=e,e=n),e}function R(){var e,s,i,a;return 10===t.charCodeAt(f)?(e="\n",f++):(e=n,0===w&&S(p)),e===n&&(e=f,s=f,13===t.charCodeAt(f)?(i="\r",f++):(i=n,0===w&&S(g)),i!==n?(10===t.charCodeAt(f)?(a="\n",f++):(a=n,0===w&&S(p)),a===n&&(a=null),a!==n?s=i=[i,a]:(f=s,s=n)):(f=s,s=n),e=s!==n?t.substring(e,f):s),e}function H(){var e;return 32===t.charCodeAt(f)?(e=" ",f++):(e=n,0===w&&S(b)),e===n&&(9===t.charCodeAt(f)?(e="\t",f++):(e=n,0===w&&S(E))),e}function L(){var e,s;return e=f,w++,t.length>f?(s=t.charAt(f),f++):(s=n,0===w&&S(m)),w--,s===n?e=void 0:(f=e,e=n),e}if((i=o())!==n&&f===t.length)return i;throw i!==n&&f<t.length&&S({type:"end"}),I(x,v<t.length?t.charAt(v):null,v<t.length?T(v,v+1):T(v,v))}}}();function U(e,t={}){return t.abilities=J.creature.abilities.toParserOptions(),t.proficiencyBonus=J.creature.challengeRating.toParserOptions(),X(q,e,t)}function K(e,t={}){return X(G,e,t)}function X(e,t,s){const i={inputText:t,outputText:null,error:null};try{const n=e.parse(t,s);i.outputText=n}catch(e){i.error={message:e.message,location:e.location}}return i}class Y extends HTMLTextAreaElement{static async define(){Q.define("block-textarea",Z),i||customElements.define("block-textarea",this,{extends:"textarea"})}constructor(){super(),j(this,Z),this.initializeMixin()}}const Z={initializeMixin(){this.htmlText=null},get fieldName(){const e=this.getAttribute("pretty-name");return e||this.name},validate(e){this.required&&""===this.value&&e.add(this,`${this.fieldName} cannot be blank.`),this.parse(e)},parse(e=null){const t=function(e,t={}){return t.creature=J.creature.title.toParserOptions(),X(W,e,t)}(g(this.value));if(e&&t.error)return void e.add(this,`${this.fieldName} has at least one invalid name expression.`);const s=U(t.outputText);if(e&&s.error)return void e.add(this,`${this.fieldName} has at least one invalid math expression.`);const i=K(s.outputText);e&&i.error?e.add(this,`${this.fieldName} has invalid markdown syntax.`):(this.homebreweryText=s.outputText.replace(/\n/g,"  \n> "),this.htmlText=i.outputText)}};class ee extends HTMLInputElement{static get elementName(){throw new Error(`The class '${this.name}' must implement the elementName() getter.`)}static get mixin(){throw new Error(`The class '${this.name}' must implement the mixin() getter.`)}static define(){Q.define(this.elementName,this.mixin),i||customElements.define(this.elementName,this,{extends:"input"})}constructor(){super(),j(this,this.constructor.mixin),this.initializeMixin()}}function te(e){const t=e.tagName;(function(e,t){return"INPUT"===e&&("text"===t||"number"===t)})(t,e.getAttribute("type"))||function(e){return"TEXTAREA"===e}(t)?(e.focus(),e.select()):e.focus()}function se(e,t){const s=e.tagName,i=e.getAttribute("type");"INPUT"===s&&"checkbox"===i?e.checked=t:e.value=t,e.dispatchEvent(new Event("input"))}class ie extends ee{static get elementName(){return"enable-disable-elements-checkbox"}static get mixin(){return ne}constructor(){super()}}let ne={enabledElements:[],disabledElements:[],initializeMixin(){this.addEventListener("input",this.onInputCheckbox.bind(this))},onInputCheckbox(){const e=this.checked?this.enabledElements:this.disabledElements,t=this.checked?this.disabledElements:this.enabledElements;for(const[t,s]of e.entries())s.removeAttribute("disabled"),0===t&&te(s);for(const e of t)e.setAttribute("disabled","")},enableElementsWhenChecked(...e){this.enabledElements=this.enabledElements.concat(e)},disableElementsWhenChecked(...e){this.disabledElements=this.disabledElements.concat(e)}};function ae(e){const t=parseInt(e,10);return isNaN(t)?null:t}class oe extends ee{static get elementName(){return"number-input"}static get mixin(){return re}constructor(){super()}}let re={initializeMixin(){this.addEventListener("input",this.onInput)},onInput(){if(this.value){let e=this.valueAsInt;this.min&&e<this.minAsInt?this.value=this.min:this.max&&e>this.maxAsInt?this.value=this.max:this.value=e}},validate(e){if(null===this.valueAsInt){const t=this.getAttribute("pretty-name"),s=t||this.name;e.add(this,`${s} must be a valid number.`)}},get valueAsInt(){return ae(this.value)},get minAsInt(){return ae(this.min)},get maxAsInt(){return ae(this.max)}};class le extends HTMLSelectElement{static async define(){Q.define("number-select",he),i||customElements.define("number-select",this,{extends:"select"})}constructor(){super(),j(this,he),this.initializeMixin()}}let he={initializeMixin(){},get valueAsInt(){return ae(this.value)},get valueAsFloat(){return parseFloat(this.value)}};class ce extends HTMLDataListElement{static async define(){Q.define("property-datalist",de),i||customElements.define("property-datalist",this,{extends:"datalist"})}constructor(){super(),j(this,de),this.initializeMixin()}}const de={initializeMixin(){},setOptionEnabled(e,t){let s=null;s=i?this.findOption(e):this.options.namedItem(e),null!==s&&(t?s.removeAttribute("disabled"):s.setAttribute("disabled",""))},findOption(e){for(const t of this.childNodes)if("OPTION"===t.tagName&&t.value===e)return t;return null}},ue=s(8)(window);class me extends HTMLParagraphElement{static async define(){Q.define("sanitized-paragraph",pe),i||customElements.define("sanitized-paragraph",this,{extends:"p"})}constructor(){super(),j(this,pe),this.initializeMixin()}}const pe={initializeMixin(){},set innerHTMLSanitized(e){var t;this.innerHTML=(t=e,ue.sanitize(t,{ALLOWED_TAGS:["strong","em","b","i"]}))},get innerHTMLSanitized(){return this.innerHTML}};class ge extends ee{static get elementName(){return"text-input"}static get mixin(){return be}constructor(){super()}}let be={initializeMixin(){this.htmlText=""},get fieldName(){const e=this.getAttribute("pretty-name");return e||this.name},validate(e){this.required&&""===this.value?e.add(this,`${this.fieldName} cannot be blank.`):"parsed"in this.dataset&&this.parse(e)},parse(e){const t=K(g(this.value));if(t.error){const t=`${this.fieldName} has invalid Markdown syntax.`;e.add(this,t)}else this.htmlText=t.outputText}};var Ee=new class{constructor(){this.templates=new Map}async addTemplate(e,t){const s=await n(t);this.templates.set(e,s)}hasTemplate(e){return this.templates.has(e)}getTemplate(e){return this.templates.get(e)}};class fe extends HTMLElement{static get elementName(){throw new Error(`The class '${this.name}' must implement the elementName() getter.`)}static get templatePaths(){return new Map}static async define(){for(const[e,t]of this.templatePaths)Ee.hasTemplate(e)||await Ee.addTemplate(e,t);customElements.define(this.elementName,this)}constructor(e){super(),this.isInitialized=!1,this.attachShadow({mode:"open"});for(const t of e.keys()){const e=Ee.getTemplate(t),s=document.createRange().createContextualFragment(e);this.shadowRoot.appendChild(s.cloneNode(!0))}}connectedCallback(){}}class ye{static get elementName(){throw new Error(`The class '${this.name}' must implement the elementName() getter.`)}static get templatePaths(){return new Map}static async define(){for(const[e,t]of this.templatePaths)Ee.hasTemplate(e)||await Ee.addTemplate(e,t)}constructor(e,t=null){this._parent=t,this._children=[],this.element=document.createElement(this.elementName),this.dataset=new Map,this.shadowRoot=document.createDocumentFragment();const s=document.createElement("body");this.shadowRoot.appendChild(s);for(const t of e.keys()){const e=Ee.getTemplate(t);s.innerHTML+=e}}connectedCallback(){}connect(){this.isConnected=!0,this.connectedCallback()}addEventListener(e,t){this.shadowRoot.addEventListener(e,t)}dispatchEvent(e){this.shadowRoot.dispatchEvent(e),e.bubbles&&null!==this._parent&&this._parent.dispatchEvent(e)}getAttribute(e){return this.element.getAttribute(e)}setAttribute(e,t){this.element.setAttribute(e,t)}removeAttribute(e){this.element.removeAttribute(e)}get children(){return this._children}appendChild(e){this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);t>=0&&this._children.splice(t,1)}insertBefore(e,t){const s=this._children.indexOf(e),i=this._children.indexOf(t);this._children.splice(i,0,this._children.splice(s,1)[0])}}let ve;ve=i?ye:fe;var xe=ve;class we extends xe{static get elementName(){return"drop-down-menu"}static get templatePaths(){return super.templatePaths.set("drop-down-menu","src/html/elements/autonomous/drop-down-menu.html")}constructor(){super(we.templatePaths)}}class Ce extends xe{static get elementName(){return"error-messages"}static get templatePaths(){return super.templatePaths.set("error-messages","src/html/elements/autonomous/error-messages.html")}constructor(){super(Ce.templatePaths),this.container=this.shadowRoot.getElementById("error-messages"),this.list=this.shadowRoot.getElementById("error-messages-list"),this.errors=[]}add(e,t){let s={fieldElement:e,message:t};this.errors.push(s),e.classList.add("section__error-highlight"),this.container.classList.remove("error-messages_hidden");let i=Ce.createErrorMessageElement(t);this.list.appendChild(i)}clear(){for(this.container.classList.add("error-messages_hidden");this.errors.length>0;){this.errors.pop().fieldElement.classList.remove("section__error-highlight")}let e=this.list;for(;e.hasChildNodes();)e.removeChild(e.lastChild)}focusOnFirstErrorField(){te(this.errors[0].fieldElement)}get any(){return this.errors.length>0}static createErrorMessageElement(e){let t=document.createElement("li"),s=document.createTextNode(e);return t.appendChild(s),t}}class ke extends xe{static get elementName(){return"property-block"}static get templatePaths(){return super.templatePaths.set("property-block","src/html/elements/autonomous/property-block.html")}constructor(){super(ke.templatePaths)}}class Te extends xe{static get elementName(){return"property-line"}static get templatePaths(){return super.templatePaths.set("property-line","src/html/elements/autonomous/property-line.html")}constructor(){super(Te.templatePaths)}}class Se extends xe{static get elementName(){return"section-divider"}static get templatePaths(){return super.templatePaths.set("section-divider","src/html/elements/autonomous/section-divider.html")}static get hiddenClassName(){return"section-divider_hidden"}constructor(){super(Se.templatePaths),this.divider=this.shadowRoot.querySelector(".section-divider"),this.hidden=!0}get hidden(){return this.divider.classList.contains(Se.hiddenClassName)}set hidden(e){e?this.divider.classList.add(Se.hiddenClassName):this.divider.classList.remove(Se.hiddenClassName)}}class Ie extends xe{static get elementName(){return"tapered-rule"}static get templatePaths(){return super.templatePaths.set("tapered-rule","src/html/elements/autonomous/tapered-rule.html")}constructor(){super(Ie.templatePaths)}}class Pe extends xe{static get elementName(){return"custom-dialog"}static get templatePaths(){return super.templatePaths.set("custom-dialog","src/html/elements/autonomous/dialogs/custom-dialog.html")}constructor(e,t=null){super(e,t),this.dialog=this.shadowRoot.getElementById("dialog"),this.closeButton=this.shadowRoot.getElementById("close-button")}connectedCallback(){this.closeButton.addEventListener("click",this.onClickCloseButton.bind(this))}onClickCloseButton(){this.closeModal()}set open(e){e?this.dialog.setAttribute("open",""):this.dialog.removeAttribute("open")}get open(){return this.dialog.getAttribute("open")}showModal(){i?this.open=!0:this.dialog.showModal()}closeModal(){i?this.open=!1:this.dialog.close()}}class Me extends Pe{static get elementName(){return"option-dialog"}static get templatePaths(){return super.templatePaths.set("option-dialog","src/html/elements/autonomous/dialogs/option-dialog.html")}constructor(e,t=null){super(e,t),this.statusLabel=this.shadowRoot.getElementById("status-label"),this.cancelButton=this.shadowRoot.getElementById("cancel-button")}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.cancelButton.addEventListener("click",this.onClickCloseButton.bind(this)),this.isInitialized=!0)}setStatus(e,t=null){switch(this.statusLabel.textContent=e,this.statusLabel.classList.remove("option-dialog__status-label_success"),this.statusLabel.classList.remove("option-dialog__status-label_error"),t){case"success":this.statusLabel.classList.add("option-dialog__status-label_success");break;case"error":this.statusLabel.classList.add("option-dialog__status-label_error")}}}class Be extends Me{static get elementName(){return"import-dialog"}static get templatePaths(){return super.templatePaths.set("import-dialog","src/html/elements/autonomous/dialogs/import-dialog.html")}constructor(){super(Be.templatePaths),this.statBlockEditor=null,this.chooseFileButton=this.shadowRoot.getElementById("choose-file-button"),this.fileInput=this.shadowRoot.getElementById("file-input")}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.chooseFileButton.addEventListener("click",this.onClickChooseFileButton.bind(this)),this.fileInput.addEventListener("change",this.onJsonImportFileSelected.bind(this)),this.isInitialized=!0)}onClickChooseFileButton(){this.fileInput.click()}async onJsonImportFileSelected(){const e=this.fileInput.files[0],t=await e.text(),s=JSON.parse(t);this.statBlockEditor.importFromJson(s),this.closeModal()}launch(){this.fileInput.value="",this.setStatus('Click "Choose File..." to begin.'),this.showModal()}}class De extends Me{static get elementName(){return"export-dialog"}static get templatePaths(){return super.templatePaths.set("export-dialog","src/html/elements/autonomous/dialogs/export-dialog.html")}constructor(){super(De.templatePaths),this.copyToClipboardButton=this.shadowRoot.getElementById("copy-to-clipboard-button"),this.downloadAsFileButton=this.shadowRoot.getElementById("download-as-file-button"),this.clipboard=null,this.exportContent=null,this.exportContentType=null,this.exportFileName=null}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.downloadAsFileButton.addEventListener("click",this.onClickDownloadAsFileButton.bind(this)),this.isInitialized=!0)}onClickDownloadAsFileButton(){!function(e,t,s){const i=new Blob([e],{type:t}),n=document.createElement("a");n.download=s,n.href=URL.createObjectURL(i),n.click()}(this.exportContent,this.exportContentType,this.exportFileName),this.setStatus("File download initiated.","success")}onClickCloseButton(){super.onClickCloseButton(),this.clipboard.destroy()}launch(e,t,s){this.exportContent=e,this.exportContentType=t,this.exportFileName=s,this.setStatus("Choose one of the following options:"),this.clipboard=new c(e,this.dialog,this.copyToClipboardButton),this.clipboard.setSuccessCallback(()=>{this.setStatus("Copied to clipboard.","success")}),this.clipboard.setErrorCallback(()=>{this.setStatus("Press Ctrl+C to copy to clipboard.","error")}),this.showModal()}}class Ne{constructor(e=null){this.reset(),e&&this.populateFromJsObject(e)}reset(e=!0){this.weaponName="",this.isFinesse=!1,this._reach=5,this._normalRange=20,this._longRange=60,this.damageCategories={melee:new Ae({isEnabled:e}),ranged:new Ae,versatile:new Ae,bonus:new Ae}}populateFromJsObject(e){e.weaponName&&(this.weaponName=e.weaponName),e.isFinesse&&(this.isFinesse=e.isFinesse),e.reach&&(this.reach=e.reach),e.normalRange&&(this.normalRange=e.normalRange),e.longRange&&(this.longRange=e.longRange);for(const t in this.damageCategories){const s=e.damageCategories[t]?e.damageCategories[t]:null;s&&this.damageCategories[t].populateFromJsObject(s)}}get damageCategoryKeys(){return Object.keys(this.damageCategories)}get damageCategoryEntries(){return Object.entries(this.damageCategories)}set reach(e){this._reach=e}get reach(){return this._reach?this._reach:0}set normalRange(e){this._normalRange=e}get normalRange(){return this._normalRange?this._normalRange:0}set longRange(e){this._longRange=e}get longRange(){return this._longRange?this._longRange:0}get generatedText(){const e=this.damageCategories.melee,t=this.damageCategories.ranged,s=this.damageCategories.versatile,i=this.damageCategories.bonus;if(e.isEnabled||t.isEnabled){const n=this.generatedTextParserAbilityModifier(e.isEnabled,t.isEnabled);return`*${this.generatedTextAttackType(e.isEnabled,t.isEnabled)}:* ${this.generatedTextToHit(n)}, ${this.generatedTextReachOrRange(e.isEnabled,t.isEnabled)}, one target. *Hit:* ${this.generatedTextDamage(e,t,s,i,n)}.`}return""}generatedTextParserAbilityModifier(e,t){return this.isFinesse?"fin":e?"str":t?"dex":""}generatedTextAttackType(e,t){return e&&t?"Melee or Ranged Weapon Attack":e?"Melee Weapon Attack":t?"Ranged Weapon Attack":""}generatedTextToHit(e){return`atk[${e}] to hit`}generatedTextReachOrRange(e,t){return e&&t?`reach ${this.reach} ft. or range ${this.normalRange}/${this.longRange} ft.`:e?`reach ${this.reach} ft.`:t?`range ${this.normalRange}/${this.longRange} ft.`:""}generatedTextDamage(e,t,s,i,n){const a=e.isEnabled&&t.isEnabled,o=e.hasSameValuesWith(t);return`${this.generatedTextMeleeRangedDamage(e,t,n)}${this.generatedTextVersatileDamage(s,n,a)}${this.generatedTextBonusDamage(i,s.isEnabled,a,o)}`}generatedTextMeleeRangedDamage(e,t,s){if(e.isEnabled&&t.isEnabled){const i=e.generateDamageText(s);return e.hasSameValuesWith(t)?i:`${i} in melee or ${t.generateDamageText(s)} at range`}return e.isEnabled?e.generateDamageText(s):t.isEnabled?t.generateDamageText(s):""}generatedTextVersatileDamage(e,t,s){if(e.isEnabled){return`, or ${e.generateDamageText(t)} if used with two hands${s?" to make a melee attack":""}`}return""}generatedTextBonusDamage(e,t,s,i){if(e.isEnabled){return`${t||s&&!i?",":""} plus ${e.generateDamageText()}`}return""}renderText(e){if(""===e)return"";const t=U(e);if(t.error)return"Error: Generated text has at least one invalid math expression.";const s=K(t.outputText);return s.error?"Error: Generated text has invalid markdown syntax.":s.outputText}}class Ae{constructor(e=null){this.reset(),e&&this.populateFromJsObject(e)}reset(){this.isEnabled=!1,this.damageType="",this.damageDieQuantity=1,this.damageDieSize=8}populateFromJsObject(e){e.isEnabled&&(this.isEnabled=e.isEnabled),e.damageType&&(this.damageType=e.damageType),e.damageDieQuantity&&(this.damageDieQuantity=e.damageDieQuantity),e.damageDieSize&&(this.damageDieSize=e.damageDieSize)}set damageDieQuantity(e){this._damageDieQuantity=e}get damageDieQuantity(){return this._damageDieQuantity?this._damageDieQuantity:1}set damageDieSize(e){this._damageDieSize=e}get damageDieSize(){return this._damageDieSize?this._damageDieSize:0}generateDamageText(e){const t=this.damageType?` ${this.damageType}`:"";if(1===this.damageDieSize){return`${this.damageDieQuantity*this.damageDieSize}${t} damage`}return e?`dmg[${this.damageDieQuantity}d${this.damageDieSize} + ${e}]${t} damage`:`dmg[${this.damageDieQuantity}d${this.damageDieSize}]${t} damage`}hasSameValuesWith(e){return this.damageType===e.damageType&&this.damageDieQuantity===e.damageDieQuantity&&this.damageDieSize===e.damageDieSize}}var Re={Club:{weaponName:"Club",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:4}}},Dagger:{weaponName:"Dagger",isFinesse:!0,reach:5,normalRange:20,longRange:60,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:4},ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:4}}},Greatclub:{weaponName:"Greatclub",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:8}}},Handaxe:{weaponName:"Handaxe",reach:5,normalRange:20,longRange:60,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:6},ranged:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:6}}},Javelin:{weaponName:"Javelin",reach:5,normalRange:30,longRange:120,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6},ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6}}},"Light Hammer":{weaponName:"Light Hammer",reach:5,normalRange:20,longRange:60,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:4},ranged:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:4}}},Mace:{weaponName:"Mace",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:6}}},Quarterstaff:{weaponName:"Quarterstaff",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:6},versatile:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:8}}},Sickle:{weaponName:"Sickle",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:4}}},Spear:{weaponName:"Spear",reach:5,normalRange:20,longRange:60,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6},ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6},versatile:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}},"Light Crossbow":{weaponName:"Light Crossbow",normalRange:80,longRange:320,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}},Dart:{weaponName:"Dart",isFinesse:!0,normalRange:20,longRange:60,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:4}}},Shortbow:{weaponName:"Shortbow",normalRange:80,longRange:320,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6}}},Sling:{weaponName:"Sling",normalRange:30,longRange:120,damageCategories:{ranged:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:4}}},Battleaxe:{weaponName:"Battleaxe",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:8},versatile:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:10}}},Flail:{weaponName:"Flail",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:8}}},Glaive:{weaponName:"Glaive",reach:10,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:10}}},Greataxe:{weaponName:"Greataxe",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:12}}},Greatsword:{weaponName:"Greatsword",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:2,damageDieSize:6}}},Halberd:{weaponName:"Halberd",reach:10,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:10}}},Longsword:{weaponName:"Longsword",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:8},versatile:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:10}}},Lance:{weaponName:"Lance",reach:10,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:12}}},Maul:{weaponName:"Maul",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:2,damageDieSize:6}}},Morningstar:{weaponName:"Morningstar",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}},Pike:{weaponName:"Pike",reach:10,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:10}}},Rapier:{weaponName:"Rapier",isFinesse:!0,reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}},Scimitar:{weaponName:"Scimitar",isFinesse:!0,reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:6}}},Shortsword:{weaponName:"Shortsword",isFinesse:!0,reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6}}},Trident:{weaponName:"Trident",reach:5,normalRange:20,longRange:60,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6},ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6},versatile:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}},"War Pick":{weaponName:"War Pick",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}},Warhammer:{weaponName:"Warhammer",reach:5,damageCategories:{melee:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:8},versatile:{isEnabled:!0,damageType:"bludgeoning",damageDieQuantity:1,damageDieSize:10}}},Whip:{weaponName:"Whip",isFinesse:!0,reach:10,damageCategories:{melee:{isEnabled:!0,damageType:"slashing",damageDieQuantity:1,damageDieSize:4}}},Blowgun:{weaponName:"Blowgun",normalRange:25,longRange:100,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:1}}},"Hand Crossbow":{weaponName:"Hand Crossbow",normalRange:30,longRange:120,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:6}}},"Heavy Crossbow":{weaponName:"Heavy Crossbow",normalRange:100,longRange:400,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:10}}},Longbow:{weaponName:"Longbow",normalRange:150,longRange:600,damageCategories:{ranged:{isEnabled:!0,damageType:"piercing",damageDieQuantity:1,damageDieSize:8}}}};class He extends Pe{static get elementName(){return"generate-attack-dialog"}static get templatePaths(){return super.templatePaths.set("generate-attack-dialog","src/html/elements/autonomous/dialogs/generate-attack-dialog.html")}constructor(e=null){super(He.templatePaths,e),this.attackModel=new Ne,this.errorMessages=this.shadowRoot.getElementById("error-messages"),this.weaponNameInput=this.shadowRoot.getElementById("weapon-name-input"),this.finesseInput=this.shadowRoot.getElementById("finesse-input"),this.damageCategoryInputs={};for(const e of this.attackModel.damageCategoryKeys)this.damageCategoryInputs[e]={enabled:this.shadowRoot.getElementById(`${e}-enabled-input`),damageType:this.shadowRoot.getElementById(`${e}-damage-type-input`),damageDieQuantity:this.shadowRoot.getElementById(`${e}-damage-die-quantity-input`),damageDieSize:this.shadowRoot.getElementById(`${e}-damage-die-size-input`)};this.reachInput=this.shadowRoot.getElementById("reach-input"),this.normalRangeInput=this.shadowRoot.getElementById("normal-range-input"),this.longRangeInput=this.shadowRoot.getElementById("long-range-input"),this.generatedTextElement=this.shadowRoot.getElementById("generated-text"),this.renderedTextElement=this.shadowRoot.getElementById("rendered-text"),this.cancelButton=this.shadowRoot.getElementById("cancel-button"),this.resetButton=this.shadowRoot.getElementById("reset-button"),this.generateAttackButton=this.shadowRoot.getElementById("generate-attack-button")}connectedCallback(){if(this.isConnected&&!this.isInitialized){super.connectedCallback();for(const e of this.attackModel.damageCategoryKeys){const t=this.damageCategoryInputs[e],s=[t.damageType,t.damageDieQuantity,t.damageDieSize];"melee"===e?s.push(this.reachInput):"ranged"===e&&(s.push(this.normalRangeInput),s.push(this.longRangeInput)),t.enabled.enableElementsWhenChecked(...s),t.enabled.addEventListener("input",this.onInputDamageCategoryEnabled.bind(this,e)),t.damageType.addEventListener("input",this.onInputDamageCategoryDamageType.bind(this,e)),t.damageDieQuantity.addEventListener("input",this.onInputDamageCategoryDamageDieQuantity.bind(this,e)),t.damageDieSize.addEventListener("input",this.onInputDamageCategoryDamageDieSize.bind(this,e))}this.weaponNameInput.addEventListener("input",this.onInputWeaponName.bind(this)),this.finesseInput.addEventListener("input",this.onInputFinesse.bind(this)),this.reachInput.addEventListener("input",this.onInputReach.bind(this)),this.normalRangeInput.addEventListener("input",this.onInputNormalRange.bind(this)),this.longRangeInput.addEventListener("input",this.onInputLongRange.bind(this)),this.cancelButton.addEventListener("click",this.onClickCloseButton.bind(this)),this.resetButton.addEventListener("click",this.onClickResetButton.bind(this)),this.generateAttackButton.addEventListener("click",this.onClickGenerateAttackButton.bind(this)),this.isInitialized=!0,this.update()}}onInputWeaponName(){const e=this.weaponNameInput.value,t=Re[e];t?(this.reset(!1),this.attackModel.populateFromJsObject(t),this.populateFieldsFromModel(this.attackModel)):this.attackModel.weaponName=e,this.update()}onInputFinesse(){this.attackModel.isFinesse=this.finesseInput.checked,this.update()}onInputDamageCategoryEnabled(e){this.attackModel.damageCategories[e].isEnabled=this.damageCategoryInputs[e].enabled.checked,this.update()}onInputDamageCategoryDamageType(e){this.attackModel.damageCategories[e].damageType=this.damageCategoryInputs[e].damageType.value,this.update()}onInputDamageCategoryDamageDieQuantity(e){this.attackModel.damageCategories[e].damageDieQuantity=this.damageCategoryInputs[e].damageDieQuantity.valueAsInt,this.update()}onInputDamageCategoryDamageDieSize(e){this.attackModel.damageCategories[e].damageDieSize=this.damageCategoryInputs[e].damageDieSize.valueAsInt,this.update()}onInputReach(){this.attackModel.reach=this.reachInput.valueAsInt,this.update()}onInputNormalRange(){this.attackModel.normalRange=this.normalRangeInput.valueAsInt,this.update()}onInputLongRange(){this.attackModel.longRange=this.longRangeInput.valueAsInt,this.update()}onClickResetButton(){this.reset()}onClickGenerateAttackButton(){this.generateAttack()}get generatedText(){return this.generatedTextElement.textContent}get renderedText(){return this.renderedTextElement.innerHTMLSanitized}launch(){this.showModal(),te(this.weaponNameInput)}reset(e=!0){this.attackModel.reset(e),this.populateFieldsFromModel(this.attackModel),this.update(),te(this.weaponNameInput)}checkForErrors(){this.weaponNameInput.validate(this.errorMessages);const e=this.damageCategoryInputs.melee.enabled,t=this.damageCategoryInputs.ranged.enabled;e.checked||t.checked||this.errorMessages.add(e,'At least one of "Melee" or "Ranged" must be enabled.')}generateAttack(){if(this.errorMessages.clear(),this.checkForErrors(),this.errorMessages.any)return void this.errorMessages.focusOnFirstErrorField();const e=new CustomEvent("generateAttack",{bubbles:!0,composed:!0,detail:{name:this.attackModel.weaponName,text:this.attackModel.generatedText}});this.dispatchEvent(e),this.closeModal(),this.reset()}populateFieldsFromModel(e){this.weaponNameInput.value=e.weaponName,this.finesseInput.checked=e.isFinesse;for(const t of e.damageCategoryKeys){const s=e.damageCategories[t],i=this.damageCategoryInputs[t];i.enabled.checked=s.isEnabled,i.enabled.dispatchEvent(new Event("input")),i.damageType.value=s.damageType,i.damageDieQuantity.value=s.damageDieQuantity,i.damageDieSize.value=s.damageDieSize}this.reachInput.value=e.reach,this.normalRangeInput.value=e.normalRange,this.longRangeInput.value=e.longRange}update(){const e=this.attackModel.generatedText;this.generatedTextElement.textContent=e,this.renderedTextElement.innerHTMLSanitized=this.attackModel.renderText(e)}}class Le extends xe{static get elementName(){return"help-tooltip"}static get templatePaths(){return super.templatePaths.set("help-tooltip","src/html/elements/autonomous/tooltips/help-tooltip.html")}constructor(){super(Le.templatePaths)}}class ze extends xe{static get elementName(){return"block-help-tooltip"}static get templatePaths(){return super.templatePaths.set("block-help-tooltip","src/html/elements/autonomous/tooltips/block-help-tooltip.html")}constructor(){super(ze.templatePaths)}}class $e extends xe{static get elementName(){return"custom-text-help-tooltip"}static get templatePaths(){return super.templatePaths.set("custom-text-help-tooltip","src/html/elements/autonomous/tooltips/custom-text-help-tooltip.html")}constructor(){super($e.templatePaths)}}class _e extends xe{static get elementName(){return"display-block"}static get templatePaths(){return super.templatePaths.set("display-block","src/html/elements/autonomous/lists/display-block.html")}constructor(){super(_e.templatePaths),this.nameElement=this.shadowRoot.getElementById("display-block-name"),this.textElement=this.shadowRoot.getElementById("display-block-text")}disableBlockNameItalics(){this.nameElement.classList.add("display-block__name_no-italic")}get name(){return this.nameElement.textContent}set name(e){this.nameElement.textContent=e}get text(){return this.textElement.innerHTMLSanitized}set text(e){this.textElement.innerHTMLSanitized=e}}class Ve extends xe{static get elementName(){return"display-block-list"}static get templatePaths(){return super.templatePaths.set("display-block-list","src/html/elements/autonomous/lists/display-block-list.html")}constructor(){super(Ve.templatePaths),this.disableBlockNameItalics=!1}get blocks(){return Array.from(this.children)}clear(){for(const e of this.blocks)this.removeChild(e)}addBlock(e,t){const s=Ve.createBlock(e,t);this.disableBlockNameItalics&&s.disableBlockNameItalics(),this.appendChild(s)}static createBlock(e,t){const s=i?new _e:document.createElement("display-block");return s.name=e,s.text=t,s}}class Fe extends xe{static get templatePaths(){return super.templatePaths.set("drag-and-drop-list-item","src/html/elements/autonomous/lists/drag-and-drop-list-item.html")}constructor(e,t){super(e,t),this.list=null,this.dragImage=null,this.container=this.shadowRoot.getElementById("drag-and-drop-list-item-container"),this.dragHandle=this.shadowRoot.getElementById("drag-and-drop-list-item-drag-handle")}connectedCallback(){this.dragHandle.style.cssText="user-select: none; -webkit-user-drag: element;",this.dragHandle.setAttribute("draggable","true"),this.addEventListener("dragstart",this.onDragStartItem.bind(this)),this.addEventListener("dragover",this.onDragOverItem.bind(this)),this.addEventListener("dragleave",this.onDragLeaveItem.bind(this)),this.addEventListener("dragend",this.onDragEndItem.bind(this)),this.addEventListener("drop",this.onDropItem.bind(this))}onDragStartItem(e){e.dataTransfer.setData("text",""),e.dataTransfer.setDragImage(this.dragImage,0,0),this.list.draggedItem=e.target}onDragOverItem(e){if(e.preventDefault(),null!==this.list.draggedItem){e.dataTransfer.dropEffect="move";let t=e.target.getBoundingClientRect(),s=t.y+t.height/2;e.clientY<s?this.dragoverRegion="top":this.dragoverRegion="bottom"}else e.dataTransfer.dropEffect="none"}onDragLeaveItem(){this.dragoverRegion="none"}onDragEndItem(){this.list.draggedItem=null}onDropItem(e){e.preventDefault(),"top"===this.dragoverRegion?(this.list.insertDraggedItemBefore(this),this.dragoverRegion="none"):"bottom"===this.dragoverRegion&&(this.list.insertDraggedItemBefore(this.nextElementSibling),this.dragoverRegion="none")}get dragoverRegion(){return this.dataset.dragoverRegion}set dragoverRegion(e){const t="drag-and-drop-list-item__container_dragover-top",s="drag-and-drop-list-item__container_dragover-bottom";switch(e){case"top":this.dataset.dragoverRegion="top",this.container.classList.add(t),this.container.classList.remove(s);break;case"bottom":this.dataset.dragoverRegion="bottom",this.container.classList.remove(t),this.container.classList.add(s);break;default:this.dataset.dragoverRegion="none",this.container.classList.remove(t),this.container.classList.remove(s)}}}class Oe extends Fe{static get elementName(){return"editable-block"}static get templatePaths(){return super.templatePaths.set("editable-block","src/html/elements/autonomous/lists/editable-block.html")}constructor(){super(Oe.templatePaths),this.nameInput=this.shadowRoot.getElementById("editable-block-name"),this.textArea=this.shadowRoot.getElementById("editable-block-textarea"),this.namePreviewElement=this.shadowRoot.getElementById("editable-block-name-preview"),this.textPreviewElement=this.shadowRoot.getElementById("editable-block-text-preview"),this.removeButton=this.shadowRoot.getElementById("editable-block-remove-button"),this.dragImage=this.nameInput,Q.applyToElement(this.nameInput),Q.applyToElement(this.textArea)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.nameInput.addEventListener("input",this.onInputName.bind(this)),this.textArea.addEventListener("input",this.onInputText.bind(this)),this.removeButton.addEventListener("click",this.onClickRemoveButton.bind(this)),this.isInitialized=!0)}onInputName(){this.nameInput.value=this.nameInput.value.replace(/\.+$/,""),this.namePreviewElement.textContent=this.nameInput.value}onInputText(){this.textArea.parse(),this.textPreviewElement.innerHTMLSanitized=this.textArea.htmlText}onClickRemoveButton(){this.remove()}disableBlockNameItalics(){this.nameInput.classList.add("editable-block__name_no-italic")}set name(e){this.nameInput.value=e}get name(){return this.nameInput.value}set text(e){this.textArea.value=e}get text(){return this.textArea.value}get homebreweryText(){return this.textArea.homebreweryText}get htmlText(){return this.textArea.htmlText}set previewName(e){this.namePreviewElement.textContent=e}get previewName(){return this.namePreviewElement.textContent}set previewText(e){this.textPreviewElement.innerHTMLSanitized=e}get previewText(){return this.textPreviewElement.innerHTMLSanitized}validate(e){this.nameInput.validate(e),this.textArea.validate(e)}parse(){this.textArea.parse()}remove(){this.list.removeChild(this)}toModel(){return new H(this.name,this.text,this.homebreweryText,this.htmlText)}}class Je extends xe{constructor(e,t){super(e,t),this.draggedItem=null}insertDraggedItemBefore(e){null!==this.draggedItem&&(this.insertBefore(this.draggedItem,e),this.draggedItem=null)}}class je extends Je{static get elementName(){return"editable-block-list"}static get templatePaths(){return super.templatePaths.set("editable-block-list","src/html/elements/autonomous/lists/editable-block-list.html")}constructor(){super(je.templatePaths),this.disableBlockNameItalics=!1,this.blockType=null}get blocks(){return Array.from(this.children)}clear(){for(const e of this.blocks)e.remove()}addBlock(e="",t=""){const s=je.createBlock(this,e,t);return this.disableBlockNameItalics&&s.disableBlockNameItalics(),i&&s.connect(),this.appendChild(s),te(s.nameInput),s}validate(e){for(const t of this.blocks)t.validate(e)}parse(){for(const e of this.blocks)e.parse()}toModel(){return this.blocks.map(e=>e.toModel())}static createBlock(e,t,s){const n=i?new Oe:document.createElement("editable-block");return n.list=e,n.name=t,n.text=s,n.nameInput.setAttribute("pretty-name",`${e.blockType} Name`),n.textArea.setAttribute("pretty-name",`${e.blockType} Text`),n}}class Qe extends Fe{static get elementName(){return"property-list-item"}static get templatePaths(){return super.templatePaths.set("property-list-item","src/html/elements/autonomous/lists/property-list-item.html")}constructor(e){super(Qe.templatePaths,e),this.label=this.shadowRoot.getElementById("property-list-item-label"),this.removeButton=this.shadowRoot.getElementById("property-list-item-remove-button"),this.dragImage=this.label}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.removeButton.addEventListener("click",this.onClickRemoveButton.bind(this)),this.isInitialized=!0)}onClickRemoveButton(){this.remove()}get text(){return this.label.textContent}set text(e){this.label.textContent=e}remove(){const e=new CustomEvent("propertyListItemRemoved",{bubbles:!0,composed:!0,detail:{itemText:this.text}});this.dispatchEvent(e),this.list.removeChild(this)}}class We extends Je{static get elementName(){return"property-list"}static get templatePaths(){return super.templatePaths.set("property-list","src/html/elements/autonomous/lists/property-list.html")}constructor(e){super(We.templatePaths,e)}set items(e){this.clearItems();for(const t of e)this.addItem(t)}get items(){return Array.from(this.children)}get itemsAsText(){return this.items.map(e=>e.text)}contains(e){return this.itemsAsText.includes(e)}addItem(e){const t=We.createListItem(this,e);i&&t.connect(),this.appendChild(t)}clearItems(){for(const e of this.items)e.remove()}findItem(e){return this.items.filter(t=>t.text===e)[0]}static createListItem(e,t){const s=i?new Qe(e):document.createElement("property-list-item");return s.list=e,s.text=t,s}}class qe extends xe{static get templatePaths(){return super.templatePaths.set("section","src/html/elements/autonomous/sections/section.html")}constructor(e,t,s,i){super(e),this.modelPropertyName=t,this.dataset.mode="show",this.showElements=new s(this.shadowRoot),this.editElements=new i(this.shadowRoot),this.errorMessages=this.shadowRoot.querySelector("error-messages")}connectedCallback(){this.updateView(),this.showElements.section.addEventListener("click",()=>{this.edit()}),this.showElements.section.addEventListener("animationend",()=>{"edit"===this.mode&&this.focusOnInitialEditSectionElement()}),this.editElements.section.addEventListener("submit",e=>{e.preventDefault(),this.save()})}get mode(){return this.dataset.mode}set mode(e){const t="section_hidden";switch(e){case"hidden":this.dataset.mode="hidden",this.showElements.section.classList.add(t),this.editElements.section.classList.add(t);break;case"show":this.dataset.mode="show",this.showElements.section.classList.remove(t),this.editElements.section.classList.add(t);break;case"edit":this.dataset.mode="edit",this.showElements.section.classList.add(t),this.editElements.section.classList.remove(t);break;default:throw new Error(`'${e}' is not a valid section mode.`)}}get empty(){return"empty"in this.dataset}set empty(e){e?(this.dataset.empty="",this.showElements.section.classList.add("section_empty")):(delete this.dataset.empty,this.showElements.section.classList.remove("section_empty"))}setEmptyVisibility(e){this.empty&&(e?"hidden"===this.mode&&(this.mode="show"):"show"===this.mode&&(this.mode="hidden"))}focusOnInitialEditSectionElement(){te(this.editElements.initiallySelectedElement)}edit(){this.mode="edit",this.dispatchModeChangedEvent(),this.focusOnInitialEditSectionElement()}save(){this.errorMessages.clear(),this.checkForErrors(),this.errorMessages.any?this.errorMessages.focusOnFirstErrorField():(this.updateModel(),this.updateShowModeView(),this.empty&&!J.layoutSettings.emptySectionsVisibility?this.mode="hidden":this.mode="show",this.dispatchModeChangedEvent())}checkForErrors(){throw new Error(`The class '${this.constructor.name}' must implement the checkForErrors() method.`)}updateModel(){throw new Error(`The class '${this.constructor.name}' must implement the updateModel() method.`)}updateEditModeView(){throw new Error(`The class '${this.constructor.name}' must implement the updateEditModeView() method.`)}updateShowModeView(){throw new Error(`The class '${this.constructor.name}' must implement the updateShowModeView() method.`)}updateView(){this.updateEditModeView(),this.updateShowModeView()}dispatchModeChangedEvent(){const e=new CustomEvent("sectionModeChanged",{bubbles:!0,composed:!0});this.dispatchEvent(e)}importFromJson(e){J.creature[this.modelPropertyName].fromJson(e),this.updateView()}exportToJson(){return J.creature[this.modelPropertyName].toJson()}exportToHtml(){return J.creature[this.modelPropertyName].toHtml()}exportToHomebrewery(){return J.creature[this.modelPropertyName].toHomebrewery()}}class Ge{constructor(e){this.section=e.getElementById("show-section")}}class Ue{constructor(e){this.section=e.getElementById("edit-section"),this.saveButton=e.getElementById("save-button")}get initiallySelectedElement(){throw new Error(`The class '${this.constructor.name}' must implement the initiallySelectedElement() getter.`)}submitForm(){this.section.dispatchEvent(new Event("submit"))}}class Ke extends qe{static get elementName(){return"title-section"}static get templatePaths(){return super.templatePaths.set("title-section","src/html/elements/autonomous/sections/title-section.html")}constructor(){super(Ke.templatePaths,"title",Xe,Ye)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.fullName.addEventListener("input",this.onInputCreatureName.bind(this)),this.editElements.shortName.addEventListener("input",this.onInputShortName.bind(this)),this.editElements.properNoun.addEventListener("input",this.onInputProperNoun.bind(this)))}onInputCreatureName(){const e=this.editElements.fullName.value;""!==e&&(J.creature.title.fullName=e,this.dispatchCreatureNameChangedEvent())}onInputShortName(){J.creature.title.shortName=this.editElements.shortName.value,this.dispatchCreatureNameChangedEvent()}onInputProperNoun(){J.creature.title.isProperNoun=this.editElements.properNoun.checked,this.dispatchCreatureNameChangedEvent()}get title(){return this.showElements.title.textContent}dispatchCreatureNameChangedEvent(){const e=J.creature.title,t=new CustomEvent("creatureNameChanged",{bubbles:!0,composed:!0,detail:{creatureName:e.fullName,shortName:e.shortName,isProperNoun:e.isProperNoun}});this.dispatchEvent(t)}checkForErrors(){this.editElements.fullName.value=p(this.editElements.fullName.value.trim()),this.editElements.fullName.validate(this.errorMessages)}updateModel(){const e=J.creature.title;e.fullName=this.editElements.fullName.value,e.shortName=this.editElements.shortName.value,e.isProperNoun=this.editElements.properNoun.checked}updateEditModeView(){const e=J.creature.title;this.editElements.fullName.value=e.fullName,this.editElements.shortName.value=e.shortName,this.editElements.properNoun.checked=e.isProperNoun}updateShowModeView(){this.showElements.title.textContent=J.creature.title.fullName}}class Xe extends Ge{constructor(e){super(e),this.title=e.getElementById("title-text")}}class Ye extends Ue{constructor(e){super(e),this.fullName=e.getElementById("full-name-input"),this.shortName=e.getElementById("short-name-input"),this.properNoun=e.getElementById("proper-noun-input")}get initiallySelectedElement(){return this.fullName}}class Ze extends qe{static get elementName(){return"subtitle-section"}static get templatePaths(){return super.templatePaths.set("subtitle-section","src/html/elements/autonomous/sections/subtitle-section.html")}constructor(){super(Ze.templatePaths,"subtitle",et,tt)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.useCustomText.disableElementsWhenChecked(this.editElements.size,this.editElements.type,this.editElements.tags,this.editElements.alignment),this.editElements.useCustomText.enableElementsWhenChecked(this.editElements.customText),this.isInitialized=!0)}checkForErrors(){this.editElements.tags.value=this.editElements.tags.value.trim(),this.editElements.useCustomText.checked&&this.editElements.customText.validate(this.errorMessages)}updateModel(){const e=J.creature.subtitle;e.size=this.editElements.size.value,e.type=this.editElements.type.value,e.tags=this.editElements.tags.value,e.alignment=this.editElements.alignment.value,e.useCustomText=this.editElements.useCustomText.checked,e.customText=this.editElements.customText.value}updateEditModeView(){const e=J.creature.subtitle;this.editElements.size.value=e.size,this.editElements.type.value=e.type,this.editElements.tags.value=e.tags,this.editElements.alignment.value=e.alignment,this.editElements.useCustomText.checked=e.useCustomText,this.editElements.customText.value=e.customText,this.editElements.useCustomText.onInputCheckbox()}updateShowModeView(){this.showElements.text.textContent=J.creature.subtitle.text}}class et extends Ge{constructor(e){super(e),this.text=e.getElementById("subtitle-text")}}class tt extends Ue{constructor(e){super(e),this.size=e.getElementById("size-input"),this.type=e.getElementById("type-input"),this.tags=e.getElementById("tags-input"),this.alignment=e.getElementById("alignment-input"),this.useCustomText=e.getElementById("use-custom-text-input"),this.customText=e.getElementById("custom-text-input")}get initiallySelectedElement(){return this.size}}class st extends qe{constructor(e,t,s,i){super(e,t,s,i)}}class it extends Ge{constructor(e){super(e),this.heading=e.getElementById("show-section-heading"),this.text=e.getElementById("show-section-text")}}class nt extends Ue{constructor(e){super(e)}}class at extends st{static get elementName(){return"armor-class-section"}static get templatePaths(){return super.templatePaths.set("armor-class-section","src/html/elements/autonomous/sections/armor-class-section.html")}constructor(){super(at.templatePaths,"armorClass",ot,rt)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.useCustomText.disableElementsWhenChecked(this.editElements.armorClass,this.editElements.armorType,this.editElements.hasShield),this.editElements.useCustomText.enableElementsWhenChecked(this.editElements.customText),this.isInitialized=!0)}checkForErrors(){this.editElements.armorType.value=this.editElements.armorType.value.trim(),this.editElements.customText.value=this.editElements.customText.value.trim(),this.editElements.useCustomText.checked?this.editElements.customText.validate(this.errorMessages):this.editElements.armorClass.validate(this.errorMessages)}updateModel(){const e=J.creature.armorClass;e.armorClass=this.editElements.armorClass.valueAsInt,e.armorType=this.editElements.armorType.value,e.hasShield=this.editElements.hasShield.checked,e.useCustomText=this.editElements.useCustomText.checked,e.customText=this.editElements.customText.value,e.htmlCustomText=this.editElements.customText.htmlText}updateEditModeView(){const e=J.creature.armorClass;this.editElements.armorClass.value=e.armorClass,this.editElements.armorType.value=e.armorType,this.editElements.hasShield.checked=e.hasShield,this.editElements.useCustomText.checked=e.useCustomText,this.editElements.customText.value=e.customText,e.useCustomText&&(this.editElements.customText.parse(),e.htmlCustomText=this.editElements.customText.htmlText),this.editElements.useCustomText.onInputCheckbox()}updateShowModeView(){const e=J.creature.armorClass;J.creature.armorClass.useCustomText?this.showElements.text.innerHTMLSanitized=e.htmlCustomText:this.showElements.text.textContent=e.nonCustomText}}class ot extends it{constructor(e){super(e)}}class rt extends nt{constructor(e){super(e),this.armorClass=e.getElementById("armor-class-input"),this.armorType=e.getElementById("armor-type-input"),this.hasShield=e.getElementById("shield-input"),this.useCustomText=e.getElementById("use-custom-text-input"),this.customText=e.getElementById("custom-text-input")}get initiallySelectedElement(){return this.useCustomText.checked?this.customText:this.armorClass}}class lt extends st{static get elementName(){return"hit-points-section"}static get templatePaths(){return super.templatePaths.set("hit-points-section","src/html/elements/autonomous/sections/hit-points-section.html")}constructor(){super(lt.templatePaths,"hitPoints",ht,ct)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.useHitDie.disableElementsWhenChecked(this.editElements.hitPoints),this.editElements.useHitDie.enableElementsWhenChecked(this.editElements.hitDieQuantity,this.editElements.hitDieSize),this.editElements.hitPoints.addEventListener("input",this.onInputHitPoints.bind(this)),this.editElements.useHitDie.addEventListener("input",this.onInputUseHitDie.bind(this)),this.editElements.hitDieQuantity.addEventListener("input",this.onInputHitDieQuantity.bind(this)),this.editElements.hitDieSize.addEventListener("input",this.onInputHitDieSize.bind(this)),this.isInitialized=!0)}onInputHitPoints(){this.updateModelHitPoints()}onInputUseHitDie(){this.updateModelUseHitDie(),this.updateEditModeViewHitPoints()}onInputHitDieQuantity(){this.updateModelHitDieQuantity(),this.updateEditModeViewHitPoints(),this.updateEditModeViewConstitutionHitPoints()}onInputHitDieSize(){this.updateModelHitDieSize(),this.updateEditModeViewHitPoints()}checkForErrors(){J.creature.hitPoints.useHitDie?this.editElements.hitDieQuantity.validate(this.errorMessages):this.editElements.hitPoints.validate(this.errorMessages)}updateModel(){this.updateModelHitPoints(),this.updateModelUseHitDie(),this.updateModelHitDieQuantity(),this.updateModelHitDieSize()}updateModelHitPoints(){const e=this.editElements.hitPoints.valueAsInt;null!==e&&(J.creature.hitPoints.hitPoints=e)}updateModelUseHitDie(){J.creature.hitPoints.useHitDie=this.editElements.useHitDie.checked}updateModelHitDieQuantity(){const e=this.editElements.hitDieQuantity.valueAsInt;null!==e&&(J.creature.hitPoints.hitDieQuantity=e)}updateModelHitDieSize(){const e=this.editElements.hitDieSize.valueAsInt;null!==e&&(J.creature.hitPoints.hitDieSize=e)}updateEditModeView(){const e=J.creature.hitPoints;this.editElements.hitPoints.value=e.hitPoints,this.editElements.useHitDie.checked=e.useHitDie,this.editElements.hitDieQuantity.value=e.hitDieQuantity,this.editElements.hitDieSize.value=e.hitDieSize,this.editElements.constitutionHitPoints.textContent=e.constitutionHitPointsText}updateEditModeViewHitPoints(){this.editElements.hitPoints.value=J.creature.hitPoints.hitPoints}updateEditModeViewConstitutionHitPoints(){this.editElements.constitutionHitPoints.textContent=J.creature.hitPoints.constitutionHitPointsText}updateShowModeView(){this.showElements.text.textContent=J.creature.hitPoints.text}}class ht extends it{constructor(e){super(e)}}class ct extends nt{constructor(e){super(e),this.hitPoints=e.getElementById("hit-points-input"),this.useHitDie=e.getElementById("use-hit-die-input"),this.hitDieQuantity=e.getElementById("hit-die-quantity-input"),this.hitDieSize=e.getElementById("hit-die-size-input"),this.constitutionHitPoints=e.getElementById("constitution-hit-points-value-label")}get initiallySelectedElement(){return this.useHitDie.checked?this.hitDieQuantity:this.hitPoints}}class dt extends st{static get elementName(){return"speed-section"}static get templatePaths(){return super.templatePaths.set("speed-section","src/html/elements/autonomous/sections/speed-section.html")}constructor(){super(dt.templatePaths,"speed",ut,mt)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.useCustomText.disableElementsWhenChecked(this.editElements.walk,this.editElements.burrow,this.editElements.climb,this.editElements.fly,this.editElements.hover,this.editElements.swim),this.editElements.useCustomText.enableElementsWhenChecked(this.editElements.customText),this.isInitialized=!0)}checkForErrors(){this.editElements.customText.value=this.editElements.customText.value.trim(),this.editElements.useCustomText.checked&&this.editElements.customText.validate(this.errorMessages)}updateModel(){const e=J.creature.speed;e.walk=this.editElements.walk.valueAsInt,e.burrow=this.editElements.burrow.valueAsInt,e.climb=this.editElements.climb.valueAsInt,e.fly=this.editElements.fly.valueAsInt,e.hover=this.editElements.hover.checked,e.swim=this.editElements.swim.valueAsInt,e.useCustomText=this.editElements.useCustomText.checked,e.customText=this.editElements.customText.value,e.htmlCustomText=this.editElements.customText.htmlText}updateEditModeView(){const e=J.creature.speed;this.editElements.walk.value=e.walk,this.editElements.burrow.value=e.burrow,this.editElements.climb.value=e.climb,this.editElements.fly.value=e.fly,this.editElements.hover.checked=e.hover,this.editElements.swim.value=e.swim,this.editElements.useCustomText.checked=e.useCustomText,this.editElements.customText.value=e.customText,e.useCustomText&&(this.editElements.customText.parse(),e.htmlCustomText=this.editElements.customText.htmlText),this.editElements.useCustomText.onInputCheckbox()}updateShowModeView(){const e=J.creature.speed;e.useCustomText?this.showElements.text.innerHTMLSanitized=e.htmlCustomText:this.showElements.text.textContent=e.nonCustomText}}class ut extends it{constructor(e){super(e)}}class mt extends nt{constructor(e){super(e),this.walk=e.getElementById("walk-input"),this.burrow=e.getElementById("burrow-input"),this.climb=e.getElementById("climb-input"),this.fly=e.getElementById("fly-input"),this.hover=e.getElementById("hover-input"),this.swim=e.getElementById("swim-input"),this.useCustomText=e.getElementById("use-custom-text-input"),this.customText=e.getElementById("custom-text-input")}get initiallySelectedElement(){return this.useCustomText.checked?this.customText:this.walk}}class pt extends qe{static get elementName(){return"ability-scores-section"}static get templatePaths(){return super.templatePaths.set("ability-scores-section","src/html/elements/autonomous/sections/ability-scores-section.html")}constructor(){super(pt.templatePaths,"abilities",gt,bt);for(const e of J.creature.abilities.keys)this.editElements.score[e].addEventListener("input",this.onInputAbilityScore.bind(this,e))}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.isInitialized=!0)}onInputAbilityScore(e){this.updateModelAbilityScore(e),this.updateEditModeViewAbilityModifier(e),this.updateShowModeViewAbility(e)}checkForErrors(){for(const e of J.creature.abilities.keys)this.editElements.score[e].validate(this.errorMessages)}updateModel(){for(const e of J.creature.abilities.keys)this.updateModelAbilityScore(e)}updateModelAbilityScore(e){const t=this.editElements.score[e].valueAsInt;null!==t&&(J.creature.abilities.abilities[e].score=t,this.dispatchAbilityScoreChangedEvent(e))}dispatchAbilityScoreChangedEvent(e){const t=new CustomEvent("abilityScoreChanged",{bubbles:!0,composed:!0,detail:{abilityName:e}});this.dispatchEvent(t)}updateEditModeView(){for(const e of J.creature.abilities.keys)this.updateEditModeViewAbilityScore(e),this.updateEditModeViewAbilityModifier(e)}updateEditModeViewAbilityScore(e){this.editElements.score[e].value=J.creature.abilities.abilities[e].score}updateEditModeViewAbilityModifier(e){this.editElements.modifier[e].textContent=J.creature.abilities.abilities[e].formattedModifier}updateShowModeView(){for(const e of J.creature.abilities.keys)this.updateShowModeViewAbility(e)}updateShowModeViewAbility(e){const t=J.creature.abilities.abilities[e];this.showElements.score[e].textContent=t.score,this.showElements.modifier[e].textContent=t.formattedModifier}importFromJson(e){J.creature.abilities.fromJson(e),this.updateView()}}class gt extends Ge{constructor(e){super(e),this.score={},this.modifier={};for(const t of J.creature.abilities.keys)this.score[t]=e.getElementById(`${t}-score-show`),this.modifier[t]=e.getElementById(`${t}-modifier-show`)}}class bt extends Ue{constructor(e){super(e),this.score={},this.modifier={};for(const t of J.creature.abilities.keys)this.score[t]=e.getElementById(`${t}-score-edit`),this.modifier[t]=e.getElementById(`${t}-modifier-edit`)}get initiallySelectedElement(){return this.score.strength}}class Et extends st{static get elementName(){return"saving-throws-section"}static get templatePaths(){return super.templatePaths.set("saving-throws-section","src/html/elements/autonomous/sections/saving-throws-section.html")}constructor(){super(Et.templatePaths,"savingThrows",ft,yt),this.empty=!0}connectedCallback(){if(this.isConnected&&!this.isInitialized){super.connectedCallback();for(const e of J.creature.savingThrows.keys)this.initializeSavingThrowElements(e);this.isInitialized=!0}}initializeSavingThrowElements(e){const t=this.editElements.savingThrow[e];t.enable.enableElementsWhenChecked(t.label,t.modifier,t.proficient,t.override),t.enable.addEventListener("input",this.onInputSavingThrowEnabled.bind(this,e)),t.proficient.addEventListener("input",this.onInputSavingThrowProficiency.bind(this,e)),t.override.addEventListener("input",this.onInputSavingThrowOverride.bind(this,e))}onInputSavingThrowEnabled(e){const t=this.editElements.savingThrow[e];t.enable.checked?se(t.proficient,!0):(se(t.proficient,!1),se(t.override,"")),this.updateModelSavingThrowEnabled(e),this.updateEditModeViewSavingThrowModifier(e),this.updateShowModeView()}onInputSavingThrowProficiency(e){this.updateModelSavingThrowProficiency(e),this.updateEditModeViewSavingThrowModifier(e),this.updateShowModeView()}onInputSavingThrowOverride(e){this.updateModelSavingThrowOverride(e),this.updateEditModeViewSavingThrowModifier(e),this.updateShowModeView()}checkForErrors(){}updateModel(){for(const e of J.creature.savingThrows.keys)this.updateModelSavingThrowEnabled(e),this.updateModelSavingThrowProficiency(e),this.updateModelSavingThrowOverride(e)}updateModelSavingThrowEnabled(e){J.creature.savingThrows.savingThrows[e].isEnabled=this.editElements.savingThrow[e].enable.checked}updateModelSavingThrowProficiency(e){J.creature.savingThrows.savingThrows[e].isProficient=this.editElements.savingThrow[e].proficient.checked}updateModelSavingThrowOverride(e){J.creature.savingThrows.savingThrows[e].override=this.editElements.savingThrow[e].override.valueAsInt}updateViewOnAttributeChange(e){if(e)this.updateEditModeViewSavingThrowModifier(e);else for(const e of J.creature.savingThrows.keys)this.updateEditModeViewSavingThrowModifier(e);this.updateShowModeView()}updateEditModeView(){for(const e of J.creature.savingThrows.keys)this.updateEditModeViewSavingThrow(e),this.editElements.savingThrow[e].enable.onInputCheckbox()}updateEditModeViewSavingThrow(e){const t=this.editElements.savingThrow[e],s=J.creature.savingThrows;t.enable.checked=s.savingThrows[e].isEnabled,t.modifier.textContent=s.savingThrows[e].formattedModifier,t.proficient.checked=s.savingThrows[e].isProficient,t.override.value=s.savingThrows[e].override}updateEditModeViewSavingThrowModifier(e){this.editElements.savingThrow[e].modifier.textContent=J.creature.savingThrows.savingThrows[e].formattedModifier}updateShowModeView(){const e=J.creature.savingThrows.text;this.empty=""===e,this.showElements.text.textContent=e}}class ft extends it{constructor(e){super(e)}}class yt extends nt{constructor(e){super(e),this.savingThrow={};for(const t of J.creature.savingThrows.keys)this.savingThrow[t]={enable:e.getElementById(`${t}-enable`),label:e.getElementById(`${t}-label`),modifier:e.getElementById(`${t}-saving-throw-modifier`),proficient:e.getElementById(`${t}-proficient`),override:e.getElementById(`${t}-override`)}}get initiallySelectedElement(){return this.savingThrow.strength.enable}}class vt extends st{static get elementName(){return"skills-section"}static get templatePaths(){return super.templatePaths.set("skills-section","src/html/elements/autonomous/sections/skills-section.html")}constructor(){super(vt.templatePaths,"skills",xt,wt),this.empty=!0}connectedCallback(){if(this.isConnected&&!this.isInitialized){super.connectedCallback();for(const e of J.creature.skills.keys)this.initializeSkillElements(e);this.isInitialized=!0}}initializeSkillElements(e){const t=this.editElements.skill[e];t.enable.enableElementsWhenChecked(t.label,t.modifier,t.proficient,t.override),t.enable.addEventListener("input",this.onInputSkillEnabled.bind(this,e)),t.proficient.addEventListener("input",this.onInputSkillProficiency.bind(this,e)),t.override.addEventListener("input",this.onInputSkillOverride.bind(this,e))}onInputSkillEnabled(e){const t=this.editElements.skill[e];t.enable.checked?se(t.proficient,!0):(se(t.proficient,!1),se(t.override,"")),this.updateModelSkillEnabled(e),this.updateEditModeViewSkillModifier(e),this.updateShowModeView(),this.dispatchSkillChangedEvent(e)}onInputSkillProficiency(e){this.updateModelSkillProficiency(e),this.updateEditModeViewSkillModifier(e),this.updateShowModeView(),this.dispatchSkillChangedEvent(e)}onInputSkillOverride(e){this.updateModelSkillOverride(e),this.updateEditModeViewSkillModifier(e),this.updateShowModeView(),this.dispatchSkillChangedEvent(e)}dispatchSkillChangedEvent(e){const t=new CustomEvent("skillChanged",{bubbles:!0,composed:!0,detail:{skillName:e}});this.dispatchEvent(t)}checkForErrors(){}updateModel(){for(const e of J.creature.skills.keys)this.updateModelSkillEnabled(e),this.updateModelSkillProficiency(e),this.updateModelSkillOverride(e)}updateModelSkillEnabled(e){J.creature.skills.skills[e].isEnabled=this.editElements.skill[e].enable.checked}updateModelSkillProficiency(e){J.creature.skills.skills[e].isProficient=this.editElements.skill[e].proficient.checked}updateModelSkillOverride(e){J.creature.skills.skills[e].override=this.editElements.skill[e].override.valueAsInt}updateViewOnAttributeChange(e){const t=J.creature.skills;if(e)for(const[s,i]of t.entries)J.creature.abilities.abilities[e]===i.ability&&this.updateEditModeViewSkillModifier(s);else for(const e of t.keys)this.updateEditModeViewSkillModifier(e);this.updateShowModeView()}updateEditModeView(){for(const e of J.creature.skills.keys)this.updateEditModeViewSkill(e),this.editElements.skill[e].enable.onInputCheckbox()}updateEditModeViewSkill(e){const t=this.editElements.skill[e],s=J.creature.skills;t.enable.checked=s.skills[e].isEnabled,t.modifier.textContent=s.skills[e].formattedModifier,t.proficient.checked=s.skills[e].isProficient,t.override.value=s.skills[e].override}updateEditModeViewSkillModifier(e){this.editElements.skill[e].modifier.textContent=J.creature.skills.skills[e].formattedModifier}updateShowModeView(){const e=J.creature.skills.text;this.empty=""===e,this.showElements.text.textContent=e}}class xt extends it{constructor(e){super(e)}}class wt extends nt{constructor(e){super(e),this.skill={};for(const t of J.creature.skills.keys)this.skill[t]={enable:e.getElementById(`${t}-enable`),label:e.getElementById(`${t}-label`),modifier:e.getElementById(`${t}-skill-modifier`),proficient:e.getElementById(`${t}-proficient`),override:e.getElementById(`${t}-override`)}}get initiallySelectedElement(){return this.skill.acrobatics.enable}}class Ct extends st{static get templatePaths(){return super.templatePaths.set("property-list-section","src/html/elements/autonomous/sections/property-list-section.html")}constructor(e,t){super(e,t,kt,Tt);const s=J.creature[this.modelPropertyName];this.showElements.heading.textContent=s.headingName,this.editElements.label.textContent=`${s.headingName}:`}connectedCallback(){super.connectedCallback(),this.editElements.input.addEventListener("keydown",this.onEnterKeyDownOnInputField.bind(this)),this.editElements.addButton.addEventListener("click",this.onClickAddButton.bind(this)),this.addEventListener("propertyListItemRemoved",this.onPropertyListItemRemoved.bind(this))}onEnterKeyDownOnInputField(e){"Enter"===e.key&&(e.preventDefault(),this.addItemFromInput())}onClickAddButton(){this.addItemFromInput()}onPropertyListItemRemoved(e){const t=e.detail.itemText;this.editElements.dataList.setOptionEnabled(t,!0)}addItemFromInput(){const e=J.creature[this.modelPropertyName],t=this.editElements.input.value.trim();this.editElements.input.value=t,this.errorMessages.clear(),""===t?this.errorMessages.add(this.editElements.input,`Cannot add a blank ${e.singleName}.`):this.editElements.propertyList.contains(t)&&this.errorMessages.add(this.editElements.input,`Cannot add a duplicate ${e.singleName}.`),this.errorMessages.any?this.errorMessages.focusOnFirstErrorField():(this.addItem(t),this.editElements.input.value="",this.editElements.input.select())}addItem(e){this.editElements.propertyList.addItem(e),this.editElements.dataList.setOptionEnabled(e,!1)}checkForErrors(){const e=this.editElements.input;if(""!==e.value){const t=`Cannot save while the ${J.creature[this.modelPropertyName].singleName} field contains text.\nClear or add the field, then try again.`;this.errorMessages.add(e,t)}}updateModel(){J.creature[this.modelPropertyName].items=this.editElements.propertyList.itemsAsText}updateEditModeView(){this.editElements.propertyList.items=J.creature[this.modelPropertyName].items}updateShowModeView(){const e=J.creature[this.modelPropertyName].text;this.empty=""===e,this.showElements.text.textContent=e}}class kt extends it{constructor(e){super(e)}}class Tt extends nt{constructor(e){super(e),this.label=e.getElementById("property-list-label"),this.input=e.getElementById("property-list-input"),this.addButton=e.getElementById("property-list-add-button"),this.propertyList=e.getElementById("property-list"),this.dataList=e.getElementById("property-list-datalist")}get initiallySelectedElement(){return this.input}}class St extends Ct{static get elementName(){return"damage-vulnerabilities-section"}static get templatePaths(){return super.templatePaths.set("damage-vulnerabilities-section","src/html/elements/autonomous/sections/damage-vulnerabilities-section.html")}constructor(){super(St.templatePaths,"damageVulnerabilities"),this.empty=!0}}class It extends Ct{static get elementName(){return"damage-resistances-section"}static get templatePaths(){return super.templatePaths.set("damage-resistances-section","src/html/elements/autonomous/sections/damage-resistances-section.html")}constructor(){super(It.templatePaths,"damageResistances"),this.empty=!0}}class Pt extends Ct{static get elementName(){return"damage-immunities-section"}static get templatePaths(){return super.templatePaths.set("damage-immunities-section","src/html/elements/autonomous/sections/damage-immunities-section.html")}constructor(){super(Pt.templatePaths,"damageImmunities"),this.empty=!0}}class Mt extends Ct{static get elementName(){return"condition-immunities-section"}static get templatePaths(){return super.templatePaths.set("condition-immunities-section","src/html/elements/autonomous/sections/condition-immunities-section.html")}constructor(){super(Mt.templatePaths,"conditionImmunities"),this.empty=!0}}class Bt extends st{static get elementName(){return"senses-section"}static get templatePaths(){return super.templatePaths.set("senses-section","src/html/elements/autonomous/sections/senses-section.html")}constructor(){super(Bt.templatePaths,"senses",Dt,Nt)}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.useCustomText.disableElementsWhenChecked(this.editElements.blindsight,this.editElements.darkvision,this.editElements.tremorsense,this.editElements.truesight),this.editElements.useCustomText.enableElementsWhenChecked(this.editElements.customText))}checkForErrors(){this.editElements.customText.value=this.editElements.customText.value.trim(),this.editElements.useCustomText.checked&&this.editElements.customText.validate(this.errorMessages)}updateModel(){const e=J.creature.senses;e.blindsight=this.editElements.blindsight.valueAsInt,e.darkvision=this.editElements.darkvision.valueAsInt,e.tremorsense=this.editElements.tremorsense.valueAsInt,e.truesight=this.editElements.truesight.valueAsInt,e.useCustomText=this.editElements.useCustomText.checked,e.customText=this.editElements.customText.value,e.htmlCustomText=this.editElements.customText.htmlText}updateViewOnAttributeChange(){this.updateEditModeViewPassivePerception(),this.updateShowModeView()}updateEditModeView(){const e=J.creature.senses;this.editElements.blindsight.value=e.blindsight,this.editElements.darkvision.value=e.darkvision,this.editElements.tremorsense.value=e.tremorsense,this.editElements.truesight.value=e.truesight,this.editElements.useCustomText.checked=e.useCustomText,this.editElements.customText.value=e.customText,e.useCustomText&&(this.editElements.customText.parse(),e.htmlCustomText=this.editElements.customText.htmlText),this.updateEditModeViewPassivePerception(),this.editElements.useCustomText.onInputCheckbox()}updateEditModeViewPassivePerception(){this.editElements.passivePerception.textContent=J.creature.senses.passivePerception}updateShowModeView(){const e=J.creature.senses;e.useCustomText?this.showElements.text.innerHTMLSanitized=e.htmlCustomText:this.showElements.text.textContent=e.nonCustomText}}class Dt extends it{constructor(e){super(e)}}class Nt extends nt{constructor(e){super(e),this.blindsight=e.getElementById("blindsight-input"),this.darkvision=e.getElementById("darkvision-input"),this.tremorsense=e.getElementById("tremorsense-input"),this.truesight=e.getElementById("truesight-input"),this.passivePerception=e.getElementById("passive-perception-value"),this.useCustomText=e.getElementById("use-custom-text-input"),this.customText=e.getElementById("custom-text-input")}get initiallySelectedElement(){return this.useCustomText.checked?this.customText:this.blindsight}}class At extends Ct{static get elementName(){return"languages-section"}static get templatePaths(){return super.templatePaths.set("languages-section","src/html/elements/autonomous/sections/languages-section.html")}constructor(){super(At.templatePaths,"languages")}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.isInitialized=!0)}}var Rt={0:10,.125:25,.25:50,.5:100,1:200,2:450,3:700,4:1100,5:1800,6:2300,7:2900,8:3900,9:5e3,10:5900,11:7200,12:8400,13:1e4,14:11500,15:13e3,16:15e3,17:18e3,18:2e4,19:22e3,20:25e3,21:33e3,22:41e3,23:5e4,24:62e3,25:75e3,26:9e4,27:105e3,28:12e4,29:135e3,30:155e3},Ht={0:2,.125:2,.25:2,.5:2,1:2,2:2,3:2,4:2,5:3,6:3,7:3,8:3,9:4,10:4,11:4,12:4,13:5,14:5,15:5,16:5,17:6,18:6,19:6,20:6,21:7,22:7,23:7,24:7,25:8,26:8,27:8,28:8,29:9,30:9};class Lt extends st{static get elementName(){return"challenge-rating-section"}static get templatePaths(){return super.templatePaths.set("challenge-rating-section","src/html/elements/autonomous/sections/challenge-rating-section.html")}constructor(){super(Lt.templatePaths,"challengeRating",zt,$t),this.editElements.challengeRating.addEventListener("input",this.onInputChallengeRating.bind(this)),this.editElements.experiencePoints.addEventListener("input",this.onInputExperiencePoints.bind(this)),this.editElements.proficiencyBonus.addEventListener("input",this.onInputProficiencyBonus.bind(this))}onInputChallengeRating(){const e=this.editElements.challengeRating.valueAsFloat,t=Rt[e],s=Ht[e];this.editElements.experiencePoints.value=t,this.editElements.proficiencyBonus.value=s,this.updateModel()}onInputExperiencePoints(){this.updateModel()}onInputProficiencyBonus(){this.updateModel()}checkForErrors(){this.editElements.experiencePoints.validate(this.errorMessages),this.editElements.proficiencyBonus.validate(this.errorMessages)}updateModel(){const e=J.creature.challengeRating,t=this.editElements.challengeRating.valueAsFloat,s=this.editElements.experiencePoints.valueAsInt,i=this.editElements.proficiencyBonus.valueAsInt;e.challengeRating=t,null!==s&&(e.experiencePoints=s),null!=i&&(e.proficiencyBonus=i,this.dispatchProficiencyBonusChangedEvent())}updateEditModeView(){const e=J.creature.challengeRating;this.editElements.challengeRating.value=e.challengeRating,this.editElements.experiencePoints.value=e.experiencePoints,this.editElements.proficiencyBonus.value=e.proficiencyBonus}updateShowModeView(){this.showElements.text.textContent=J.creature.challengeRating.text}dispatchProficiencyBonusChangedEvent(){const e=new CustomEvent("proficiencyBonusChanged",{bubbles:!0,composed:!0,detail:{}});this.dispatchEvent(e)}}class zt extends it{constructor(e){super(e)}}class $t extends nt{constructor(e){super(e),this.challengeRating=e.getElementById("challenge-rating-input"),this.experiencePoints=e.getElementById("experience-points-input"),this.proficiencyBonus=e.getElementById("proficiency-bonus-input")}get initiallySelectedElement(){return this.challengeRating}}class _t extends qe{static get templatePaths(){return super.templatePaths.set("block-list-section","src/html/elements/autonomous/sections/block-list-section.html")}constructor(e,t,s=Vt,i=Ft){super(e,t,s,i),this.heading=this.shadowRoot.getElementById("heading")}connectedCallback(){super.connectedCallback(),this.editElements.editableBlockList.blockType=J.creature[this.modelPropertyName].singleName,this.reparse(),this.editElements.addButton.addEventListener("click",this.onClickAddTextBlockButton.bind(this))}onClickAddTextBlockButton(){this.addBlock()}addBlock(e="",t=""){this.editElements.editableBlockList.addBlock(e,t)}get mode(){return super.mode}set mode(e){super.mode=e;switch(e){case"hidden":this.heading.classList.add("block-list-section__heading_hidden");break;case"show":case"edit":this.heading.classList.remove("block-list-section__heading_hidden")}}get empty(){return super.empty}set empty(e){super.empty=e;e?this.showElements.emptyLabel.classList.remove("block-list-section__empty-label_hidden"):this.showElements.emptyLabel.classList.add("block-list-section__empty-label_hidden")}checkForErrors(){this.editElements.editableBlockList.validate(this.errorMessages)}updateModel(){J.creature[this.modelPropertyName].blocks=this.editElements.editableBlockList.toModel()}updateEditModeView(){const e=J.creature[this.modelPropertyName].blocks;this.editElements.editableBlockList.clear();for(const t of e)this.editElements.editableBlockList.addBlock(t.name,t.text)}updateShowModeView(){const e=J.creature[this.modelPropertyName].blocks;this.showElements.displayBlockList.clear();for(const t of e)this.showElements.displayBlockList.addBlock(t.name,t.htmlText);this.empty=e.length<=0}reparse(){this.editElements.editableBlockList.parse(),this.updateModel();for(const[e,t]of J.creature[this.modelPropertyName].blocks.entries()){const s=this.editElements.editableBlockList.blocks[e];if(s.previewName=t.name,s.previewText=t.htmlText,"show"===this.mode){this.showElements.displayBlockList.blocks[e].text=t.htmlText}}}importFromJson(e){super.importFromJson(e),this.reparse()}}class Vt extends Ge{constructor(e){super(e),this.emptyLabel=e.getElementById("empty-label"),this.displayBlockList=e.getElementById("display-block-list")}}class Ft extends Ue{constructor(e){super(e),this.editableBlockList=e.getElementById("editable-block-list"),this.addButton=e.getElementById("add-button")}get initiallySelectedElement(){return this.editableBlockList.blocks.length>0?this.editableBlockList.blocks[0].nameInput:this.addButton}}class Ot extends _t{static get elementName(){return"special-traits-section"}static get templatePaths(){return super.templatePaths.set("special-traits-section","src/html/elements/autonomous/sections/special-traits-section.html")}constructor(){super(Ot.templatePaths,"specialTraits"),this.empty=!0}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.isInitialized=!0)}}class Jt extends _t{static get elementName(){return"actions-section"}static get templatePaths(){return super.templatePaths.set("actions-section","src/html/elements/autonomous/sections/actions-section.html")}constructor(){super(Jt.templatePaths,"actions",jt,Qt),this.empty=!0}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.editElements.generateAttackButton.addEventListener("click",this.onClickGenerateAttackButton.bind(this)),this.addEventListener("generateAttack",this.onGenerateAttackEvent.bind(this)),this.isInitialized=!0)}onClickGenerateAttackButton(){this.editElements.generateAttackDialog.launch()}onGenerateAttackEvent(e){this.addBlock(e.detail.name,e.detail.text),this.reparse()}reparse(){super.reparse(),this.editElements.generateAttackDialog.update()}}class jt extends Vt{constructor(e){super(e)}}class Qt extends Ft{constructor(e){super(e),this.generateAttackButton=e.getElementById("generate-attack-button"),this.generateAttackDialog=e.getElementById("generate-attack-dialog")}}class Wt extends _t{static get elementName(){return"reactions-section"}static get templatePaths(){return super.templatePaths.set("reactions-section","src/html/elements/autonomous/sections/reactions-section.html")}constructor(){super(Wt.templatePaths,"reactions"),this.empty=!0}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.isInitialized=!0)}}class qt extends _t{static get elementName(){return"legendary-actions-section"}static get templatePaths(){return super.templatePaths.set("legendary-actions-section","src/html/elements/autonomous/sections/legendary-actions-section.html")}constructor(){super(qt.templatePaths,"legendaryActions",Gt,Ut),this.empty=!0}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.showElements.displayBlockList.disableBlockNameItalics=!0,this.editElements.editableBlockList.disableBlockNameItalics=!0,this.isInitialized=!0)}get empty(){return super.empty}set empty(e){super.empty=e;e?this.showElements.description.classList.add("legendary-actions-show-section__text_hidden"):this.showElements.description.classList.remove("legendary-actions-show-section__text_hidden")}checkForErrors(){super.checkForErrors(),this.editElements.description.validate(this.errorMessages)}updateModel(){super.updateModel();const e=J.creature.legendaryActions;e.description=this.editElements.description.value,e.homebreweryDescription=this.editElements.description.homebreweryText,e.htmlDescription=this.editElements.description.htmlText}updateEditModeView(){super.updateEditModeView(),this.editElements.description.value=J.creature.legendaryActions.description}updateShowModeView(){super.updateShowModeView(),this.showElements.description.innerHTMLSanitized=J.creature.legendaryActions.htmlDescription}reparse(){this.editElements.description.parse(),super.reparse(),"show"===this.mode&&(this.showElements.description.innerHTMLSanitized=J.creature.legendaryActions.htmlDescription)}}class Gt extends Vt{constructor(e){super(e),this.description=e.getElementById("description-show")}}class Ut extends Ft{constructor(e){super(e),this.description=e.getElementById("description-edit")}}function Kt(e){const t=function(e){const t=document.createElement("iframe");return t.addEventListener("load",Xt),t.style.position="fixed",t.style.right="0",t.style.bottom="0",t.style.width="0",t.style.height="0",t.style.border="0",t.srcdoc=e,t}(e);document.body.appendChild(t)}function Xt(){this.contentWindow.__container__=this,this.contentWindow.addEventListener("beforeunload",Yt),this.contentWindow.addEventListener("afterprint",Yt),this.contentWindow.focus(),this.contentWindow.print()}function Yt(){document.body.removeChild(this.__container__)}class Zt extends xe{static get elementName(){return"stat-block-menu"}static get templatePaths(){return super.templatePaths.set("stat-block-menu","src/html/elements/autonomous/containers/stat-block-menu.html")}constructor(e=null){super(Zt.templatePaths,e),this.oneColumnButton=this.shadowRoot.getElementById("one-column-label"),this.twoColumnButton=this.shadowRoot.getElementById("two-column-label"),this.showEmptySectionsButton=this.shadowRoot.getElementById("show-empty-sections-label"),this.hideEmptySectionsButton=this.shadowRoot.getElementById("hide-empty-sections-label"),this.editAllSectionsButton=this.shadowRoot.getElementById("edit-all-sections-button"),this.saveAllSectionsButton=this.shadowRoot.getElementById("save-all-sections-button"),this.exportJsonButton=this.shadowRoot.getElementById("export-json-button"),this.exportHtmlButton=this.shadowRoot.getElementById("export-html-button"),this.exportHomebreweryButton=this.shadowRoot.getElementById("export-homebrewery-button"),this.importJsonButton=this.shadowRoot.getElementById("import-json-button"),this.printButton=this.shadowRoot.getElementById("print-button"),this.githubButton=this.shadowRoot.getElementById("github-button")}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.oneColumnButton.addEventListener("click",this.onClickOneColumnButton.bind(this)),this.twoColumnButton.addEventListener("click",this.onClickTwoColumnButton.bind(this)),this.showEmptySectionsButton.addEventListener("click",this.onClickShowEmptySectionsButton.bind(this)),this.hideEmptySectionsButton.addEventListener("click",this.onClickHideEmptySectionsButton.bind(this)),this.editAllSectionsButton.addEventListener("click",this.onClickEditAllSectionsButton.bind(this)),this.saveAllSectionsButton.addEventListener("click",this.onClickSaveAllSectionsButton.bind(this)),this.exportJsonButton.addEventListener("click",this.onClickExportJsonButton.bind(this)),this.exportHtmlButton.addEventListener("click",this.onClickExportHtmlButton.bind(this)),this.exportHomebreweryButton.addEventListener("click",this.onClickExportHomebreweryButton.bind(this)),this.importJsonButton.addEventListener("click",this.onClickImportJsonButton.bind(this)),this.printButton.addEventListener("click",this.onClickPrintButton.bind(this)),this.githubButton.addEventListener("click",this.onClickGithubButton.bind(this)),this.isInitialized=!0)}onClickOneColumnButton(){this.dispatchMenuEvent("numberOfColumnsChanged",{columns:1})}onClickTwoColumnButton(){this.dispatchMenuEvent("numberOfColumnsChanged",{columns:2})}onClickShowEmptySectionsButton(){this.dispatchMenuEvent("emptySectionsVisibilityChanged",{visibility:!0})}onClickHideEmptySectionsButton(){this.dispatchMenuEvent("emptySectionsVisibilityChanged",{visibility:!1})}onClickEditAllSectionsButton(){this.dispatchMenuEvent("allSectionsAction",{action:"edit"})}onClickSaveAllSectionsButton(){this.dispatchMenuEvent("allSectionsAction",{action:"save"})}onClickImportJsonButton(){this.dispatchMenuEvent("importAction",{format:"json"})}onClickExportJsonButton(){this.dispatchMenuEvent("exportAction",{format:"json"})}onClickExportHtmlButton(){this.dispatchMenuEvent("exportAction",{format:"html"})}onClickExportHomebreweryButton(){this.dispatchMenuEvent("exportAction",{format:"homebrewery"})}onClickPrintButton(){this.dispatchMenuEvent("printAction")}onClickGithubButton(){window.open("https://github.com/Frumple/statblock5e-creator")}dispatchMenuEvent(e,t=null){const s=new CustomEvent(e,{bubbles:!0,composed:!0,detail:t});this.dispatchEvent(s)}updateControls(){const e=J.layoutSettings;1===e.columns?this.oneColumnButton.click():2===e.columns&&this.twoColumnButton.click(),e.emptySectionsVisibility?this.showEmptySectionsButton.click():this.hideEmptySectionsButton.click()}}class es extends xe{static get elementName(){return"stat-block-sidebar"}static get templatePaths(){return super.templatePaths.set("stat-block-sidebar","src/html/elements/autonomous/containers/stat-block-sidebar.html")}constructor(e=null){super(es.templatePaths,e),this.sidebar=this.shadowRoot.getElementById("stat-block-sidebar"),this.autoHeightModeButton=this.shadowRoot.getElementById("auto-height-mode-label"),this.manualHeightModeButton=this.shadowRoot.getElementById("manual-height-mode-label"),this.manualHeightSliderContainer=this.shadowRoot.getElementById("slider-container"),this.manualHeightSlider=this.shadowRoot.getElementById("slider")}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.autoHeightModeButton.addEventListener("click",this.onClickAutoHeightModeButton.bind(this)),this.manualHeightModeButton.addEventListener("click",this.onClickManualHeightModeButton.bind(this)),this.manualHeightSlider.addEventListener("input",this.onInputSlider.bind(this)),this.isInitialized=!0)}onClickAutoHeightModeButton(){this.heightMode="auto",this.dispatchHeightChangedEvent("auto")}onClickManualHeightModeButton(){this.heightMode="manual",this.dispatchHeightChangedEvent("manual")}onInputSlider(){this.dispatchHeightChangedEvent("manual")}dispatchHeightChangedEvent(e){const t=ae(this.manualHeightSlider.value),s=new CustomEvent("twoColumnHeightChanged",{bubbles:!0,composed:!0,detail:{mode:e,height:t}});this.dispatchEvent(s)}get visible(){return"visible"in this.dataset}set visible(e){e?(this.dataset.visible="",this.sidebar.classList.remove("stat-block-sidebar_hidden")):(delete this.dataset.visible,this.sidebar.classList.add("stat-block-sidebar_hidden"))}get heightMode(){return this.dataset.heightMode}set heightMode(e){"auto"===e?(this.dataset.heightMode="auto",this.manualHeightSliderContainer.classList.add("stat-block-sidebar__slider-container_hidden")):"manual"===e&&(this.dataset.heightMode="manual",this.manualHeightSliderContainer.classList.remove("stat-block-sidebar__slider-container_hidden"))}updateControls(){const e=J.layoutSettings;this.manualHeightSlider.value=e.twoColumnHeight,"auto"===e.twoColumnMode?this.autoHeightModeButton.click():"manual"===e.twoColumnMode&&this.manualHeightModeButton.click()}}class ts extends xe{constructor(e){super(e),this.sections=new Map}setEmptyVisibility(e){for(const t of this.sections.values())t.setEmptyVisibility(e)}edit(){for(const e of Array.from(this.sections.values()).reverse())e.edit()}save(){for(const e of Array.from(this.sections.values()).reverse())e.save()}importFromJson(e){for(const t of this.sections.values())t.importFromJson(e[t.modelPropertyName])}exportToJson(){const e=Array.from(this.sections.entries()).map(([e,t])=>[e,t.exportToJson()]);return Object.fromEntries(e)}exportToHtml(){const e=document.createDocumentFragment();for(const t of this.sections.values())t.empty||e.appendChild(t.exportToHtml());return e}exportToHomebrewery(){return Array.from(this.sections.values()).filter(e=>!e.empty).map(e=>e.exportToHomebrewery()).join("\n")}}class ss extends ts{constructor(e){super(e),this.dividers=this.querySelectorAll("section-divider"),this.addEventListener("sectionModeChanged",()=>{this.updateSectionDividers()})}setEmptyVisibility(e){super.setEmptyVisibility(e),this.updateSectionDividers()}updateSectionDividers(){for(const e of this.dividers)e.hidden=!0;let e=null;for(const t of this.sections.values())if("hidden"!==t.mode){if(e&&ss.shouldSectionDividerBeDisplayed(e,t)){t.previousElementSibling.hidden=!1}e=t}}static shouldSectionDividerBeDisplayed(e,t){return"edit"===e.mode&&"hidden"!==t.mode||"edit"===t.mode&&"hidden"!==e.mode}}class is extends ss{static get elementName(){return"heading-stats"}static get templatePaths(){return super.templatePaths.set("heading-stats","src/html/elements/autonomous/containers/heading-stats.html")}constructor(){super(is.templatePaths),this.sections.set("title",document.querySelector("title-section")),this.sections.set("subtitle",document.querySelector("subtitle-section"))}exportToJson(){return{title:this.sections.get("title").exportToJson(),subtitle:this.sections.get("subtitle").exportToJson()}}exportToHtml(){const e=document.createElement("creature-heading"),t=this.sections.get("title").exportToHtml(),s=this.sections.get("subtitle").exportToHtml();return e.appendChild(t),e.appendChild(s),e}exportToHomebrewery(){return`${this.sections.get("title").exportToHomebrewery()}\n${this.sections.get("subtitle").exportToHomebrewery()}`}}class ns extends ts{static get elementName(){return"top-stats"}static get templatePaths(){return super.templatePaths.set("top-stats","src/html/elements/autonomous/containers/top-stats.html")}constructor(){super(ns.templatePaths),this.sections.set("basicStats",document.querySelector("basic-stats")),this.sections.set("abilityScores",document.querySelector("ability-scores-section")),this.sections.set("advancedStats",document.querySelector("advanced-stats"))}updateHitPointsView(){this.sections.get("basicStats").updateHitPointsView()}updateSavingThrowsView(e){this.sections.get("advancedStats").updateSavingThrowsView(e)}updateSkillsView(e){this.sections.get("advancedStats").updateSkillsView(e)}updateSensesView(){this.sections.get("advancedStats").updateSensesView()}importFromJson(e){"attributes"in e?(this.sections.get("abilityScores").importFromJson(e.attributes.abilityScores),J.creature.challengeRating.proficiencyBonus=e.attributes.proficiencyBonus):this.sections.get("abilityScores").importFromJson(e.abilityScores),this.sections.get("advancedStats").importFromJson(e),this.sections.get("basicStats").importFromJson(e)}exportToJson(){const e={};return Object.assign(e,this.sections.get("basicStats").exportToJson()),e.abilityScores=this.sections.get("abilityScores").exportToJson(),Object.assign(e,this.sections.get("advancedStats").exportToJson()),e}exportToHtml(){const e=document.createElement("top-stats"),t=this.sections.get("basicStats").exportToHtml(),s=this.sections.get("abilityScores").exportToHtml(),i=this.sections.get("advancedStats").exportToHtml();return e.appendChild(t),e.appendChild(s),e.appendChild(i),e}exportToHomebrewery(){return`>___\n${this.sections.get("basicStats").exportToHomebrewery()}\n>___\n${this.sections.get("abilityScores").exportToHomebrewery()}\n>___\n${this.sections.get("advancedStats").exportToHomebrewery()}\n>___`}}class as extends ts{static get elementName(){return"bottom-stats"}static get templatePaths(){return super.templatePaths.set("bottom-stats","src/html/elements/autonomous/containers/bottom-stats.html")}constructor(){super(as.templatePaths),this.sections.set("specialTraits",document.querySelector("special-traits-section")),this.sections.set("actions",document.querySelector("actions-section")),this.sections.set("reactions",document.querySelector("reactions-section")),this.sections.set("legendaryActions",document.querySelector("legendary-actions-section"))}reparseAllSections(){for(const e of this.sections.values())e.reparse()}}class os extends xe{static get elementName(){return"stat-block"}static get templatePaths(){return super.templatePaths.set("stat-block","src/html/elements/autonomous/containers/stat-block.html")}constructor(e=null){super(os.templatePaths,e),i?(this.headingStats=new is,this.topStats=new ns,this.bottomStats=new as):(this.headingStats=document.querySelector("heading-stats"),this.topStats=document.querySelector("top-stats"),this.bottomStats=document.querySelector("bottom-stats"))}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.addEventListener("creatureNameChanged",this.onCreatureNameChanged),this.addEventListener("abilityScoreChanged",this.onAbilityScoreChanged),this.addEventListener("proficiencyBonusChanged",this.onProficiencyBonusChanged),this.addEventListener("skillChanged",this.onSkillChanged),this.isInitialized=!0)}onCreatureNameChanged(){this.reparseBlockSections()}onAbilityScoreChanged(){const e=event.detail.abilityName;"constitution"===e?this.topStats.updateHitPointsView():"wisdom"===e&&this.topStats.updateSensesView(),this.topStats.updateSavingThrowsView(e),this.topStats.updateSkillsView(e),this.reparseBlockSections()}onProficiencyBonusChanged(){this.topStats.updateSavingThrowsView(),this.topStats.updateSkillsView(),this.topStats.updateSensesView(),this.reparseBlockSections()}onSkillChanged(){"perception"===event.detail.skillName&&this.topStats.updateSensesView()}setColumns(e){1===e?delete this.dataset.twoColumn:2===e&&(this.dataset.twoColumn="")}setColumnHeight(e,t){"auto"===e?this.removeAttribute("style"):"manual"===e&&this.setAttribute("style",`--statblock-content-height: ${t}px;`)}setEmptyVisibility(e){this.headingStats.setEmptyVisibility(e),this.topStats.setEmptyVisibility(e),this.bottomStats.setEmptyVisibility(e)}edit(){this.bottomStats.edit(),this.topStats.edit(),this.headingStats.edit()}save(){this.bottomStats.save(),this.topStats.save(),this.headingStats.save()}reparseBlockSections(){this.bottomStats.reparseAllSections()}importFromJson(e){this.headingStats.importFromJson(e),this.topStats.importFromJson(e),this.bottomStats.importFromJson(e)}exportToJson(){const e={};return Object.assign(e,this.headingStats.exportToJson()),Object.assign(e,this.topStats.exportToJson()),Object.assign(e,this.bottomStats.exportToJson()),e}exportToHtml(){const e=J.layoutSettings,t=document.createElement("stat-block"),s=this.headingStats.exportToHtml(),i=this.topStats.exportToHtml(),n=this.bottomStats.exportToHtml();return t.appendChild(s),t.appendChild(i),t.appendChild(n),2===e.columns&&(t.dataset.twoColumn="","manual"===e.twoColumnMode&&t.setAttribute("style",`--data-content-height: ${e.twoColumnHeight}px`)),t}exportToHomebrewery(){let e="___";return 2===J.layoutSettings.columns&&(e+="\n___"),`${e}\n${this.headingStats.exportToHomebrewery()}\n${this.topStats.exportToHomebrewery()}\n${this.bottomStats.exportToHomebrewery()}`}}const rs=s(9).html;class ls extends xe{static get elementName(){return"stat-block-editor"}static get templatePaths(){return super.templatePaths.set("stat-block-editor","src/html/elements/autonomous/containers/stat-block-editor.html")}constructor(){super(ls.templatePaths),i?(this.statBlockMenu=new Zt(this),this.statBlockSidebar=new es(this),this.statBlock=new os(this),this.jsonImportDialog=new Be,this.jsonExportDialog=new De,this.htmlExportDialog=new De,this.homebreweryExportDialog=new De):(this.statBlockMenu=document.querySelector("stat-block-menu"),this.statBlockSidebar=document.querySelector("stat-block-sidebar"),this.statBlock=document.querySelector("stat-block"),this.jsonImportDialog=this.shadowRoot.getElementById("json-import-dialog"),this.jsonExportDialog=this.shadowRoot.getElementById("json-export-dialog"),this.htmlExportDialog=this.shadowRoot.getElementById("html-export-dialog"),this.homebreweryExportDialog=this.shadowRoot.getElementById("homebrewery-export-dialog")),this.jsonImportDialog.statBlockEditor=this}connectedCallback(){this.isConnected&&!this.isInitialized&&(super.connectedCallback(),this.addEventListener("numberOfColumnsChanged",this.onNumberOfColumnsChanged.bind(this)),this.addEventListener("twoColumnHeightChanged",this.onTwoColumnHeightChanged.bind(this)),this.addEventListener("emptySectionsVisibilityChanged",this.onEmptySectionsVisibilityChanged.bind(this)),this.addEventListener("allSectionsAction",this.onAllSectionsAction.bind(this)),this.addEventListener("importAction",this.onImportAction.bind(this)),this.addEventListener("exportAction",this.onExportAction.bind(this)),this.addEventListener("printAction",this.onPrintAction.bind(this)),this.isInitialized=!0)}onNumberOfColumnsChanged(e){const t=J.layoutSettings,s=e.detail.columns;t.columns=s,1===s?(this.statBlockSidebar.visible=!1,this.statBlock.setColumnHeight("auto")):2===s&&(this.statBlockSidebar.visible=!0,this.statBlock.setColumnHeight(t.twoColumnMode,t.twoColumnHeight)),this.statBlock.setColumns(s)}onTwoColumnHeightChanged(e){const t=J.layoutSettings,s=e.detail.mode,i=e.detail.height;t.twoColumnMode=s,t.twoColumnHeight=i,this.statBlock.setColumnHeight(s,i)}onEmptySectionsVisibilityChanged(e){const t=J.layoutSettings,s=e.detail.visibility;t.emptySectionsVisibility=s,this.statBlock.setEmptyVisibility(s)}onAllSectionsAction(e){const t=e.detail.action;"edit"===t?this.statBlock.edit():"save"===t&&this.statBlock.save()}onImportAction(e){const t=e.detail.format;switch(t){case"json":this.openJsonImportDialog();break;default:throw new Error(`Unknown import format: '${t}'.`)}}onExportAction(e){const t=e.detail.format;switch(t){case"json":this.openJsonExportDialog();break;case"html":this.openHtmlExportDialog();break;case"homebrewery":this.openHomebreweryExportDialog();break;default:throw new Error(`Unknown export format: '${t}'.`)}}onPrintAction(){Kt(this.exportToHtml(J.creature.title.fullName))}openJsonImportDialog(){this.jsonImportDialog.launch()}openJsonExportDialog(){const e=this.exportToJson();this.jsonExportDialog.launch(e,"application/json",`${J.creature.title.fullName}.json`)}openHtmlExportDialog(){const e=this.exportToHtml(`Statblock5e - ${J.creature.title.fullName}`);this.htmlExportDialog.launch(e,"text/html",`${J.creature.title.fullName}.html`)}openHomebreweryExportDialog(){const e=this.exportToHomebrewery();this.homebreweryExportDialog.launch(e,"text/markdown",`${J.creature.title.fullName}.md`)}importFromJson(e){this.statBlock.importFromJson(e),J.layoutSettings.fromJson(e.layout),this.statBlockMenu.updateControls(),this.statBlockSidebar.updateControls()}exportToJson(){const e=J.layoutSettings,t=J.version,s=this.statBlock.exportToJson();return s.meta={version:t,description:"Created using statblock5e-creator",url:"https://frumple.github.io/statblock5e-creator"},s.layout=e.toJson(),JSON.stringify(s,null,2)}exportToHtml(e){const t=a.cloneNode(!0),s=t.querySelector("title"),i=t.querySelector("body"),n=this.statBlock.exportToHtml();s.textContent=e,i.appendChild(n);const o=`<!DOCTYPE html>${t.documentElement.outerHTML}`;return rs(o,{indent_size:2})}exportToHomebrewery(){return this.statBlock.exportToHomebrewery()}}class hs extends ss{static get elementName(){return"basic-stats"}static get templatePaths(){return super.templatePaths.set("basic-stats","src/html/elements/autonomous/containers/basic-stats.html")}constructor(){super(hs.templatePaths),this.sections.set("armorClass",document.querySelector("armor-class-section")),this.sections.set("hitPoints",document.querySelector("hit-points-section")),this.sections.set("speed",document.querySelector("speed-section"))}updateHitPointsView(){this.sections.get("hitPoints").updateView()}}class cs extends ss{static get elementName(){return"advanced-stats"}static get templatePaths(){return super.templatePaths.set("advanced-stats","src/html/elements/autonomous/containers/advanced-stats.html")}constructor(){super(cs.templatePaths),this.sections.set("savingThrows",document.querySelector("saving-throws-section")),this.sections.set("skills",document.querySelector("skills-section")),this.sections.set("damageVulnerabilities",document.querySelector("damage-vulnerabilities-section")),this.sections.set("damageResistances",document.querySelector("damage-resistances-section")),this.sections.set("damageImmunities",document.querySelector("damage-immunities-section")),this.sections.set("conditionImmunities",document.querySelector("condition-immunities-section")),this.sections.set("senses",document.querySelector("senses-section")),this.sections.set("languages",document.querySelector("languages-section")),this.sections.set("challengeRating",document.querySelector("challenge-rating-section"))}updateSavingThrowsView(e){this.sections.get("savingThrows").updateViewOnAttributeChange(e)}updateSkillsView(e){this.sections.get("skills").updateViewOnAttributeChange(e)}updateSensesView(){this.sections.get("senses").updateViewOnAttributeChange()}importFromJson(e){for(const t of Array.from(this.sections.values()).reverse())t.importFromJson(e[t.modelPropertyName])}}!async function(){J.version=await async function(){const e=await n("package.json");return JSON.parse(e).version}(),await async function(){const e=await n("src/html/export-inlined.html"),t=new DOMParser;return a=t.parseFromString(e,"text/html"),a}(),await async function(){const e=[];e.push(Y),e.push(ie),e.push(oe),e.push(le),e.push(ce),e.push(me),e.push(ge),e.push(we),e.push(Ce),e.push(ke),e.push(Te),e.push(Se),e.push(Ie),e.push(Be),e.push(De),e.push(He),e.push(Le),e.push(ze),e.push($e),e.push(Ve),e.push(_e),e.push(Oe),e.push(je),e.push(Qe),e.push(We),e.push(Ke),e.push(Ze),e.push(at),e.push(lt),e.push(dt),e.push(pt),e.push(Et),e.push(vt),e.push(St),e.push(It),e.push(Pt),e.push(Mt),e.push(Bt),e.push(At),e.push(Lt),e.push(Ot),e.push(Jt),e.push(Wt),e.push(qt),e.push(ls),e.push(Zt),e.push(es),e.push(os),e.push(is),e.push(ns),e.push(as),e.push(hs),e.push(cs);for(const t of e)await t.define()}(),await async function(e){const t=window.setInterval((function(){void 0!==document.getElementsByTagName("body")[0]&&(window.clearInterval(t),e.call(this))}),1e3)}(()=>{document.getElementById("stat-block-editor").classList.remove("stat-block-editor_hidden"),document.getElementById("loading-screen").classList.add("loading-screen_hidden")})}()},2:function(e,t){}});